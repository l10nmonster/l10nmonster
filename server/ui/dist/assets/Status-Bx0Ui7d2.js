import{ag as B,r as c,u as O,j as e,B as n,S as T,F as S,T as d,ah as q,ai as R,aj as W,ak as F,w as D,x as L,L as M,c as H,G as K}from"./vendor-BVgSJH5C.js";import{a as A,M as G,P as _,f as w}from"./index-543A5WcJ.js";const N=({channelId:l,hideComplete:x,selectedLanguagePairs:u,calculateCompletionPercentage:z,hasIncompleteContent:p,expandAll:j})=>{const[r,C]=c.useState(!1);c.useEffect(()=>{j!==void 0&&C(j)},[j]);const[b,P]=c.useState(!1);c.useEffect(()=>{r&&!b&&P(!0)},[r,b]);const $=r||b,{data:a,isLoading:k,error:g}=O({queryKey:["status",l],queryFn:()=>w(`/api/status/${l}`),enabled:$}),f=c.useMemo(()=>{if(!a)return a;const i={};return Object.entries(a).forEach(([m,h])=>{const t={};Object.entries(h).forEach(([s,o])=>{if(u.length>0){const E=`${m} → ${s}`;if(!u.includes(E))return}const y={};Object.entries(o).forEach(([E,v])=>{x&&!p(v.pairSummaryByStatus)||(y[E]=v)}),Object.keys(y).length>0&&(t[s]=y)}),Object.keys(t).length>0&&(i[m]=t)}),Object.keys(i).length>0?i:null},[a,x,u,p]);return x&&!f&&a!==void 0?null:e.jsxs(n,{mb:4,p:r?6:4,borderWidth:"2px",borderRadius:"lg",bg:"white",borderColor:"green.200",children:[e.jsxs(n,{display:"flex",alignItems:"center",gap:3,cursor:"pointer",onClick:()=>C(!r),_hover:{bg:"gray.50"},borderRadius:"md",mx:-2,px:2,py:1,...r&&{mb:4,pb:4,borderBottom:"2px",borderColor:"green.100"},children:[e.jsx(d,{fontSize:"lg",color:"green.600",children:r?"▼":"▶"}),e.jsx(d,{fontSize:"lg",fontWeight:"bold",color:"green.600",children:l})]}),e.jsx(D,{open:r,children:e.jsx(L,{children:g?e.jsx(A,{error:g,title:`Error loading channel ${l}`}):k?e.jsxs(n,{display:"flex",flexDirection:"column",alignItems:"center",gap:3,py:8,children:[e.jsx(T,{size:"md"}),e.jsx(d,{color:"fg.muted",children:"Loading channel data..."})]}):f&&Object.keys(f).length>0?Object.entries(f).map(([i,m])=>Object.entries(m).map(([h,t])=>e.jsxs(n,{mb:6,p:4,borderWidth:"1px",borderRadius:"md",bg:"gray.50",borderColor:"border.default",children:[e.jsx(n,{display:"flex",alignItems:"center",gap:3,flexWrap:"wrap",mb:4,children:e.jsxs(M,{as:H,to:`/status/${l}/${i}/${h}`,fontSize:"lg",fontWeight:"semibold",color:"blue.600",_hover:{textDecoration:"underline"},children:[i," → ",h]})}),e.jsx(K,{templateColumns:"repeat(auto-fit, minmax(420px, 1fr))",gap:4,children:Object.entries(t).map(([s,o])=>e.jsx(_,{project:{translatedDetails:o.translatedDetails||[],untranslatedDetails:o.untranslatedDetails||{},pairSummary:o.pairSummary,pairSummaryByStatus:o.pairSummaryByStatus,projectName:s},channelId:l,sourceLang:i,targetLang:h},`${l}-${i}-${h}-${s}`))})]},`${i}-${h}`))):a&&Object.keys(a).length===0?e.jsx(n,{display:"flex",justifyContent:"center",py:8,children:e.jsx(d,{color:"fg.muted",children:"This channel has no projects"})}):e.jsx(n,{display:"flex",justifyContent:"center",py:8,children:e.jsx(d,{color:"fg.muted",children:"No content available for this channel"})})})})]})},I=()=>{const[l,x]=B(),[u,z]=c.useState(()=>l.get("hideComplete")==="true"),[p,j]=c.useState(void 0),[r,C]=c.useState(()=>{const t=l.get("pairs");return t?t.split(",").map(s=>s.replace("*"," → ")):[]}),{data:b,isLoading:P,error:$}=O({queryKey:["info"],queryFn:()=>w("/api/info")}),{data:a}=O({queryKey:["tmStats"],queryFn:()=>w("/api/tm/stats")}),k=c.useMemo(()=>!a||!Array.isArray(a)?[]:a.map(([t,s])=>`${t} → ${s}`),[a]),g=b?.channels?.map(t=>t.id)||[],f=P,i=$;c.useEffect(()=>{const t=new URLSearchParams(l);if(u?t.set("hideComplete","true"):t.delete("hideComplete"),r.length>0){const s=r.map(o=>o.replace(" → ","*")).join(",");t.set("pairs",s)}else t.delete("pairs");x(t,{replace:!0})},[u,r,l,x]);const m=t=>{const s=Object.values(t).reduce((o,y)=>o+y,0);return s===0?100:Math.round((t.translated||0)/s*100)},h=t=>(t.untranslated||0)>0||(t["in flight"]||0)>0||(t["low quality"]||0)>0;return P?e.jsx(n,{display:"flex",justifyContent:"center",mt:5,children:e.jsx(T,{size:"xl"})}):i?e.jsx(n,{mt:5,px:6,children:e.jsx(A,{error:i})}):e.jsxs(n,{children:[e.jsx(n,{bg:"blue.subtle",borderBottom:"1px",borderColor:"blue.muted",shadow:"md",borderLeft:"4px",borderLeftColor:"blue.500",px:6,py:4,children:e.jsxs(S,{align:"center",justify:"space-between",children:[e.jsx(d,{fontSize:"md",fontWeight:"semibold",color:"blue.700",children:"Translation Status"}),e.jsxs(S,{align:"center",gap:6,children:[e.jsxs(S,{align:"center",gap:2,children:[e.jsx(d,{fontSize:"sm",color:"blue.600",children:"Expand All"}),e.jsxs(q,{checked:p===!0,onCheckedChange:t=>j(t.checked),size:"sm",colorPalette:"blue",children:[e.jsx(R,{}),e.jsx(W,{bg:p===!0?"blue.500":"gray.300",children:e.jsx(F,{})})]})]}),e.jsxs(S,{align:"center",gap:2,children:[e.jsx(d,{fontSize:"sm",color:"blue.600",children:"Hide Complete"}),e.jsxs(q,{checked:u,onCheckedChange:t=>z(t.checked),size:"sm",colorPalette:"blue",children:[e.jsx(R,{}),e.jsx(W,{bg:u?"blue.500":"gray.300",children:e.jsx(F,{})})]})]}),e.jsxs(S,{align:"center",gap:2,children:[e.jsx(d,{fontSize:"sm",color:"blue.600",children:"Language Pairs"}),e.jsx(n,{minW:"150px",children:e.jsx(G,{value:r,onChange:C,options:k,placeholder:"All"})})]})]})]})}),e.jsxs(n,{py:6,px:6,children:[g.map(t=>e.jsx(N,{channelId:t,hideComplete:u,selectedLanguagePairs:r,calculateCompletionPercentage:m,hasIncompleteContent:h,expandAll:p},t)),g.length===0&&!f&&e.jsx(d,{mt:4,color:"fg.muted",children:"No channels found."})]})]})};export{I as default};
