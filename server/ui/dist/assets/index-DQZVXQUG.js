import{j as e,R as ze,B as t,V as C,T as r,a as R,C as Ce,b as We,L as I,c as D,F as z,d as ie,e as le,f as ae,g as de,h as ce,i as W,G as Q,I as ve,u as Te,r as w,k as V,A as he,S as K,l as se,m as Ae,n as Pe,o as Re,p as Le,q as $e,s as Ee,t as Me,v as Ie,D as B,w as F,x as N,y as U,z as q,E as H,H as _,J as G,K as De,M as Je}from"./vendor-BCzBv13G.js";function qe({children:o}){return e.jsx(e.Fragment,{children:o})}class He extends ze.Component{constructor(n){super(n),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(n){return{hasError:!0,error:n}}componentDidCatch(n,d){this.setState({errorInfo:d}),console.error("ErrorBoundary caught an error:",n,d)}handleReset=()=>{this.setState({hasError:!1,error:null,errorInfo:null})};render(){return this.state.hasError?e.jsx(t,{p:8,maxW:"800px",mx:"auto",mt:10,children:e.jsxs(C,{gap:4,align:"stretch",children:[e.jsxs(t,{bg:"red.subtle",borderLeft:"4px",borderLeftColor:"red.500",p:6,borderRadius:"md",children:[e.jsx(r,{fontSize:"lg",fontWeight:"bold",color:"red.700",mb:2,children:"Something went wrong"}),e.jsx(r,{color:"red.600",mb:4,children:this.state.error?.message||"An unexpected error occurred"}),e.jsx(R,{colorPalette:"red",variant:"outline",size:"sm",onClick:this.handleReset,children:"Try Again"})]}),this.state.errorInfo&&e.jsxs(t,{bg:"gray.subtle",p:4,borderRadius:"md",overflow:"auto",maxH:"300px",children:[e.jsx(r,{fontSize:"sm",fontWeight:"bold",color:"fg.muted",mb:2,children:"Technical Details"}),e.jsx(r,{as:"pre",fontSize:"xs",fontFamily:"mono",whiteSpace:"pre-wrap",color:"fg.muted",children:this.state.errorInfo.componentStack})]})]})}):this.props.children}}async function Y(o,n={}){try{const d=await fetch(o,n);if(!d.ok){let l;try{l=await d.json()}catch{}const i=l?.message||`HTTP error! status: ${d.status}`,h=new Error(i);throw h.status=d.status,h.response=d,h}return await d.json()}catch(d){if(console.error("API Fetch Error:",d),d.status||d.response)throw d;const l=new Error(d.message||"Network error");throw l.originalError=d,l}}const _e=({project:o,channelId:n,sourceLang:d,targetLang:l})=>{const{projectName:i,pairSummary:h,pairSummaryByStatus:u,translationStatus:b}=o,c={translated:u?.translated||0,"in flight":u?.["in flight"]||0,"low quality":u?.["low quality"]||0,untranslated:u?.untranslated||0},a=Object.values(c).reduce((j,y)=>j+y,0),f=a>0?Math.round(c.translated/a*100):0,g=a>0?Math.round(c["in flight"]/a*100):0,m=a>0?Math.round(c["low quality"]/a*100):0,T=a>0?Math.round(c.untranslated/a*100):0,v=n&&d&&l?`/status/${n}/${d}/${l}?prj=${encodeURIComponent(i)}`:null;return e.jsx(Ce,{variant:"outline",bg:"yellow.subtle",children:e.jsxs(We,{children:[v?e.jsx(I,{as:D,to:v,fontSize:"sm",fontWeight:"semibold",mb:2,display:"block",color:"purple.600",_hover:{textDecoration:"underline"},children:i}):e.jsx(r,{fontSize:"sm",fontWeight:"semibold",mb:2,children:i}),e.jsx(t,{mb:3,children:e.jsxs(z,{align:"center",gap:2,mb:1,children:[e.jsxs(ie,{children:[e.jsx(le,{asChild:!0,children:e.jsxs(t,{flex:"1",bg:"bg.muted",rounded:"full",height:"10px",cursor:"help",position:"relative",overflow:"hidden",children:[e.jsx(t,{position:"absolute",top:"0",left:"0",height:"100%",width:`${f}%`,bg:"green.solid",transition:"width 0.3s ease"}),e.jsx(t,{position:"absolute",top:"0",left:`${f}%`,height:"100%",width:`${g}%`,bg:"blue.solid",transition:"width 0.3s ease"}),e.jsx(t,{position:"absolute",top:"0",left:`${f+g}%`,height:"100%",width:`${m}%`,bg:"yellow.solid",transition:"width 0.3s ease"}),e.jsx(t,{position:"absolute",top:"0",left:`${f+g+m}%`,height:"100%",width:`${T}%`,bg:"red.solid",transition:"width 0.3s ease"})]})}),e.jsx(ae,{children:e.jsxs(de,{maxW:"300px",bg:"bg.default",borderWidth:"1px",borderColor:"border.default",shadow:"lg",zIndex:1e3,children:[e.jsx(ce,{}),e.jsxs(t,{p:2,children:[e.jsx(r,{fontSize:"sm",fontWeight:"bold",mb:2,color:"fg.default",children:"Translation Status Details"}),b&&b.length>0?e.jsx(t,{children:b.map((j,y)=>{const p=j.q===null?"untranslated":j.q===0?"in flight":j.q>=j.minQ?"translated":"low quality",M=p==="translated"?"green.solid":p==="in flight"?"blue.solid":p==="low quality"?"yellow.solid":"red.solid";return e.jsxs(z,{align:"center",gap:2,mb:1,children:[e.jsx(t,{w:"8px",h:"8px",bg:M,borderRadius:"full"}),e.jsxs(r,{fontSize:"xs",color:"fg.default",children:["Q: ",j.q||"null"," | Segs: ",j.seg," | Words: ",j.words," | Chars: ",j.chars]})]},y)})}):e.jsxs(t,{children:[e.jsxs(z,{align:"center",gap:2,mb:1,children:[e.jsx(t,{w:"8px",h:"8px",bg:"green.solid",borderRadius:"full"}),e.jsxs(r,{fontSize:"xs",color:"fg.default",children:["Translated: ",c.translated]})]}),e.jsxs(z,{align:"center",gap:2,mb:1,children:[e.jsx(t,{w:"8px",h:"8px",bg:"blue.solid",borderRadius:"full"}),e.jsxs(r,{fontSize:"xs",color:"fg.default",children:["In Flight: ",c["in flight"]]})]}),e.jsxs(z,{align:"center",gap:2,mb:1,children:[e.jsx(t,{w:"8px",h:"8px",bg:"yellow.solid",borderRadius:"full"}),e.jsxs(r,{fontSize:"xs",color:"fg.default",children:["Low Quality: ",c["low quality"]]})]}),e.jsxs(z,{align:"center",gap:2,children:[e.jsx(t,{w:"8px",h:"8px",bg:"red.solid",borderRadius:"full"}),e.jsxs(r,{fontSize:"xs",color:"fg.default",children:["Untranslated: ",c.untranslated]})]})]})]})]})})]}),e.jsxs(r,{fontSize:"sm",color:"fg.muted",minW:"45px",children:[f,"%"]})]})}),e.jsxs(z,{gap:2,flexWrap:"wrap",align:"center",children:[e.jsxs(W,{variant:"subtle",colorPalette:"blue",children:["Segments: ",h?.segs?.toLocaleString()||"0"]}),e.jsxs(W,{variant:"subtle",colorPalette:"green",children:["Words: ",h?.words?.toLocaleString()||"0"]}),e.jsxs(W,{variant:"subtle",colorPalette:"purple",children:["Chars: ",h?.chars?.toLocaleString()||"0"]}),c.untranslated>0&&e.jsxs(W,{variant:"solid",colorPalette:"red",children:["Untranslated: ",c.untranslated.toLocaleString()]}),c["low quality"]>0&&e.jsxs(W,{variant:"solid",colorPalette:"orange",children:["Low Quality: ",c["low quality"].toLocaleString()]})]})]})})},Ge=({item:o,channelId:n})=>{const d=i=>{const h=new Date,u=new Date(i),b=h-u,c=Math.floor(b/1e3),a=new Intl.RelativeTimeFormat("en",{numeric:"auto",style:"short"});return c<60?a.format(-c,"second"):c<3600?a.format(-Math.floor(c/60),"minute"):c<86400?a.format(-Math.floor(c/3600),"hour"):c<2592e3?a.format(-Math.floor(c/86400),"day"):c<31536e3?a.format(-Math.floor(c/2592e3),"month"):a.format(-Math.floor(c/31536e3),"year")},l=i=>new Date(i).toLocaleString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZoneName:"short"});return e.jsx(t,{p:3,borderWidth:"1px",borderRadius:"md",borderColor:"border.default",bg:"yellow.subtle",w:"100%",children:e.jsxs(Q,{templateColumns:"2fr 80px 3fr 80px 80px 100px",gap:4,alignItems:"center",children:[e.jsxs(t,{children:[e.jsx(r,{fontSize:"xs",color:"fg.muted",mb:1,children:"Project"}),e.jsx(I,{as:D,to:`/sources/${n}/${o.prj??"default"}`,fontSize:"sm",fontWeight:"semibold",color:"blue.600",_hover:{textDecoration:"underline"},children:o.prj??"default"})]}),e.jsxs(t,{children:[e.jsx(r,{fontSize:"xs",color:"fg.muted",mb:1,children:"Source"}),e.jsx(W,{colorPalette:"blue",size:"sm",children:o.sourceLang})]}),e.jsxs(t,{children:[e.jsxs(r,{fontSize:"xs",color:"fg.muted",mb:1,children:["Targets (",o.targetLangs.length,")"]}),e.jsx(z,{wrap:"wrap",gap:1,children:o.targetLangs.map(i=>e.jsx(W,{colorPalette:"green",size:"sm",children:i},i))})]}),e.jsxs(t,{textAlign:"center",children:[e.jsx(r,{fontSize:"xs",color:"fg.muted",mb:1,children:"Resources"}),e.jsx(r,{fontSize:"sm",fontWeight:"bold",color:"orange.600",children:o.resCount.toLocaleString()})]}),e.jsxs(t,{textAlign:"center",children:[e.jsx(r,{fontSize:"xs",color:"fg.muted",mb:1,children:"Segments"}),e.jsx(r,{fontSize:"sm",fontWeight:"bold",color:"purple.600",children:o.segmentCount.toLocaleString()})]}),e.jsxs(t,{textAlign:"center",children:[e.jsx(r,{fontSize:"xs",color:"fg.muted",mb:1,children:"Modified"}),e.jsxs(ie,{children:[e.jsx(le,{asChild:!0,children:e.jsx(r,{fontSize:"xs",color:"fg.muted",cursor:"help",children:d(o.lastModified)})}),e.jsx(ae,{children:e.jsxs(de,{children:[e.jsx(ce,{}),e.jsx(r,{fontSize:"sm",children:l(o.lastModified)})]})})]})]})]})})},ke=(o,n)=>o?{snapText:`Snapped on ${new Date(o).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}`,importText:n?{text:"Imported from snap store ",store:n}:null}:{snapText:"Never snapped",importText:null},Qe=({channelId:o,project:n,resource:d,onBackClick:l,backLabel:i="Back",snapTimestamp:h,snapStore:u,showSnapInfo:b=!1,extraContent:c=null})=>e.jsxs(t,{p:6,borderWidth:"2px",borderRadius:"lg",bg:"white",borderColor:"green.200",mb:6,children:[e.jsxs(t,{display:"flex",alignItems:"center",gap:3,flexWrap:"wrap",pb:4,borderBottom:"2px",borderColor:"green.100",children:[l&&e.jsx(ve,{"aria-label":i,onClick:l,variant:"ghost",size:"sm",children:"←"}),e.jsxs(t,{children:[e.jsx(r,{fontSize:"sm",color:"fg.muted",mb:1,children:"Channel"}),e.jsx(r,{fontSize:"lg",fontWeight:"bold",color:"green.600",children:o})]}),n&&e.jsxs(t,{children:[e.jsx(r,{fontSize:"sm",color:"fg.muted",mb:1,children:"Project"}),e.jsx(r,{fontSize:"lg",fontWeight:"semibold",color:"blue.600",children:n})]}),d&&e.jsxs(t,{flex:"1",children:[e.jsx(r,{fontSize:"sm",color:"fg.muted",mb:1,children:"Resource"}),e.jsx(r,{fontSize:"lg",fontWeight:"semibold",color:"purple.600",wordBreak:"break-all",children:d})]}),b&&!n&&!d&&e.jsx(t,{flex:"1",textAlign:"right",children:(()=>{const{snapText:a,importText:f}=ke(h,u);return e.jsxs(e.Fragment,{children:[e.jsx(r,{fontSize:"sm",color:"fg.muted",children:a}),f&&e.jsxs(r,{fontSize:"sm",color:"fg.muted",children:[f.text,e.jsx(r,{as:"span",fontWeight:"bold",color:"blue.600",children:f.store})]})]})})()})]}),c&&e.jsx(t,{mt:6,children:c})]});function ne(o){if(!o)return null;const n=/(https:\/\/[^\s]+)/g;return o.split(n).map((l,i)=>l.match(n)?e.jsx(r,{as:"a",href:l,target:"_blank",rel:"noopener noreferrer",color:"blue.600",textDecoration:"underline",_hover:{color:"blue.800"},children:l},`link-${i}`):l)}const xe="tmCart",Oe=()=>{const o=sessionStorage.getItem(xe);return o?JSON.parse(o):{}},Be=o=>{sessionStorage.setItem(xe,JSON.stringify(o)),window.dispatchEvent(new Event("cartUpdated"))},Fe=(o,n,d,l=null)=>({guid:o.guid,channel:l||o.channel,sourceLang:n,targetLang:d,nsrc:o.nsrc,ntgt:o.ntgt}),ue=(o,n,d,l=null)=>{const i=Oe(),h=`${o}|${n}`;i[h]||(i[h]={sourceLang:o,targetLang:n,tus:[]});const u=d.map(b=>Fe(b,o,n,l));i[h].tus.push(...u),Be(i)},Ve=ue,Ke=(o,n,d,l)=>{ue(o,n,l,d)},Ne=({sourceLang:o,targetLang:n,providers:d})=>{Te();const l=i=>{switch(i){case"done":return"green";case"pending":return"yellow";case"error":return"red";default:return"gray"}};return e.jsx(t,{p:6,borderWidth:"1px",borderRadius:"lg",bg:"white",shadow:"sm",w:"100%",children:e.jsxs(C,{gap:4,align:"stretch",children:[e.jsx(t,{children:e.jsx(t,{mb:2,children:e.jsxs(I,{as:D,to:`/tm/${o}/${n}`,fontSize:"lg",fontWeight:"semibold",color:"blue.600",_hover:{textDecoration:"underline"},children:[o," → ",n]})})}),e.jsx(C,{gap:3,align:"stretch",children:d.map((i,h)=>e.jsx(t,{p:3,borderWidth:"1px",borderRadius:"md",borderColor:"border.default",bg:"yellow.subtle",children:e.jsxs(Q,{templateColumns:{base:"minmax(0, 2fr) 1fr 1fr 1fr 1fr",md:"minmax(0, 3fr) 1fr 1fr 1fr 1fr"},gap:{base:1,md:2},alignItems:"center",overflow:"hidden",minWidth:"0",children:[e.jsxs(t,{minWidth:"0",overflow:"hidden",children:[e.jsx(r,{fontSize:"xs",color:"fg.muted",mb:1,children:"Provider"}),e.jsx(I,{as:D,to:`/tm/${o}/${n}?translationProvider=${encodeURIComponent(i.translationProvider)}`,fontSize:"sm",fontWeight:"semibold",color:"blue.600",_hover:{textDecoration:"underline",color:"blue.700"},noOfLines:1,title:i.translationProvider,children:i.translationProvider})]}),e.jsxs(t,{textAlign:"center",children:[e.jsx(r,{fontSize:"xs",color:"fg.muted",mb:1,children:"Status"}),e.jsx(W,{colorPalette:l(i.status),size:"sm",children:i.status})]}),e.jsxs(t,{textAlign:"center",children:[e.jsx(r,{fontSize:"xs",color:"fg.muted",mb:1,children:"TUs"}),e.jsx(r,{fontSize:"sm",fontWeight:"bold",color:"purple.600",children:i.tuCount.toLocaleString()})]}),e.jsxs(t,{textAlign:"center",children:[e.jsx(r,{fontSize:"xs",color:"fg.muted",mb:1,children:"Unique"}),e.jsx(r,{fontSize:"sm",fontWeight:"bold",color:"orange.600",children:i.distinctGuids.toLocaleString()})]}),e.jsxs(t,{textAlign:"center",children:[e.jsx(r,{fontSize:"xs",color:"fg.muted",mb:1,children:"Jobs"}),e.jsx(r,{fontSize:"sm",fontWeight:"bold",color:"teal.600",children:i.jobCount.toLocaleString()})]})]})},h))})]})})},Ye=({sourceLang:o,targetLang:n})=>{const[d,l]=w.useState(!1),i=w.useRef(null);w.useEffect(()=>{const c=new IntersectionObserver(a=>{a.forEach(f=>{f.isIntersecting&&(l(!0),c.disconnect())})},{rootMargin:"200px",threshold:0});return i.current&&c.observe(i.current),()=>c.disconnect()},[]);const{data:h,isLoading:u,error:b}=V({queryKey:["tmStats",o,n],queryFn:()=>Y(`/api/tm/stats/${o}/${n}`),enabled:d});return e.jsx(t,{ref:i,minH:"200px",children:b?e.jsx(he,{status:"error",children:e.jsxs(t,{children:[e.jsxs(r,{fontWeight:"bold",children:["Error loading ",o," → ",n]}),e.jsx(r,{children:b.message||"Unknown error"})]})}):u?e.jsx(t,{display:"flex",justifyContent:"center",alignItems:"center",minH:"200px",p:6,borderWidth:"1px",borderRadius:"lg",bg:"white",shadow:"sm",children:e.jsx(K,{size:"md"})}):h?e.jsx(Ne,{sourceLang:o,targetLang:n,providers:h}):d?e.jsx(t,{display:"flex",justifyContent:"center",alignItems:"center",minH:"200px",p:6,borderWidth:"1px",borderRadius:"lg",bg:"white",shadow:"sm",children:e.jsx(r,{color:"fg.muted",children:"No data available"})}):e.jsx(t,{display:"flex",justifyContent:"center",alignItems:"center",minH:"200px",p:6,borderWidth:"1px",borderRadius:"lg",bg:"gray.50",shadow:"sm",children:e.jsx(r,{color:"fg.muted",fontSize:"sm",children:"Scroll down to load..."})})})},Ze=({providers:o,selectedProvider:n,onProviderSelect:d})=>{const l=Array.isArray(o)?o:[];return e.jsxs(t,{width:"25%",flexShrink:0,borderRight:"1px",borderColor:"border.default",p:4,bg:"yellow.subtle",minH:"70vh",children:[e.jsx(r,{fontSize:"lg",fontWeight:"bold",mb:4,children:"Providers"}),e.jsxs(C,{gap:2,align:"stretch",children:[l.map(i=>{const h=typeof i=="object"&&i?.id?i.id:i,u=typeof i=="object"&&i?.id?i.id:i,b=typeof i=="object"&&i?.type?i.type:null;return e.jsxs(t,{p:3,borderRadius:"md",cursor:"pointer",bg:n===u?"blue.subtle":"white",borderWidth:"1px",borderColor:n===u?"blue.600":"border.default",_hover:{bg:n===u?"blue.subtle":"gray.subtle"},onClick:()=>d(u),children:[e.jsx(r,{fontSize:"sm",fontWeight:"medium",noOfLines:2,children:h}),b&&e.jsx(r,{fontSize:"xs",color:"fg.muted",mt:1,children:b})]},u)}),l.length===0&&e.jsx(r,{color:"fg.muted",fontSize:"sm",textAlign:"center",mt:4,children:"No providers found"})]})]})},Xe=({providerId:o})=>{const{data:n,isLoading:d,error:l}=V({queryKey:["provider",o],queryFn:()=>Y(`/api/providers/${o}`),enabled:!!o});if(!o)return e.jsx(t,{width:"75%",p:6,textAlign:"center",children:e.jsx(r,{color:"fg.muted",children:"Select a provider to view details"})});if(d)return e.jsx(t,{width:"75%",p:6,display:"flex",justifyContent:"center",alignItems:"center",children:e.jsx(K,{size:"lg"})});if(l)return e.jsx(t,{width:"75%",p:6,children:e.jsx(he,{status:"error",children:e.jsxs(t,{children:[e.jsx(r,{fontWeight:"bold",children:"Error"}),e.jsx(r,{children:l?.message||"Failed to fetch provider details"})]})})});if(!n)return e.jsx(t,{width:"75%",p:6,textAlign:"center",children:e.jsx(r,{color:"fg.muted",children:"Provider not found"})});const{info:i,properties:h}=n,u=a=>{if(!a)return a;const f={31:"#ef4444",32:"#22c55e",33:"#eab308",34:"#3b82f6",35:"#a855f7",36:"#06b6d4",39:"inherit"},g=[];let m=0,T="inherit";const v=/\u001B\[([0-9;]*)m/g;let j;for(;(j=v.exec(a))!==null;){if(j.index>m){const p=a.slice(m,j.index);g.push(e.jsx("span",{style:{color:T},children:p},`${m}-text`))}const y=j[1];f[y]&&(T=f[y]),m=j.index+j[0].length}if(m<a.length){const y=a.slice(m);g.push(e.jsx("span",{style:{color:T},children:y},`${m}-text`))}return g.length>0?g:a},b=a=>Array.isArray(a)?a.map((f,g)=>e.jsxs(t,{display:"flex",alignItems:"flex-start",gap:2,children:[e.jsx(r,{fontSize:"sm",color:"fg.muted",mt:"1px",children:"•"}),e.jsx(r,{fontSize:"sm",flex:"1",children:u(f)})]},g)):e.jsx(r,{fontSize:"sm",children:u(a)}),c=a=>typeof a=="object"&&a!==null?!Array.isArray(a)&&Object.values(a).every(g=>typeof g=="string")&&Object.keys(a).length>0?e.jsx(t,{borderWidth:"1px",borderRadius:"md",overflow:"hidden",bg:"white",shadow:"sm",children:e.jsxs(t,{as:"table",w:"100%",fontSize:"sm",children:[e.jsx(t,{as:"thead",bg:"blue.subtle",borderBottom:"1px",borderColor:"border.default",children:e.jsxs(t,{as:"tr",children:[e.jsx(t,{as:"th",p:2,textAlign:"left",fontWeight:"semibold",color:"blue.600",children:"Key"}),e.jsx(t,{as:"th",p:2,textAlign:"left",fontWeight:"semibold",color:"blue.600",children:"Value"})]})}),e.jsx(t,{as:"tbody",children:Object.entries(a).sort(([g],[m])=>g.localeCompare(m)).map(([g,m])=>e.jsxs(t,{as:"tr",_hover:{bg:"gray.subtle"},children:[e.jsx(t,{as:"td",p:2,borderBottom:"1px",borderColor:"border.subtle",fontFamily:"mono",fontSize:"xs",children:g}),e.jsx(t,{as:"td",p:2,borderBottom:"1px",borderColor:"border.subtle",fontSize:"xs",children:m})]},g))})]})}):e.jsx(t,{as:"pre",fontSize:"xs",bg:"bg.muted",p:2,borderRadius:"md",overflow:"auto",maxH:"200px",children:JSON.stringify(a,null,2)}):e.jsx(r,{fontSize:"sm",children:String(a)});return e.jsx(t,{width:"75%",p:6,overflow:"auto",children:e.jsxs(C,{gap:6,align:"stretch",children:[e.jsx(t,{children:e.jsx(r,{fontSize:"2xl",fontWeight:"bold",mb:2,children:o})}),e.jsxs(t,{p:4,borderWidth:"1px",borderRadius:"lg",bg:"white",shadow:"sm",children:[e.jsx(r,{fontSize:"lg",fontWeight:"semibold",mb:4,children:"Properties"}),Object.keys(h).length===0?e.jsx(r,{color:"fg.muted",fontSize:"sm",children:"No properties available"}):e.jsx(C,{gap:4,align:"stretch",children:Object.entries(h).sort(([a],[f])=>a.localeCompare(f)).map(([a,f])=>e.jsxs(t,{children:[e.jsxs(r,{fontSize:"sm",fontWeight:"bold",color:"blue.600",mb:2,children:[a,":"]}),e.jsx(t,{pl:4,children:c(f)})]},a))})]}),e.jsxs(t,{p:4,borderWidth:"1px",borderRadius:"lg",bg:"white",shadow:"sm",children:[e.jsx(r,{fontSize:"lg",fontWeight:"semibold",mb:4,children:"Information"}),e.jsxs(Q,{templateColumns:"auto 1fr",gap:3,alignItems:"start",children:[e.jsx(r,{fontSize:"sm",fontWeight:"bold",color:"blue.600",children:"Type:"}),e.jsx(W,{colorPalette:"blue",size:"sm",children:i.type}),e.jsx(r,{fontSize:"sm",fontWeight:"bold",color:"blue.600",children:"Cost per Word:"}),e.jsx(r,{fontSize:"sm",children:i.costPerWord}),e.jsx(r,{fontSize:"sm",fontWeight:"bold",color:"blue.600",children:"Cost per MChar:"}),e.jsx(r,{fontSize:"sm",children:i.costPerMChar}),i.description&&e.jsxs(e.Fragment,{children:[e.jsx(r,{fontSize:"sm",fontWeight:"bold",color:"blue.600",children:"Description:"}),e.jsx(t,{children:b(i.description)})]})]})]})]})})},et=({langPairKey:o,tus:n,onRemoveTU:d})=>{const[l,i]=w.useState(""),[h,u]=w.useState(!1),[b,c]=w.useState(!1),[a,f]=w.useState(null),[g,m]=w.useState(""),[T,v]=w.useState(""),[j,y]=w.useState(""),[p,M]=w.useState(null),[fe,Z]=w.useState(!1),{data:ge={},isLoading:be}=V({queryKey:["info"],queryFn:()=>Y("/api/info")}),me=ge.providers||[],X=se({mutationFn:async({sourceLang:s,targetLang:x,guids:S,provider:A})=>{const P=await fetch("/api/dispatcher/estimateJob",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sourceLang:s,targetLang:x,guids:S,provider:A})});if(!P.ok){const k=await P.json();throw new Error(k.message||"Failed to estimate job")}return P.json()}}),J=se({mutationFn:async({sourceLang:s,targetLang:x,guids:S,provider:A,jobName:P,instructions:k})=>{const O=await fetch("/api/dispatcher/startJob",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sourceLang:s,targetLang:x,guids:S,provider:A,jobName:P,instructions:k})});if(!O.ok){const we=await O.json();throw new Error(we.message||"Failed to start job")}return O.json()}});function ee(s){return s.map(x=>typeof x=="string"?x:`{{${x.t}}}`).join("")}const je=async()=>{if(!l){alert("Please select a provider first");return}const s=Array.isArray(n)?n:n.tus,x=typeof l=="object"&&l?.id?l.id:l;try{const S=s.map(P=>P.guid),A=await X.mutateAsync({sourceLang:$,targetLang:E,guids:S,provider:x});A?(f(A),m(""),v(""),u(!0)):(y(`Provider "${x}" did not accept any of the selected translation units.`),c(!0))}catch(S){y(`Failed to estimate job: ${S.message}`),c(!0)}},pe=s=>{i(s)},Se=async()=>{if(!a)return;const s=typeof l=="object"&&l?.id?l.id:l;try{const S=(await J.mutateAsync({sourceLang:$,targetLang:E,guids:a.guids,provider:s,jobName:g||void 0,instructions:T||void 0}))[0];M(S),u(!1),Z(!0)}catch(x){y(`Failed to start job: ${x.message}`),c(!0)}},te=()=>{if(Z(!1),M(null),f(null),m(""),v(""),a&&a.guids){const s=new Set(a.guids),x=Array.isArray(n)?n:n.tus;for(let S=x.length-1;S>=0;S--)s.has(x[S].guid)&&d(o,S)}},ye=s=>s===0?"Free":s==null?"Unknown":`$${s.toFixed(2)}`,L=Array.isArray(n)?n:n.tus,$=Array.isArray(n)?o.split("|")[0]||o.split("→")[0]:n.sourceLang,E=Array.isArray(n)?o.split("|")[1]||o.split("→").slice(1).join("→"):n.targetLang,re=L.some(s=>s.ntgt!==void 0),oe=L.some(s=>s.channel!==void 0);return e.jsxs(t,{p:6,borderWidth:"1px",borderRadius:"lg",bg:"white",shadow:"sm",children:[e.jsxs(C,{gap:4,align:"stretch",children:[e.jsx(t,{children:e.jsxs(z,{align:"center",justify:"space-between",mb:2,children:[e.jsxs(z,{align:"center",gap:3,children:[e.jsx(W,{colorPalette:"blue",size:"sm",children:$}),e.jsx(r,{color:"fg.muted",fontSize:"lg",children:"→"}),e.jsx(W,{colorPalette:"green",size:"sm",children:E}),e.jsxs(z,{align:"center",gap:3,ml:4,children:[e.jsxs(Ae,{size:"sm",width:"250px",value:l?[l]:[],onValueChange:s=>{},positioning:{strategy:"absolute",placement:"bottom-start",flip:!0,gutter:4},children:[e.jsxs(Pe,{children:[e.jsx(r,{fontSize:"sm",flex:"1",textAlign:"left",children:typeof l=="object"&&l?.id?l.id:l||"Select Provider"}),e.jsx(Re,{})]}),e.jsx(Le,{children:e.jsx($e,{zIndex:1e3,bg:"white",borderWidth:"1px",borderColor:"border.default",borderRadius:"md",shadow:"lg",minW:"250px",maxH:"200px",overflow:"auto",children:be?e.jsxs(t,{p:3,textAlign:"center",children:[e.jsx(K,{size:"sm"}),e.jsx(r,{fontSize:"sm",color:"fg.muted",mt:2,children:"Loading providers..."})]}):me.slice().sort((s,x)=>{const S=typeof s=="object"&&s?.id?s.id:s,A=typeof x=="object"&&x?.id?x.id:x;return S.localeCompare(A)}).map((s,x)=>e.jsxs(Ee,{item:s,value:s,onClick:()=>pe(s),children:[e.jsx(Me,{children:typeof s=="object"&&s?.id?s.id:s}),e.jsx(Ie,{})]},`provider-${x}-${typeof s=="string"?s:JSON.stringify(s)}`))})})]}),e.jsx(R,{size:"sm",colorPalette:"blue",onClick:je,disabled:!l,loading:X.isPending,children:"Create Job"})]})]}),e.jsxs(r,{fontSize:"sm",color:"fg.muted",children:[L.length," ",L.length===1?"TU":"TUs"]})]})}),e.jsx(t,{bg:"white",borderRadius:"md",overflow:"auto",children:e.jsxs(t,{as:"table",w:"100%",fontSize:"sm",children:[e.jsx(t,{as:"thead",bg:"blue.subtle",borderBottom:"2px",borderColor:"blue.muted",shadow:"sm",children:e.jsxs(t,{as:"tr",children:[e.jsx(t,{as:"th",p:3,borderBottom:"1px",borderColor:"border.default",textAlign:"left",minW:"120px",children:e.jsx(r,{fontSize:"sm",fontWeight:"bold",color:"blue.600",children:"GUID"})}),oe&&e.jsx(t,{as:"th",p:3,borderBottom:"1px",borderColor:"border.default",textAlign:"left",minW:"120px",children:e.jsx(r,{fontSize:"sm",fontWeight:"bold",color:"blue.600",children:"CHANNEL"})}),e.jsx(t,{as:"th",p:3,borderBottom:"1px",borderColor:"border.default",textAlign:"left",minW:"350px",children:e.jsx(r,{fontSize:"sm",fontWeight:"bold",color:"blue.600",children:"SOURCE"})}),re&&e.jsx(t,{as:"th",p:3,borderBottom:"1px",borderColor:"border.default",textAlign:"left",minW:"350px",children:e.jsx(r,{fontSize:"sm",fontWeight:"bold",color:"blue.600",children:"TARGET"})}),e.jsx(t,{as:"th",p:3,borderBottom:"1px",borderColor:"border.default",textAlign:"center",minW:"100px",children:e.jsx(r,{fontSize:"sm",fontWeight:"bold",color:"blue.600",children:"ACTION"})})]})}),e.jsx(t,{as:"tbody",children:L.map((s,x)=>e.jsxs(t,{as:"tr",_hover:{bg:"gray.subtle"},children:[e.jsx(t,{as:"td",p:3,borderBottom:"1px",borderColor:"border.subtle",children:e.jsx(r,{fontSize:"xs",fontFamily:"mono",color:"blue.600",userSelect:"all",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxW:"100px",children:s.guid})}),oe&&e.jsx(t,{as:"td",p:3,borderBottom:"1px",borderColor:"border.subtle",children:e.jsx(r,{fontSize:"xs",children:s.channel||""})}),e.jsx(t,{as:"td",p:3,borderBottom:"1px",borderColor:"border.subtle",children:e.jsx(r,{fontSize:"xs",noOfLines:2,dir:$?.startsWith("he")||$?.startsWith("ar")?"rtl":"ltr",children:Array.isArray(s.nsrc)?ee(s.nsrc):s.nsrc})}),re&&e.jsx(t,{as:"td",p:3,borderBottom:"1px",borderColor:"border.subtle",children:e.jsx(r,{fontSize:"xs",noOfLines:2,dir:E?.startsWith("he")||E?.startsWith("ar")?"rtl":"ltr",children:Array.isArray(s.ntgt)?ee(s.ntgt):s.ntgt||""})}),e.jsx(t,{as:"td",p:3,borderBottom:"1px",borderColor:"border.subtle",textAlign:"center",children:e.jsx(R,{size:"xs",colorPalette:"red",variant:"outline",onClick:()=>d(o,x),children:"Remove"})})]},`cart-tu-${x}-${typeof s.guid=="string"?s.guid:s.nid||x}`))})]})})]}),e.jsxs(B,{open:h,onOpenChange:s=>u(s.open),children:[e.jsx(F,{}),e.jsx(N,{children:e.jsxs(U,{maxW:"500px",children:[e.jsxs(q,{children:[e.jsx(H,{children:"Job Created Successfully"}),e.jsx(_,{})]}),e.jsx(G,{children:a&&e.jsxs(C,{gap:4,align:"stretch",children:[e.jsxs(t,{children:[e.jsxs(r,{fontSize:"lg",fontWeight:"bold",color:"green.600",mb:3,children:[a.guids?.length||0," TUs accepted out of ",L.length," sent"]}),e.jsxs(C,{gap:2,align:"stretch",children:[e.jsxs(t,{children:[e.jsx(r,{fontSize:"sm",fontWeight:"semibold",color:"fg.default",display:"inline",children:"Provider: "}),e.jsx(r,{fontSize:"sm",color:"blue.600",fontFamily:"mono",display:"inline",children:typeof l=="object"&&l?.id?l.id:l})]}),e.jsxs(t,{children:[e.jsx(r,{fontSize:"sm",fontWeight:"semibold",color:"fg.default",display:"inline",children:"Estimated Cost: "}),e.jsx(r,{fontSize:"sm",color:"green.600",fontWeight:"medium",display:"inline",children:ye(a.estimatedCost)})]}),a.statusDescription&&e.jsxs(t,{children:[e.jsx(r,{fontSize:"sm",fontWeight:"semibold",color:"fg.default",display:"inline",children:"Status: "}),e.jsx(r,{fontSize:"sm",color:"fg.muted",display:"inline",children:ne(a.statusDescription)})]})]})]}),e.jsxs(t,{children:[e.jsx(r,{fontSize:"sm",fontWeight:"bold",mb:2,children:"Job Name (optional):"}),e.jsx(De,{placeholder:"Enter a name for this job...",value:g,onChange:s=>m(s.target.value)})]}),e.jsxs(t,{children:[e.jsx(r,{fontSize:"sm",fontWeight:"bold",mb:2,children:"Job Instructions (optional):"}),e.jsx(Je,{placeholder:"Enter any specific instructions for this translation job...",value:T,onChange:s=>v(s.target.value),rows:3})]}),e.jsxs(z,{gap:3,children:[e.jsx(R,{colorPalette:"gray",variant:"outline",onClick:()=>{u(!1),f(null),m(""),v("")},flex:"1",disabled:J.isPending,children:"Cancel"}),e.jsx(R,{colorPalette:"green",onClick:Se,loading:J.isPending,flex:"1",children:"Push Job"})]})]})})]})})]}),e.jsxs(B,{open:b,onOpenChange:s=>c(s.open),children:[e.jsx(F,{}),e.jsx(N,{children:e.jsxs(U,{maxW:"400px",children:[e.jsxs(q,{children:[e.jsx(H,{children:"Job Creation Failed"}),e.jsx(_,{})]}),e.jsx(G,{children:e.jsxs(C,{gap:4,align:"stretch",children:[e.jsx(r,{color:"red.600",children:j}),e.jsx(R,{colorPalette:"red",onClick:()=>c(!1),w:"100%",children:"Close"})]})})]})})]}),e.jsxs(B,{open:fe,onOpenChange:s=>{s.open||te()},children:[e.jsx(F,{}),e.jsx(N,{children:e.jsxs(U,{maxW:"400px",children:[e.jsxs(q,{children:[e.jsx(H,{children:"Job Started Successfully"}),e.jsx(_,{})]}),e.jsx(G,{children:p&&e.jsxs(C,{gap:4,align:"stretch",children:[e.jsx(t,{children:e.jsxs(C,{gap:2,align:"stretch",children:[e.jsxs(t,{children:[e.jsx(r,{fontSize:"sm",fontWeight:"semibold",color:"fg.default",display:"inline",children:"Job ID: "}),e.jsx(r,{fontSize:"sm",fontFamily:"mono",color:"blue.600",cursor:"pointer",_hover:{textDecoration:"underline"},onClick:s=>{s.preventDefault(),window.open(`/job/${p.jobGuid}`,"_blank")},display:"inline",children:p.jobGuid})]}),e.jsxs(t,{children:[e.jsx(r,{fontSize:"sm",fontWeight:"semibold",color:"fg.default",display:"inline",children:"Provider: "}),e.jsx(r,{fontSize:"sm",color:"blue.600",fontFamily:"mono",display:"inline",children:p.translationProvider})]}),e.jsxs(t,{children:[e.jsx(r,{fontSize:"sm",fontWeight:"semibold",color:"fg.default",display:"inline",children:"Language Pair: "}),e.jsxs(r,{fontSize:"sm",color:"purple.600",fontWeight:"medium",display:"inline",children:[p.sourceLang," → ",p.targetLang]})]}),e.jsxs(t,{children:[e.jsx(r,{fontSize:"sm",fontWeight:"semibold",color:"fg.default",display:"inline",children:"Status: "}),e.jsx(r,{fontSize:"sm",fontWeight:"bold",color:p.status==="completed"?"green.600":"orange.600",display:"inline",children:p.status.toUpperCase()})]}),p.statusDescription&&e.jsxs(t,{children:[e.jsx(r,{fontSize:"sm",fontWeight:"semibold",color:"fg.default",mb:1,children:"Description:"}),e.jsx(r,{fontSize:"sm",color:"fg.muted",pl:2,borderLeft:"2px",borderColor:"blue.200",children:ne(p.statusDescription)})]})]})}),e.jsx(t,{children:e.jsx(R,{colorPalette:"blue",onClick:te,w:"100%",children:"Close & Remove TUs from Cart"})})]})})]})})]})]})};export{qe as C,He as E,Ye as L,_e as P,Ge as S,Qe as a,Ke as b,Ve as c,Ze as d,Xe as e,Y as f,et as g,ne as r};
