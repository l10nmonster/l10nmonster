import{r as d,m as I,j as e,f as je,g as Ce,h as ve,i as ke,E as Pe,b as A,d as Se,k as we,l as q,n as ye,o as Re,p as ze,u as Be,B as i,S as E,T as a,F as N,e as We}from"./index-7BvmfFYo.js";import{A as Ie}from"./namespace-DnzAbJc8.js";import{c as Fe,Q as Ne,u as Ae,f as Oe}from"./api-lUcpjS_e.js";import{c as Z,a as F,e as V,u as Te,b as Ge,d as Ee,n as De}from"./index-DYRyEtJ_.js";import{u as M}from"./use-field-context-BUNHqjYw.js";import{u as Ve}from"./use-presence-context-BX_JHICA.js";import{V as k}from"./v-stack-CIRZgxKK.js";import{T as U,a as $,b as Q,c as H,d as J}from"./tooltip-CJa6_LB4.js";const[ee,O]=Z({name:"CheckboxContext",hookName:"useCheckboxContext",providerName:"<CheckboxProvider />"}),te=d.forwardRef((r,o)=>{const s=O(),n=I(s.getControlProps(),r);return e.jsx(F.div,{...n,ref:o})});te.displayName="CheckboxControl";function Me(r){const{value:o,onChange:s,defaultValue:n}=r,[c,x]=d.useState(n),l=o!==void 0,p=l?o:c,b=d.useCallback(m=>(l||x(m),s?.(m)),[l,s]);return[p,b]}function Le(r={}){const{defaultValue:o,value:s,onValueChange:n,disabled:c,readOnly:x,name:l,invalid:p}=r,b=!(c||x),m=Ve(n,{sync:!0}),[j,h]=Me({value:s,defaultValue:o||[],onChange:m}),C=f=>j.some(B=>String(B)===String(f)),z=f=>{C(f)?T(f):R(f)},R=f=>{b&&(C(f)||h(j.concat(f)))},T=f=>{b&&h(j.filter(B=>String(B)!==String(f)))};return{isChecked:C,value:j,name:l,disabled:!!c,readOnly:!!x,invalid:!!p,setValue:h,addValue:R,toggleValue:z,getItemProps:f=>({checked:f.value!=null?C(f.value):void 0,onCheckedChange(){f.value!=null&&z(f.value)},name:l,disabled:c,readOnly:x,invalid:p})}}const[qe,Ue]=Z({name:"CheckboxGroupContext",hookName:"useCheckboxGroupContext",providerName:"<CheckboxGroupProvider />",strict:!1}),re=d.forwardRef((r,o)=>{const[s,n]=V()(r,["defaultValue","value","onValueChange","disabled","invalid","readOnly","name"]),c=Le(s);return e.jsx(qe,{value:c,children:e.jsx(F.div,{ref:o,role:"group",...n,...je.build().group.attrs})})});re.displayName="CheckboxGroup";const oe=d.forwardRef((r,o)=>{const s=O(),n=I(s.getHiddenInputProps(),r),c=M();return e.jsx(F.input,{"aria-describedby":c?.ariaDescribedby,...n,ref:o})});oe.displayName="CheckboxHiddenInput";const se=d.forwardRef((r,o)=>{const s=O(),n=I(s.getLabelProps(),r);return e.jsx(F.span,{...n,ref:o})});se.displayName="CheckboxLabel";const $e=(r={})=>{const o=Ue(),s=M(),n=d.useMemo(()=>I(r,o?.getItemProps({value:r.value})??{}),[r,o]),c=d.useId(),{getRootNode:x}=Te(),{dir:l}=Ge(),p={id:c,ids:{label:s?.ids.label,hiddenInput:s?.ids.control},dir:l,disabled:s?.disabled,readOnly:s?.readOnly,invalid:s?.invalid,required:s?.required,getRootNode:x,...n},b=Ee(ve,p);return Ce(b,De)},ne=d.forwardRef((r,o)=>{const[s,n]=V()(r,["checked","defaultChecked","disabled","form","id","ids","invalid","name","onCheckedChange","readOnly","required","value"]),c=$e(s),x=I(c.getRootProps(),n);return e.jsx(ee,{value:c,children:e.jsx(F.label,{...x,ref:o})})});ne.displayName="CheckboxRoot";const ie=d.forwardRef((r,o)=>{const[{value:s},n]=V()(r,["value"]),c=I(s.getRootProps(),n);return e.jsx(ee,{value:s,children:e.jsx(F.label,{...c,ref:o})})});ie.displayName="CheckboxRootProvider";const le=d.forwardRef((r,o)=>{const s=M(),n=I(s?.getInputProps(),r);return e.jsx(F.input,{...n,ref:o})});le.displayName="FieldInput";const Qe=d.forwardRef(function(o,s){const n=ke({key:"checkmark",recipe:o.recipe}),[c,x]=n.splitVariantProps(o),{checked:l,indeterminate:p,disabled:b,unstyled:m,children:j,...h}=x,C=m?Pe:n(c);return e.jsx(A.svg,{ref:s,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3px",strokeLinecap:"round",strokeLinejoin:"round","data-state":p?"indeterminate":l?"checked":"unchecked","data-disabled":Se(b),css:[C,o.css],...h,children:p?e.jsx("path",{d:"M5 12h14"}):l?e.jsx("polyline",{points:"20 6 9 17 4 12"}):null})}),{withProvider:ae,withContext:ce,useStyles:He}=Fe({key:"checkbox"});ae(ie,"root",{forwardAsChild:!0});const _=ae(ne,"root",{forwardAsChild:!0});ce(se,"label",{forwardAsChild:!0});const Je=d.forwardRef(function(o,s){const{checked:n,indeterminate:c,...x}=o,l=O(),p=He();return n&&l.checked?e.jsx(A.svg,{ref:s,asChild:!0,...x,css:[p.indicator,o.css],children:n}):c&&l.indeterminate?e.jsx(A.svg,{ref:s,asChild:!0,...x,css:[p.indicator,o.css],children:c}):e.jsx(Qe,{ref:s,checked:l.checked,indeterminate:l.indeterminate,disabled:l.disabled,unstyled:!0,...x,css:[p.indicator,o.css]})}),K=ce(te,"control",{forwardAsChild:!0,defaultProps:{children:e.jsx(Je,{})}});A(re,{base:{display:"flex",flexDirection:"column",gap:"1.5"}},{forwardAsChild:!0});const Y=oe,{withContext:_e}=we({key:"input"}),y=_e(le);var Ke=class extends Ne{constructor(r,o){super(r,o)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(r){super.setOptions({...r,behavior:q()})}getOptimisticResult(r){return r.behavior=q(),super.getOptimisticResult(r)}fetchNextPage(r){return this.fetch({...r,meta:{fetchMore:{direction:"forward"}}})}fetchPreviousPage(r){return this.fetch({...r,meta:{fetchMore:{direction:"backward"}}})}createResult(r,o){const{state:s}=r,n=super.createResult(r,o),{isFetching:c,isRefetching:x,isError:l,isRefetchError:p}=n,b=s.fetchMeta?.fetchMore?.direction,m=l&&b==="forward",j=c&&b==="forward",h=l&&b==="backward",C=c&&b==="backward";return{...n,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:Re(o,s.data),hasPreviousPage:ye(o,s.data),isFetchNextPageError:m,isFetchingNextPage:j,isFetchPreviousPageError:h,isFetchingPreviousPage:C,isRefetchError:p&&!m&&!h,isRefetching:x&&!j&&!C}}};function Ye(r,o){return Ae(r,Ke)}function D(r){return r.map(o=>typeof o=="string"?o:`{{${o.t}}}`).join("")}function X(r){return new Date(r).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"})}const it=()=>{const{sourceLang:r,targetLang:o}=ze();Be();const[s,n]=d.useState(new Set),[c,x]=d.useState({guid:"",rid:"",sid:"",nsrc:"",ntgt:"",q:"",translationProvider:"",ts:"",jobGuid:""}),[l,p]=d.useState({guid:"",rid:"",sid:"",nsrc:"",ntgt:"",q:"",translationProvider:"",ts:"",jobGuid:""}),b=d.useRef(),m=d.useRef(),j=d.useRef(null),h=d.useRef({}),C=d.useMemo(()=>["tmSearch",r,o,c],[r,o,c]),{data:z,isLoading:R,isError:T,error:L,fetchNextPage:f,hasNextPage:B,isFetchingNextPage:G}=Ye({queryKey:C,queryFn:async({pageParam:t=1})=>{const u=new URLSearchParams({sourceLang:r,targetLang:o,page:t.toString(),limit:"100",...Object.fromEntries(Object.entries(c).filter(([W,me])=>me.trim()!==""))});return await Oe(`/api/tm/search?${u}`)},getNextPageParam:(t,u)=>t.data.length===parseInt(t.limit)?u.length+1:void 0,staleTime:3e4,refetchOnWindowFocus:!1,placeholderData:t=>t}),v=d.useMemo(()=>z?.pages.flatMap(t=>t.data)||[],[z]),de=d.useCallback(t=>{R||G||(b.current&&b.current.disconnect(),b.current=new IntersectionObserver(u=>{u[0].isIntersecting&&B&&f()}),t&&b.current.observe(t))},[R,G,B,f]),P=d.useCallback(t=>{j.current=t},[]),S=d.useCallback(()=>{j.current=null},[]),w=d.useCallback((t,u)=>{p(g=>({...g,[t]:u})),n(new Set),clearTimeout(m.current),m.current=setTimeout(()=>{x(g=>({...g,[t]:u}))},300)},[]),ue=(t,u)=>{const g=new Set(s);u?g.add(t):g.delete(t),n(g)},he=t=>{if(t){const u=new Set(v.map((g,W)=>W));n(u)}else n(new Set)},xe=()=>{const t=sessionStorage.getItem("tmCart");return t?JSON.parse(t):{}},be=t=>{sessionStorage.setItem("tmCart",JSON.stringify(t))},fe=()=>{const t=xe(),u=`${r}|${o}`;t[u]||(t[u]={sourceLang:r,targetLang:o,tus:[]});const g=Array.from(s).map(W=>v[W]);t[u].tus.push(...g),be(t),n(new Set),window.dispatchEvent(new Event("cartUpdated"))},pe=v.length>0&&s.size===v.length,ge=s.size>0&&s.size<v.length;return d.useEffect(()=>{if(j.current&&h.current[j.current]){const t=h.current[j.current];setTimeout(()=>{if(t&&document.contains(t)){t.focus();const u=t.value.length;t.setSelectionRange(u,u)}},10)}},[v]),d.useEffect(()=>()=>{m.current&&clearTimeout(m.current)},[]),R&&v.length===0&&!z?e.jsx(i,{display:"flex",justifyContent:"center",mt:10,children:e.jsx(E,{size:"xl"})}):T?e.jsx(i,{mt:5,px:6,children:e.jsx(Ie,{status:"error",children:e.jsxs(i,{children:[e.jsx(a,{fontWeight:"bold",children:"Error"}),e.jsx(a,{children:L?.message||"Failed to fetch translation memory data"})]})})}):e.jsx(i,{py:6,px:6,children:e.jsxs(k,{gap:6,align:"stretch",children:[e.jsxs(i,{children:[e.jsxs(N,{align:"center",justify:"space-between",mb:2,children:[e.jsxs(N,{align:"center",gap:3,children:[e.jsxs(a,{fontSize:"2xl",fontWeight:"bold",children:["Translation Memory: ",r," â†’ ",o]}),R&&e.jsx(E,{size:"sm"})]}),s.size>0&&e.jsxs(We,{colorPalette:"blue",onClick:fe,children:["Add to Cart (",s.size," ",s.size===1?"TU":"TUs",")"]})]}),e.jsx(a,{color:"fg.muted",children:"Detailed view of translation units"})]}),e.jsxs(i,{bg:"white",borderRadius:"lg",shadow:"sm",overflow:"auto",maxH:"70vh",children:[e.jsxs(i,{as:"table",w:"100%",fontSize:"sm",children:[e.jsx(i,{as:"thead",position:"sticky",top:0,bg:"blue.subtle",zIndex:1,borderBottom:"2px",borderColor:"blue.muted",shadow:"sm",children:e.jsxs(i,{as:"tr",children:[e.jsx(i,{as:"th",p:3,borderBottom:"1px",borderColor:"border.default",minW:"60px",textAlign:"center",children:e.jsxs(_,{checked:pe,onCheckedChange:t=>he(t.checked),children:[e.jsx(Y,{ref:t=>{t&&(t.indeterminate=ge)}}),e.jsx(K,{})]})}),e.jsx(i,{as:"th",p:3,borderBottom:"1px",borderColor:"border.default",minW:"120px",textAlign:"left",children:e.jsxs(k,{gap:2,align:"stretch",children:[e.jsx(a,{fontSize:"sm",fontWeight:"bold",color:"blue.600",children:"GUID"}),e.jsx(y,{size:"xs",placeholder:"Filter GUID...",value:l.guid,onChange:t=>w("guid",t.target.value),onFocus:()=>P("guid"),onBlur:S,ref:t=>{t&&(h.current.guid=t)},bg:"yellow.subtle"},"guid-input")]})}),e.jsx(i,{as:"th",p:3,borderBottom:"1px",borderColor:"border.default",minW:"120px",textAlign:"left",children:e.jsxs(k,{gap:2,align:"stretch",children:[e.jsx(a,{fontSize:"sm",fontWeight:"bold",color:"blue.600",children:"JOB GUID"}),e.jsx(y,{size:"xs",placeholder:"Filter Job GUID...",value:l.jobGuid,onChange:t=>w("jobGuid",t.target.value),onFocus:()=>P("jobGuid"),onBlur:S,ref:t=>{t&&(h.current.jobGuid=t)},bg:"yellow.subtle"},"jobGuid-input")]})}),e.jsx(i,{as:"th",p:3,borderBottom:"1px",borderColor:"border.default",minW:"150px",textAlign:"left",children:e.jsxs(k,{gap:2,align:"stretch",children:[e.jsx(a,{fontSize:"sm",fontWeight:"bold",color:"blue.600",children:"RID"}),e.jsx(y,{size:"xs",placeholder:"Filter RID...",value:l.rid,onChange:t=>w("rid",t.target.value),onFocus:()=>P("rid"),onBlur:S,ref:t=>{t&&(h.current.rid=t)},bg:"yellow.subtle"},"rid-input")]})}),e.jsx(i,{as:"th",p:3,borderBottom:"1px",borderColor:"border.default",minW:"150px",textAlign:"left",children:e.jsxs(k,{gap:2,align:"stretch",children:[e.jsx(a,{fontSize:"sm",fontWeight:"bold",color:"blue.600",children:"SID"}),e.jsx(y,{size:"xs",placeholder:"Filter SID...",value:l.sid,onChange:t=>w("sid",t.target.value),onFocus:()=>P("sid"),onBlur:S,ref:t=>{t&&(h.current.sid=t)},bg:"yellow.subtle"},"sid-input")]})}),e.jsx(i,{as:"th",p:3,borderBottom:"1px",borderColor:"border.default",minW:"350px",textAlign:"left",children:e.jsxs(k,{gap:2,align:"stretch",children:[e.jsx(a,{fontSize:"sm",fontWeight:"bold",color:"blue.600",children:"NSRC"}),e.jsx(y,{size:"xs",placeholder:"Filter source...",value:l.nsrc,onChange:t=>w("nsrc",t.target.value),onFocus:()=>P("nsrc"),onBlur:S,ref:t=>{t&&(h.current.nsrc=t)},bg:"yellow.subtle",dir:r?.startsWith("he")||r?.startsWith("ar")?"rtl":"ltr"},"nsrc-input")]})}),e.jsx(i,{as:"th",p:3,borderBottom:"1px",borderColor:"border.default",minW:"350px",textAlign:"left",children:e.jsxs(k,{gap:2,align:"stretch",children:[e.jsx(a,{fontSize:"sm",fontWeight:"bold",color:"blue.600",children:"NTGT"}),e.jsx(y,{size:"xs",placeholder:"Filter target...",value:l.ntgt,onChange:t=>w("ntgt",t.target.value),onFocus:()=>P("ntgt"),onBlur:S,ref:t=>{t&&(h.current.ntgt=t)},bg:"yellow.subtle",dir:o?.startsWith("he")||o?.startsWith("ar")?"rtl":"ltr"},"ntgt-input")]})}),e.jsx(i,{as:"th",p:3,borderBottom:"1px",borderColor:"border.default",minW:"40px",textAlign:"left",children:e.jsxs(k,{gap:2,align:"stretch",children:[e.jsx(a,{fontSize:"sm",fontWeight:"bold",color:"blue.600",children:"Q"}),e.jsx(y,{size:"xs",placeholder:"Quality...",value:l.q,onChange:t=>w("q",t.target.value),onFocus:()=>P("q"),onBlur:S,ref:t=>{t&&(h.current.q=t)},bg:"yellow.subtle"},"q-input")]})}),e.jsx(i,{as:"th",p:3,borderBottom:"1px",borderColor:"border.default",minW:"120px",textAlign:"left",children:e.jsxs(k,{gap:2,align:"stretch",children:[e.jsx(a,{fontSize:"sm",fontWeight:"bold",color:"blue.600",children:"Provider"}),e.jsx(y,{size:"xs",placeholder:"Provider...",value:l.translationProvider,onChange:t=>w("translationProvider",t.target.value),onFocus:()=>P("translationProvider"),onBlur:S,ref:t=>{t&&(h.current.translationProvider=t)},bg:"yellow.subtle"},"translationProvider-input")]})}),e.jsx(i,{as:"th",p:3,borderBottom:"1px",borderColor:"border.default",minW:"120px",textAlign:"left",children:e.jsxs(k,{gap:2,align:"stretch",children:[e.jsx(a,{fontSize:"sm",fontWeight:"bold",color:"blue.600",children:"Timestamp"}),e.jsx(y,{size:"xs",placeholder:"Date...",value:l.ts,onChange:t=>w("ts",t.target.value),onFocus:()=>P("ts"),onBlur:S,ref:t=>{t&&(h.current.ts=t)},bg:"yellow.subtle"},"ts-input")]})})]})}),e.jsx(i,{as:"tbody",children:v.map((t,u)=>e.jsxs(i,{as:"tr",ref:u===v.length-20?de:null,_hover:{bg:"gray.subtle"},children:[e.jsx(i,{as:"td",p:3,borderBottom:"1px",borderColor:"border.subtle",textAlign:"center",children:e.jsxs(_,{checked:s.has(u),onCheckedChange:g=>ue(u,g.checked),children:[e.jsx(Y,{}),e.jsx(K,{})]})}),e.jsx(i,{as:"td",p:3,borderBottom:"1px",borderColor:"border.subtle",children:e.jsx(a,{fontSize:"xs",fontFamily:"mono",color:"blue.600",userSelect:"all",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxW:"100px",children:t.guid})}),e.jsx(i,{as:"td",p:3,borderBottom:"1px",borderColor:"border.subtle",children:e.jsx(a,{fontSize:"xs",fontFamily:"mono",color:"green.600",userSelect:"all",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxW:"100px",children:t.jobGuid})}),e.jsx(i,{as:"td",p:3,borderBottom:"1px",borderColor:"border.subtle",children:e.jsx(a,{fontSize:"xs",wordBreak:"break-all",whiteSpace:"normal",children:t.rid})}),e.jsx(i,{as:"td",p:3,borderBottom:"1px",borderColor:"border.subtle",children:e.jsx(a,{fontSize:"xs",wordBreak:"break-all",whiteSpace:"normal",children:t.sid})}),e.jsx(i,{as:"td",p:3,borderBottom:"1px",borderColor:"border.subtle",children:t.notes?e.jsxs(U,{children:[e.jsx($,{asChild:!0,children:e.jsx(a,{fontSize:"xs",noOfLines:2,cursor:"help",dir:r?.startsWith("he")||r?.startsWith("ar")?"rtl":"ltr",children:D(t.nsrc)})}),e.jsx(Q,{children:e.jsxs(H,{maxW:"400px",bg:"yellow.100",borderWidth:"1px",borderColor:"yellow.300",shadow:"lg",children:[e.jsx(J,{}),e.jsxs(i,{children:[t.notes.desc&&e.jsx(a,{fontSize:"sm",mb:2,whiteSpace:"pre-wrap",color:"black",children:t.notes.desc}),t.notes.ph&&e.jsxs(i,{children:[e.jsx(a,{fontSize:"xs",fontWeight:"bold",color:"gray.600",mb:1,children:"Placeholders:"}),Object.entries(t.notes.ph).map(([g,W])=>e.jsxs(i,{mb:1,children:[e.jsx(a,{fontSize:"xs",fontFamily:"mono",color:"blue.600",children:g}),e.jsxs(a,{fontSize:"xs",color:"gray.600",children:[W.desc," (e.g., ",W.sample,")"]})]},g))]})]})]})})]}):e.jsx(a,{fontSize:"xs",noOfLines:2,dir:r?.startsWith("he")||r?.startsWith("ar")?"rtl":"ltr",children:D(t.nsrc)})}),e.jsx(i,{as:"td",p:3,borderBottom:"1px",borderColor:"border.subtle",children:e.jsx(a,{fontSize:"xs",noOfLines:2,dir:o?.startsWith("he")||o?.startsWith("ar")?"rtl":"ltr",children:D(t.ntgt)})}),e.jsx(i,{as:"td",p:3,borderBottom:"1px",borderColor:"border.subtle",children:e.jsx(a,{fontSize:"xs",children:t.q})}),e.jsx(i,{as:"td",p:3,borderBottom:"1px",borderColor:"border.subtle",children:e.jsx(a,{fontSize:"xs",children:t.translationProvider})}),e.jsx(i,{as:"td",p:3,borderBottom:"1px",borderColor:"border.subtle",children:e.jsxs(U,{children:[e.jsx($,{asChild:!0,children:e.jsx(a,{fontSize:"xs",color:"fg.muted",cursor:"help",children:X(t.ts)})}),e.jsx(Q,{children:e.jsxs(H,{children:[e.jsx(J,{}),e.jsxs(a,{fontSize:"sm",children:["Job Date: ",X(t.updatedAt)]})]})})]})})]},`${t.guid}-${u}`))})]}),G&&e.jsx(N,{justify:"center",p:4,children:e.jsx(E,{size:"md"})}),!B&&v.length>0&&e.jsx(N,{justify:"center",p:4,children:e.jsx(a,{color:"fg.muted",fontSize:"sm",children:"No more results"})}),v.length===0&&!R&&e.jsx(N,{justify:"center",p:8,children:e.jsx(a,{color:"fg.muted",children:"No translation units found for the current filters"})})]})]})})};export{it as default};
