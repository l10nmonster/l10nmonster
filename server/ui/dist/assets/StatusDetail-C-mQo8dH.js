import{a9 as K,u as _,a1 as q,r as a,k as H,j as e,B as t,S as v,A as M,T as o,F,a as Q,aa as R,ab as A,ac as I,V as f,K as b,L as X,c as Y,d as Z,e as ee,f as re,g as te,h as oe}from"./vendor-BCzBv13G.js";import{f as se}from"./index-DQZVXQUG.js";function B(j){return j.map(l=>typeof l=="string"?l:`{{${l.t}}}`).join("")}const ae=()=>{const{channelId:j,sourceLang:l,targetLang:m}=K();_();const[T]=q(),S=T.get("prj"),[d,C]=a.useState(new Set),[k,L]=a.useState({guid:"",channel:"",prj:"",rid:"",sid:"",nsrc:"",group:""}),[u,$]=a.useState({guid:"",channel:"",prj:"",rid:"",sid:"",nsrc:"",group:""}),z=a.useRef(),w=a.useRef(null),c=a.useRef({}),{data:y=[],isLoading:W,isError:D,error:O}=H({queryKey:["statusDetail",j,l,m,S],queryFn:()=>se(`/api/status/${j}/${l}/${m}${S?`?prj=${encodeURIComponent(S)}`:""}`)}),h=a.useMemo(()=>y.length?y.filter(r=>Object.entries(k).every(([s,n])=>{if(!n.trim())return!0;const i=r[s];return i==null?!1:s==="nsrc"&&Array.isArray(i)?B(i).toLowerCase().includes(n.toLowerCase()):String(i).toLowerCase().includes(n.toLowerCase())})):[],[y,k]),x=a.useCallback(r=>{w.current=r},[]),p=a.useCallback(()=>{w.current=null},[]),g=a.useCallback((r,s)=>{$(n=>({...n,[r]:s})),C(new Set),clearTimeout(z.current),z.current=setTimeout(()=>{L(n=>({...n,[r]:s}))},300)},[]),P=(r,s)=>{const n=new Set(d);s?n.add(r):n.delete(r),C(n)},E=r=>{if(r){const s=new Set(h.map((n,i)=>i));C(s)}else C(new Set)},U=()=>{const r=sessionStorage.getItem("statusCart");return r?JSON.parse(r):{}},N=r=>{sessionStorage.setItem("statusCart",JSON.stringify(r))},V=()=>{const r=U(),s=`${l}|${m}`;r[s]||(r[s]={sourceLang:l,targetLang:m,tus:[]});const n=Array.from(d).map(i=>h[i]);r[s].tus.push(...n),N(r),C(new Set),window.dispatchEvent(new Event("cartUpdated"))},G=h.length>0&&d.size===h.length,J=d.size>0&&d.size<h.length;return a.useEffect(()=>{if(w.current&&c.current[w.current]){const r=c.current[w.current];setTimeout(()=>{if(r&&document.contains(r)){r.focus();const s=r.value.length;r.setSelectionRange(s,s)}},10)}},[h]),a.useEffect(()=>()=>{z.current&&clearTimeout(z.current)},[]),W?e.jsx(t,{display:"flex",justifyContent:"center",mt:10,children:e.jsx(v,{size:"xl"})}):D?e.jsx(t,{mt:5,px:6,children:e.jsx(M,{status:"error",children:e.jsxs(t,{children:[e.jsx(o,{fontWeight:"bold",children:"Error"}),e.jsx(o,{children:O?.message||"Failed to fetch status data"})]})})}):e.jsx(t,{py:6,px:6,children:e.jsxs(t,{p:6,borderWidth:"2px",borderRadius:"lg",bg:"white",borderColor:"green.200",children:[e.jsxs(t,{display:"flex",alignItems:"center",gap:6,flexWrap:"wrap",mb:6,pb:4,borderBottom:"2px",borderColor:"green.100",children:[e.jsxs(t,{children:[e.jsx(o,{fontSize:"sm",color:"fg.muted",mb:1,children:"Channel"}),e.jsx(o,{fontSize:"lg",fontWeight:"bold",color:"green.600",children:j})]}),e.jsxs(t,{children:[e.jsx(o,{fontSize:"sm",color:"fg.muted",mb:1,children:"Language Pair"}),e.jsxs(F,{align:"center",gap:2,children:[e.jsxs(o,{fontSize:"lg",fontWeight:"semibold",color:"blue.600",children:[l," â†’ ",m]}),W&&e.jsx(v,{size:"sm"})]})]}),S&&e.jsxs(t,{children:[e.jsx(o,{fontSize:"sm",color:"fg.muted",mb:1,children:"Project"}),e.jsx(o,{fontSize:"lg",fontWeight:"semibold",color:"purple.600",children:S})]}),e.jsxs(t,{children:[e.jsx(o,{fontSize:"sm",color:"fg.muted",mb:1,children:"Translation Units"}),e.jsxs(o,{fontSize:"lg",fontWeight:"medium",children:[h.length," of ",y.length," shown"]})]}),e.jsx(t,{ml:"auto",children:d.size>0&&e.jsxs(Q,{colorPalette:"blue",onClick:V,children:["Add to Cart (",d.size," ",d.size===1?"TU":"TUs",")"]})})]}),e.jsxs(t,{bg:"white",borderRadius:"lg",shadow:"sm",overflow:"auto",h:"calc(100vh - 250px)",children:[e.jsxs(t,{as:"table",w:"100%",fontSize:"sm",children:[e.jsx(t,{as:"thead",position:"sticky",top:0,bg:"orange.subtle",zIndex:1,borderBottom:"2px",borderColor:"orange.muted",shadow:"sm",children:e.jsxs(t,{as:"tr",children:[e.jsx(t,{as:"th",p:3,borderBottom:"1px",borderColor:"border.default",minW:"60px",textAlign:"center",children:e.jsxs(R,{checked:G,onCheckedChange:r=>E(r.checked),children:[e.jsx(A,{ref:r=>{r&&(r.indeterminate=J)}}),e.jsx(I,{})]})}),e.jsx(t,{as:"th",p:3,borderBottom:"1px",borderColor:"border.default",minW:"120px",textAlign:"left",children:e.jsxs(f,{gap:2,align:"stretch",children:[e.jsx(o,{fontSize:"sm",fontWeight:"bold",color:"orange.600",children:"GUID"}),e.jsx(b,{size:"xs",placeholder:"Filter GUID...",value:u.guid,onChange:r=>g("guid",r.target.value),onFocus:()=>x("guid"),onBlur:p,ref:r=>{r&&(c.current.guid=r)},bg:"yellow.subtle"},"guid-input")]})}),e.jsx(t,{as:"th",p:3,borderBottom:"1px",borderColor:"border.default",minW:"120px",textAlign:"left",children:e.jsxs(f,{gap:2,align:"stretch",children:[e.jsx(o,{fontSize:"sm",fontWeight:"bold",color:"orange.600",children:"CHANNEL"}),e.jsx(b,{size:"xs",placeholder:"Filter channel...",value:u.channel,onChange:r=>g("channel",r.target.value),onFocus:()=>x("channel"),onBlur:p,ref:r=>{r&&(c.current.channel=r)},bg:"yellow.subtle"},"channel-input")]})}),e.jsx(t,{as:"th",p:3,borderBottom:"1px",borderColor:"border.default",minW:"120px",textAlign:"left",children:e.jsxs(f,{gap:2,align:"stretch",children:[e.jsx(o,{fontSize:"sm",fontWeight:"bold",color:"orange.600",children:"PRJ"}),e.jsx(b,{size:"xs",placeholder:"Filter project...",value:u.prj,onChange:r=>g("prj",r.target.value),onFocus:()=>x("prj"),onBlur:p,ref:r=>{r&&(c.current.prj=r)},bg:"yellow.subtle"},"prj-input")]})}),e.jsx(t,{as:"th",p:3,borderBottom:"1px",borderColor:"border.default",minW:"150px",textAlign:"left",children:e.jsxs(f,{gap:2,align:"stretch",children:[e.jsx(o,{fontSize:"sm",fontWeight:"bold",color:"orange.600",children:"RID"}),e.jsx(b,{size:"xs",placeholder:"Filter RID...",value:u.rid,onChange:r=>g("rid",r.target.value),onFocus:()=>x("rid"),onBlur:p,ref:r=>{r&&(c.current.rid=r)},bg:"yellow.subtle"},"rid-input")]})}),e.jsx(t,{as:"th",p:3,borderBottom:"1px",borderColor:"border.default",minW:"150px",textAlign:"left",children:e.jsxs(f,{gap:2,align:"stretch",children:[e.jsx(o,{fontSize:"sm",fontWeight:"bold",color:"orange.600",children:"SID"}),e.jsx(b,{size:"xs",placeholder:"Filter SID...",value:u.sid,onChange:r=>g("sid",r.target.value),onFocus:()=>x("sid"),onBlur:p,ref:r=>{r&&(c.current.sid=r)},bg:"yellow.subtle"},"sid-input")]})}),e.jsx(t,{as:"th",p:3,borderBottom:"1px",borderColor:"border.default",minW:"350px",textAlign:"left",children:e.jsxs(f,{gap:2,align:"stretch",children:[e.jsx(o,{fontSize:"sm",fontWeight:"bold",color:"orange.600",children:"NSRC"}),e.jsx(b,{size:"xs",placeholder:"Filter source...",value:u.nsrc,onChange:r=>g("nsrc",r.target.value),onFocus:()=>x("nsrc"),onBlur:p,ref:r=>{r&&(c.current.nsrc=r)},bg:"yellow.subtle",dir:l?.startsWith("he")||l?.startsWith("ar")?"rtl":"ltr"},"nsrc-input")]})}),e.jsx(t,{as:"th",p:3,borderBottom:"1px",borderColor:"border.default",minW:"120px",textAlign:"left",children:e.jsxs(f,{gap:2,align:"stretch",children:[e.jsx(o,{fontSize:"sm",fontWeight:"bold",color:"orange.600",children:"GROUP"}),e.jsx(b,{size:"xs",placeholder:"Filter group...",value:u.group,onChange:r=>g("group",r.target.value),onFocus:()=>x("group"),onBlur:p,ref:r=>{r&&(c.current.group=r)},bg:"yellow.subtle"},"group-input")]})})]})}),e.jsx(t,{as:"tbody",children:h.map((r,s)=>e.jsxs(t,{as:"tr",_hover:{bg:"gray.subtle"},children:[e.jsx(t,{as:"td",p:3,borderBottom:"1px",borderColor:"border.subtle",textAlign:"center",children:e.jsxs(R,{checked:d.has(s),onCheckedChange:n=>P(s,n.checked),children:[e.jsx(A,{}),e.jsx(I,{})]})}),e.jsx(t,{as:"td",p:3,borderBottom:"1px",borderColor:"border.subtle",children:e.jsx(o,{fontSize:"xs",fontFamily:"mono",color:"orange.600",userSelect:"all",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxW:"100px",children:r.guid})}),e.jsx(t,{as:"td",p:3,borderBottom:"1px",borderColor:"border.subtle",children:e.jsx(o,{fontSize:"xs",children:r.channel})}),e.jsx(t,{as:"td",p:3,borderBottom:"1px",borderColor:"border.subtle",children:e.jsx(o,{fontSize:"xs",children:r.prj})}),e.jsx(t,{as:"td",p:3,borderBottom:"1px",borderColor:"border.subtle",children:e.jsx(X,{as:Y,to:`/sources/${r.channel}?rid=${encodeURIComponent(r.rid)}`,fontSize:"xs",fontFamily:"mono",color:"blue.600",wordBreak:"break-all",whiteSpace:"normal",_hover:{textDecoration:"underline"},children:r.rid})}),e.jsx(t,{as:"td",p:3,borderBottom:"1px",borderColor:"border.subtle",children:e.jsx(o,{fontSize:"xs",wordBreak:"break-all",whiteSpace:"normal",children:r.sid})}),e.jsx(t,{as:"td",p:3,borderBottom:"1px",borderColor:"border.subtle",children:r.notes&&(r.notes.desc?.trim()||r.notes.ph&&Object.keys(r.notes.ph).length>0)?e.jsxs(Z,{children:[e.jsx(ee,{asChild:!0,children:e.jsx(o,{fontSize:"xs",noOfLines:2,cursor:"help",dir:l?.startsWith("he")||l?.startsWith("ar")?"rtl":"ltr",children:B(r.nsrc)})}),e.jsx(re,{children:e.jsxs(te,{maxW:"400px",bg:"yellow.100",borderWidth:"1px",borderColor:"yellow.300",shadow:"lg",children:[e.jsx(oe,{}),e.jsxs(t,{children:[r.notes.desc?.trim()&&e.jsx(o,{fontSize:"sm",mb:2,whiteSpace:"pre-wrap",color:"black",children:r.notes.desc}),r.notes.ph&&Object.keys(r.notes.ph).length>0&&e.jsxs(t,{children:[e.jsx(o,{fontSize:"xs",fontWeight:"bold",color:"gray.600",mb:1,children:"Placeholders:"}),Object.entries(r.notes.ph).map(([n,i])=>e.jsxs(t,{mb:1,children:[e.jsx(o,{fontSize:"xs",fontFamily:"mono",color:"blue.600",children:n}),e.jsxs(o,{fontSize:"xs",color:"gray.600",children:[i.desc," (e.g., ",i.sample,")"]})]},n))]})]})]})})]}):e.jsx(o,{fontSize:"xs",noOfLines:2,dir:l?.startsWith("he")||l?.startsWith("ar")?"rtl":"ltr",children:B(r.nsrc)})}),e.jsx(t,{as:"td",p:3,borderBottom:"1px",borderColor:"border.subtle",children:e.jsx(o,{fontSize:"xs",children:r.group})})]},`${r.guid}-${s}`))})]}),h.length===0&&!W&&e.jsx(F,{justify:"center",p:8,children:e.jsx(o,{color:"fg.muted",children:"No untranslated content found for the current filters"})})]})]})})};export{ae as default};
