import{a8 as C,u as w,r as b,ad as B,j as e,B as r,S as g,A as z,T as n,L as v,h as M,g as D,F as E}from"./vendor-BVSmEsOp.js";import{a as I,f as L}from"./index-Dl1WS_Lc.js";const k=()=>{const{channelId:l,prj:f}=C(),p=w(),h=b.useRef(null),{data:j,isLoading:S,error:m,fetchNextPage:u,hasNextPage:d,isFetchingNextPage:x}=B({queryKey:["projectTOC",l,f],queryFn:async({pageParam:t=0})=>{const c=await L(`/api/channel/${l}/${f}?offset=${t}&limit=100`);return{data:c,offset:t,limit:100,hasMore:c.length===100}},getNextPageParam:t=>t.hasMore?t.offset+t.limit:void 0,staleTime:3e4}),a=j?.pages.flatMap(t=>t.data)||[];b.useEffect(()=>{if(!d||x)return;const t=new IntersectionObserver(s=>{s[0].isIntersecting&&u()},{rootMargin:"100px",threshold:0});return h.current&&t.observe(h.current),()=>t.disconnect()},[d,x,u]);const A=t=>new Date(t).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"}),y=t=>{const s=new Date,c=new Date(t),o=Math.floor((s-c)/1e3),i=new Intl.RelativeTimeFormat("en",{numeric:"auto",style:"short"});return o<60?i.format(-o,"second"):o<3600?i.format(-Math.floor(o/60),"minute"):o<86400?i.format(-Math.floor(o/3600),"hour"):o<2592e3?i.format(-Math.floor(o/86400),"day"):o<31536e3?i.format(-Math.floor(o/2592e3),"month"):i.format(-Math.floor(o/31536e3),"year")};return S?e.jsx(r,{display:"flex",justifyContent:"center",mt:10,children:e.jsx(g,{size:"xl"})}):m?e.jsx(r,{mt:5,px:6,children:e.jsx(z,{status:"error",children:e.jsxs(r,{children:[e.jsx(n,{fontWeight:"bold",children:"Error"}),e.jsx(n,{children:m?.message||"Failed to fetch project data"})]})})}):e.jsxs(r,{py:6,px:6,children:[e.jsx(I,{channelId:l,project:f,onBackClick:()=>p("/sources"),backLabel:"Back to sources"}),a.length===0?e.jsx(r,{p:8,borderWidth:"1px",borderRadius:"md",bg:"white",textAlign:"center",children:e.jsx(n,{color:"fg.muted",children:"No resources found for this project."})}):e.jsxs(r,{bg:"white",borderRadius:"lg",shadow:"sm",overflow:"auto",maxH:"78vh",children:[e.jsxs(r,{as:"table",w:"100%",fontSize:"sm",children:[e.jsx(r,{as:"thead",bg:"blue.subtle",borderBottom:"2px",borderColor:"blue.muted",position:"sticky",top:0,zIndex:1,children:e.jsxs(r,{as:"tr",children:[e.jsx(r,{as:"th",p:4,textAlign:"left",borderBottom:"1px",borderColor:"border.default",children:e.jsx(n,{fontSize:"sm",fontWeight:"bold",color:"blue.600",children:"RESOURCE ID"})}),e.jsx(r,{as:"th",p:4,textAlign:"left",borderBottom:"1px",borderColor:"border.default",children:e.jsx(n,{fontSize:"sm",fontWeight:"bold",color:"blue.600",children:"SOURCE LANGUAGE"})}),e.jsx(r,{as:"th",p:4,textAlign:"center",borderBottom:"1px",borderColor:"border.default",children:e.jsx(n,{fontSize:"sm",fontWeight:"bold",color:"blue.600",children:"SEGMENTS"})}),e.jsx(r,{as:"th",p:4,textAlign:"center",borderBottom:"1px",borderColor:"border.default",children:e.jsx(n,{fontSize:"sm",fontWeight:"bold",color:"blue.600",children:"LAST MODIFIED"})})]})}),e.jsx(r,{as:"tbody",children:a.sort((t,s)=>new Date(s.modifiedAt)-new Date(t.modifiedAt)).map((t,s)=>e.jsxs(r,{as:"tr",_hover:{bg:"gray.subtle"},children:[e.jsx(r,{as:"td",p:4,borderBottom:"1px",borderColor:"border.subtle",children:e.jsx(v,{as:M,to:`/sources/${l}?rid=${encodeURIComponent(t.rid)}`,fontSize:"sm",fontFamily:"mono",color:"blue.600",wordBreak:"break-all",_hover:{textDecoration:"underline"},children:t.rid})}),e.jsx(r,{as:"td",p:4,borderBottom:"1px",borderColor:"border.subtle",children:e.jsx(D,{colorPalette:"purple",size:"sm",children:t.sourceLang})}),e.jsx(r,{as:"td",p:4,borderBottom:"1px",borderColor:"border.subtle",textAlign:"center",children:e.jsx(n,{fontSize:"sm",fontWeight:"semibold",color:"orange.600",children:t.segmentCount.toLocaleString()})}),e.jsx(r,{as:"td",p:4,borderBottom:"1px",borderColor:"border.subtle",textAlign:"center",children:e.jsx(n,{fontSize:"sm",color:"fg.muted",title:A(t.modifiedAt),children:y(t.modifiedAt)})})]},`${t.rid}-${s}`))})]}),d&&e.jsx(r,{ref:h,p:4,textAlign:"center",children:x&&e.jsxs(E,{justify:"center",align:"center",gap:2,children:[e.jsx(g,{size:"sm"}),e.jsx(n,{fontSize:"sm",color:"fg.muted",children:"Loading more resources..."})]})}),!d&&a.length>0&&e.jsx(r,{p:4,textAlign:"center",children:e.jsxs(n,{fontSize:"sm",color:"fg.muted",children:["All ",a.length," resources loaded"]})})]})]})};export{k as default};
