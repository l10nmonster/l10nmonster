import{e as $,u as q,r as a,j as e,B as t,S as F,T as o,F as y,f as G}from"./index-CE6JgXwC.js";import{A as H}from"./namespace-DqVzlNZ0.js";import{C as v,a as A,b as k,I as j}from"./input-C_b-hL0i.js";import{V as x}from"./v-stack-BLV93Nj6.js";import{T as J,a as K,b as M,c as _,d as Q}from"./tooltip-DsbPmc5I.js";import{u as X}from"./useQuery-DJATtsyt.js";import{f as Y}from"./api-CQ_emPlI.js";import"./index-BHll-Wur.js";import"./use-field-context-DPgnX2eS.js";import"./use-presence-context-w7qGDwCc.js";function B(l){return l.map(c=>typeof c=="string"?c:`{{${c.t}}}`).join("")}const ce=()=>{const{sourceLang:l,targetLang:c}=$();q();const[u,m]=a.useState(new Set),[W,R]=a.useState({guid:"",channel:"",prj:"",rid:"",sid:"",nsrc:"",group:"",mf:""}),[p,T]=a.useState({guid:"",channel:"",prj:"",rid:"",sid:"",nsrc:"",group:"",mf:""}),S=a.useRef(),C=a.useRef(null),d=a.useRef({}),{data:w=[],isLoading:z,isError:I,error:D}=X({queryKey:["statusDetail",l,c],queryFn:()=>Y(`/api/status/${l}/${c}`)}),h=a.useMemo(()=>w.length?w.filter(r=>Object.entries(W).every(([s,n])=>{if(!n.trim())return!0;const i=r[s];return i==null?!1:s==="nsrc"&&Array.isArray(i)?B(i).toLowerCase().includes(n.toLowerCase()):String(i).toLowerCase().includes(n.toLowerCase())})):[],[w,W]),f=a.useCallback(r=>{C.current=r},[]),g=a.useCallback(()=>{C.current=null},[]),b=a.useCallback((r,s)=>{T(n=>({...n,[r]:s})),m(new Set),clearTimeout(S.current),S.current=setTimeout(()=>{R(n=>({...n,[r]:s}))},300)},[]),O=(r,s)=>{const n=new Set(u);s?n.add(r):n.delete(r),m(n)},E=r=>{if(r){const s=new Set(h.map((n,i)=>i));m(s)}else m(new Set)},L=()=>{const r=sessionStorage.getItem("statusCart");return r?JSON.parse(r):{}},N=r=>{sessionStorage.setItem("statusCart",JSON.stringify(r))},P=()=>{const r=L(),s=`${l}|${c}`;r[s]||(r[s]={sourceLang:l,targetLang:c,tus:[]});const n=Array.from(u).map(i=>h[i]);r[s].tus.push(...n),N(r),m(new Set),window.dispatchEvent(new Event("cartUpdated"))},U=h.length>0&&u.size===h.length,V=u.size>0&&u.size<h.length;return a.useEffect(()=>{if(C.current&&d.current[C.current]){const r=d.current[C.current];setTimeout(()=>{if(r&&document.contains(r)){r.focus();const s=r.value.length;r.setSelectionRange(s,s)}},10)}},[h]),a.useEffect(()=>()=>{S.current&&clearTimeout(S.current)},[]),z?e.jsx(t,{display:"flex",justifyContent:"center",mt:10,children:e.jsx(F,{size:"xl"})}):I?e.jsx(t,{mt:5,px:6,children:e.jsx(H,{status:"error",children:e.jsxs(t,{children:[e.jsx(o,{fontWeight:"bold",children:"Error"}),e.jsx(o,{children:D?.message||"Failed to fetch status data"})]})})}):e.jsx(t,{py:6,px:6,children:e.jsxs(x,{gap:6,align:"stretch",children:[e.jsxs(t,{children:[e.jsxs(y,{align:"center",justify:"space-between",mb:2,children:[e.jsxs(y,{align:"center",gap:3,children:[e.jsxs(o,{fontSize:"2xl",fontWeight:"bold",children:["Untranslated Content: ",l," â†’ ",c]}),z&&e.jsx(F,{size:"sm"})]}),u.size>0&&e.jsxs(G,{colorPalette:"blue",onClick:P,children:["Add to Cart (",u.size," ",u.size===1?"TU":"TUs",")"]})]}),e.jsxs(o,{color:"fg.muted",children:["Translation units requiring translation (",h.length," of ",w.length," shown)"]})]}),e.jsxs(t,{bg:"white",borderRadius:"lg",shadow:"sm",overflow:"auto",maxH:"70vh",children:[e.jsxs(t,{as:"table",w:"100%",fontSize:"sm",children:[e.jsx(t,{as:"thead",position:"sticky",top:0,bg:"orange.subtle",zIndex:1,borderBottom:"2px",borderColor:"orange.muted",shadow:"sm",children:e.jsxs(t,{as:"tr",children:[e.jsx(t,{as:"th",p:3,borderBottom:"1px",borderColor:"border.default",minW:"60px",textAlign:"center",children:e.jsxs(v,{checked:U,onCheckedChange:r=>E(r.checked),children:[e.jsx(A,{ref:r=>{r&&(r.indeterminate=V)}}),e.jsx(k,{})]})}),e.jsx(t,{as:"th",p:3,borderBottom:"1px",borderColor:"border.default",minW:"120px",textAlign:"left",children:e.jsxs(x,{gap:2,align:"stretch",children:[e.jsx(o,{fontSize:"sm",fontWeight:"bold",color:"orange.600",children:"GUID"}),e.jsx(j,{size:"xs",placeholder:"Filter GUID...",value:p.guid,onChange:r=>b("guid",r.target.value),onFocus:()=>f("guid"),onBlur:g,ref:r=>{r&&(d.current.guid=r)},bg:"yellow.subtle"},"guid-input")]})}),e.jsx(t,{as:"th",p:3,borderBottom:"1px",borderColor:"border.default",minW:"120px",textAlign:"left",children:e.jsxs(x,{gap:2,align:"stretch",children:[e.jsx(o,{fontSize:"sm",fontWeight:"bold",color:"orange.600",children:"CHANNEL"}),e.jsx(j,{size:"xs",placeholder:"Filter channel...",value:p.channel,onChange:r=>b("channel",r.target.value),onFocus:()=>f("channel"),onBlur:g,ref:r=>{r&&(d.current.channel=r)},bg:"yellow.subtle"},"channel-input")]})}),e.jsx(t,{as:"th",p:3,borderBottom:"1px",borderColor:"border.default",minW:"120px",textAlign:"left",children:e.jsxs(x,{gap:2,align:"stretch",children:[e.jsx(o,{fontSize:"sm",fontWeight:"bold",color:"orange.600",children:"PRJ"}),e.jsx(j,{size:"xs",placeholder:"Filter project...",value:p.prj,onChange:r=>b("prj",r.target.value),onFocus:()=>f("prj"),onBlur:g,ref:r=>{r&&(d.current.prj=r)},bg:"yellow.subtle"},"prj-input")]})}),e.jsx(t,{as:"th",p:3,borderBottom:"1px",borderColor:"border.default",minW:"150px",textAlign:"left",children:e.jsxs(x,{gap:2,align:"stretch",children:[e.jsx(o,{fontSize:"sm",fontWeight:"bold",color:"orange.600",children:"RID"}),e.jsx(j,{size:"xs",placeholder:"Filter RID...",value:p.rid,onChange:r=>b("rid",r.target.value),onFocus:()=>f("rid"),onBlur:g,ref:r=>{r&&(d.current.rid=r)},bg:"yellow.subtle"},"rid-input")]})}),e.jsx(t,{as:"th",p:3,borderBottom:"1px",borderColor:"border.default",minW:"150px",textAlign:"left",children:e.jsxs(x,{gap:2,align:"stretch",children:[e.jsx(o,{fontSize:"sm",fontWeight:"bold",color:"orange.600",children:"SID"}),e.jsx(j,{size:"xs",placeholder:"Filter SID...",value:p.sid,onChange:r=>b("sid",r.target.value),onFocus:()=>f("sid"),onBlur:g,ref:r=>{r&&(d.current.sid=r)},bg:"yellow.subtle"},"sid-input")]})}),e.jsx(t,{as:"th",p:3,borderBottom:"1px",borderColor:"border.default",minW:"350px",textAlign:"left",children:e.jsxs(x,{gap:2,align:"stretch",children:[e.jsx(o,{fontSize:"sm",fontWeight:"bold",color:"orange.600",children:"NSRC"}),e.jsx(j,{size:"xs",placeholder:"Filter source...",value:p.nsrc,onChange:r=>b("nsrc",r.target.value),onFocus:()=>f("nsrc"),onBlur:g,ref:r=>{r&&(d.current.nsrc=r)},bg:"yellow.subtle",dir:l?.startsWith("he")||l?.startsWith("ar")?"rtl":"ltr"},"nsrc-input")]})}),e.jsx(t,{as:"th",p:3,borderBottom:"1px",borderColor:"border.default",minW:"120px",textAlign:"left",children:e.jsxs(x,{gap:2,align:"stretch",children:[e.jsx(o,{fontSize:"sm",fontWeight:"bold",color:"orange.600",children:"GROUP"}),e.jsx(j,{size:"xs",placeholder:"Filter group...",value:p.group,onChange:r=>b("group",r.target.value),onFocus:()=>f("group"),onBlur:g,ref:r=>{r&&(d.current.group=r)},bg:"yellow.subtle"},"group-input")]})}),e.jsx(t,{as:"th",p:3,borderBottom:"1px",borderColor:"border.default",minW:"120px",textAlign:"left",children:e.jsxs(x,{gap:2,align:"stretch",children:[e.jsx(o,{fontSize:"sm",fontWeight:"bold",color:"orange.600",children:"MF"}),e.jsx(j,{size:"xs",placeholder:"Filter mf...",value:p.mf,onChange:r=>b("mf",r.target.value),onFocus:()=>f("mf"),onBlur:g,ref:r=>{r&&(d.current.mf=r)},bg:"yellow.subtle"},"mf-input")]})})]})}),e.jsx(t,{as:"tbody",children:h.map((r,s)=>e.jsxs(t,{as:"tr",_hover:{bg:"gray.subtle"},children:[e.jsx(t,{as:"td",p:3,borderBottom:"1px",borderColor:"border.subtle",textAlign:"center",children:e.jsxs(v,{checked:u.has(s),onCheckedChange:n=>O(s,n.checked),children:[e.jsx(A,{}),e.jsx(k,{})]})}),e.jsx(t,{as:"td",p:3,borderBottom:"1px",borderColor:"border.subtle",children:e.jsx(o,{fontSize:"xs",fontFamily:"mono",color:"orange.600",userSelect:"all",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxW:"100px",children:r.guid})}),e.jsx(t,{as:"td",p:3,borderBottom:"1px",borderColor:"border.subtle",children:e.jsx(o,{fontSize:"xs",children:r.channel})}),e.jsx(t,{as:"td",p:3,borderBottom:"1px",borderColor:"border.subtle",children:e.jsx(o,{fontSize:"xs",children:r.prj})}),e.jsx(t,{as:"td",p:3,borderBottom:"1px",borderColor:"border.subtle",children:e.jsx(o,{fontSize:"xs",wordBreak:"break-all",whiteSpace:"normal",children:r.rid})}),e.jsx(t,{as:"td",p:3,borderBottom:"1px",borderColor:"border.subtle",children:e.jsx(o,{fontSize:"xs",wordBreak:"break-all",whiteSpace:"normal",children:r.sid})}),e.jsx(t,{as:"td",p:3,borderBottom:"1px",borderColor:"border.subtle",children:r.notes&&(r.notes.desc?.trim()||r.notes.ph&&Object.keys(r.notes.ph).length>0)?e.jsxs(J,{children:[e.jsx(K,{asChild:!0,children:e.jsx(o,{fontSize:"xs",noOfLines:2,cursor:"help",dir:l?.startsWith("he")||l?.startsWith("ar")?"rtl":"ltr",children:B(r.nsrc)})}),e.jsx(M,{children:e.jsxs(_,{maxW:"400px",bg:"yellow.100",borderWidth:"1px",borderColor:"yellow.300",shadow:"lg",children:[e.jsx(Q,{}),e.jsxs(t,{children:[r.notes.desc?.trim()&&e.jsx(o,{fontSize:"sm",mb:2,whiteSpace:"pre-wrap",color:"black",children:r.notes.desc}),r.notes.ph&&Object.keys(r.notes.ph).length>0&&e.jsxs(t,{children:[e.jsx(o,{fontSize:"xs",fontWeight:"bold",color:"gray.600",mb:1,children:"Placeholders:"}),Object.entries(r.notes.ph).map(([n,i])=>e.jsxs(t,{mb:1,children:[e.jsx(o,{fontSize:"xs",fontFamily:"mono",color:"blue.600",children:n}),e.jsxs(o,{fontSize:"xs",color:"gray.600",children:[i.desc," (e.g., ",i.sample,")"]})]},n))]})]})]})})]}):e.jsx(o,{fontSize:"xs",noOfLines:2,dir:l?.startsWith("he")||l?.startsWith("ar")?"rtl":"ltr",children:B(r.nsrc)})}),e.jsx(t,{as:"td",p:3,borderBottom:"1px",borderColor:"border.subtle",children:e.jsx(o,{fontSize:"xs",children:r.group})}),e.jsx(t,{as:"td",p:3,borderBottom:"1px",borderColor:"border.subtle",children:e.jsx(o,{fontSize:"xs",children:r.mf})})]},`${r.guid}-${s}`))})]}),h.length===0&&!z&&e.jsx(y,{justify:"center",p:8,children:e.jsx(o,{color:"fg.muted",children:"No untranslated content found for the current filters"})})]})]})})};export{ce as default};
