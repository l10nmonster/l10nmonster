import{j as e,C as pe,a as Se,T as r,B as t,F as S,b as oe,c as ne,d as ie,e as le,f as de,g as z,G as _,L as q,h as H,I as ye,u as we,V as w,r as y,i as G,A as ae,S as Q,k as re,l as ze,m as Ce,n as We,o as Te,p as Ae,q as ve,s as Pe,t as Re,v as L,D,w as I,x as k,y as B,z as F,E,H as U,J as N,K as Le}from"./vendor-BVSmEsOp.js";function ke({children:s}){return e.jsx(e.Fragment,{children:s})}async function V(s,l={}){try{const a=await fetch(s,l);if(!a.ok){let i;try{i=await a.json()}catch{}const n=i?.message||`HTTP error! status: ${a.status}`,c=new Error(n);throw c.status=a.status,c.response=a,c}return await a.json()}catch(a){if(console.error("API Fetch Error:",a),a.status||a.response)throw a;const i=new Error(a.message||"Network error");throw i.originalError=a,i}}const Be=({project:s})=>{const{projectName:l,pairSummary:a,pairSummaryByStatus:i,translationStatus:n}=s,c={translated:i?.translated||0,"in flight":i?.["in flight"]||0,"low quality":i?.["low quality"]||0,untranslated:i?.untranslated||0},h=Object.values(c).reduce((u,j)=>u+j,0),g=h>0?Math.round(c.translated/h*100):0,x=h>0?Math.round(c["in flight"]/h*100):0,d=h>0?Math.round(c["low quality"]/h*100):0,b=h>0?Math.round(c.untranslated/h*100):0;return e.jsx(pe,{variant:"outline",bg:"yellow.subtle",children:e.jsxs(Se,{children:[e.jsx(r,{fontSize:"sm",fontWeight:"semibold",mb:2,children:l}),e.jsx(t,{mb:3,children:e.jsxs(S,{align:"center",gap:2,mb:1,children:[e.jsxs(oe,{children:[e.jsx(ne,{asChild:!0,children:e.jsxs(t,{flex:"1",bg:"bg.muted",rounded:"full",height:"10px",cursor:"help",position:"relative",overflow:"hidden",children:[e.jsx(t,{position:"absolute",top:"0",left:"0",height:"100%",width:`${g}%`,bg:"green.solid",transition:"width 0.3s ease"}),e.jsx(t,{position:"absolute",top:"0",left:`${g}%`,height:"100%",width:`${x}%`,bg:"blue.solid",transition:"width 0.3s ease"}),e.jsx(t,{position:"absolute",top:"0",left:`${g+x}%`,height:"100%",width:`${d}%`,bg:"yellow.solid",transition:"width 0.3s ease"}),e.jsx(t,{position:"absolute",top:"0",left:`${g+x+d}%`,height:"100%",width:`${b}%`,bg:"red.solid",transition:"width 0.3s ease"})]})}),e.jsx(ie,{children:e.jsxs(le,{maxW:"300px",bg:"bg.default",borderWidth:"1px",borderColor:"border.default",shadow:"lg",zIndex:1e3,children:[e.jsx(de,{}),e.jsxs(t,{p:2,children:[e.jsx(r,{fontSize:"sm",fontWeight:"bold",mb:2,color:"fg.default",children:"Translation Status Details"}),n&&n.length>0?e.jsx(t,{children:n.map((u,j)=>{const C=u.q===null?"untranslated":u.q===0?"in flight":u.q>=u.minQ?"translated":"low quality",W=C==="translated"?"green.solid":C==="in flight"?"blue.solid":C==="low quality"?"yellow.solid":"red.solid";return e.jsxs(S,{align:"center",gap:2,mb:1,children:[e.jsx(t,{w:"8px",h:"8px",bg:W,borderRadius:"full"}),e.jsxs(r,{fontSize:"xs",color:"fg.default",children:["Q: ",u.q||"null"," | Segs: ",u.seg," | Words: ",u.words," | Chars: ",u.chars]})]},j)})}):e.jsxs(t,{children:[e.jsxs(S,{align:"center",gap:2,mb:1,children:[e.jsx(t,{w:"8px",h:"8px",bg:"green.solid",borderRadius:"full"}),e.jsxs(r,{fontSize:"xs",color:"fg.default",children:["Translated: ",c.translated]})]}),e.jsxs(S,{align:"center",gap:2,mb:1,children:[e.jsx(t,{w:"8px",h:"8px",bg:"blue.solid",borderRadius:"full"}),e.jsxs(r,{fontSize:"xs",color:"fg.default",children:["In Flight: ",c["in flight"]]})]}),e.jsxs(S,{align:"center",gap:2,mb:1,children:[e.jsx(t,{w:"8px",h:"8px",bg:"yellow.solid",borderRadius:"full"}),e.jsxs(r,{fontSize:"xs",color:"fg.default",children:["Low Quality: ",c["low quality"]]})]}),e.jsxs(S,{align:"center",gap:2,children:[e.jsx(t,{w:"8px",h:"8px",bg:"red.solid",borderRadius:"full"}),e.jsxs(r,{fontSize:"xs",color:"fg.default",children:["Untranslated: ",c.untranslated]})]})]})]})]})})]}),e.jsxs(r,{fontSize:"sm",color:"fg.muted",minW:"45px",children:[g,"%"]})]})}),e.jsxs(S,{gap:2,flexWrap:"wrap",align:"center",children:[e.jsxs(z,{variant:"subtle",colorPalette:"blue",children:["Segments: ",a?.segs?.toLocaleString()||"0"]}),e.jsxs(z,{variant:"subtle",colorPalette:"green",children:["Words: ",a?.words?.toLocaleString()||"0"]}),e.jsxs(z,{variant:"subtle",colorPalette:"purple",children:["Chars: ",a?.chars?.toLocaleString()||"0"]}),c.untranslated>0&&e.jsxs(z,{variant:"solid",colorPalette:"red",children:["Untranslated: ",c.untranslated.toLocaleString()]}),c["low quality"]>0&&e.jsxs(z,{variant:"solid",colorPalette:"orange",children:["Low Quality: ",c["low quality"].toLocaleString()]})]})]})})},Fe=({item:s,channelId:l})=>{const a=n=>{const c=new Date,h=new Date(n),g=c-h,x=Math.floor(g/1e3),d=new Intl.RelativeTimeFormat("en",{numeric:"auto",style:"short"});return x<60?d.format(-x,"second"):x<3600?d.format(-Math.floor(x/60),"minute"):x<86400?d.format(-Math.floor(x/3600),"hour"):x<2592e3?d.format(-Math.floor(x/86400),"day"):x<31536e3?d.format(-Math.floor(x/2592e3),"month"):d.format(-Math.floor(x/31536e3),"year")},i=n=>new Date(n).toLocaleString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZoneName:"short"});return e.jsx(t,{p:3,borderWidth:"1px",borderRadius:"md",borderColor:"border.default",bg:"yellow.subtle",w:"100%",children:e.jsxs(_,{templateColumns:"2fr 80px 3fr 80px 80px 100px",gap:4,alignItems:"center",children:[e.jsxs(t,{children:[e.jsx(r,{fontSize:"xs",color:"fg.muted",mb:1,children:"Project"}),e.jsx(q,{as:H,to:`/sources/${l}/${s.prj??"default"}`,fontSize:"sm",fontWeight:"semibold",color:"blue.600",_hover:{textDecoration:"underline"},children:s.prj??"default"})]}),e.jsxs(t,{children:[e.jsx(r,{fontSize:"xs",color:"fg.muted",mb:1,children:"Source"}),e.jsx(z,{colorPalette:"blue",size:"sm",children:s.sourceLang})]}),e.jsxs(t,{children:[e.jsxs(r,{fontSize:"xs",color:"fg.muted",mb:1,children:["Targets (",s.targetLangs.length,")"]}),e.jsx(S,{wrap:"wrap",gap:1,children:s.targetLangs.map(n=>e.jsx(z,{colorPalette:"green",size:"sm",children:n},n))})]}),e.jsxs(t,{textAlign:"center",children:[e.jsx(r,{fontSize:"xs",color:"fg.muted",mb:1,children:"Resources"}),e.jsx(r,{fontSize:"sm",fontWeight:"bold",color:"orange.600",children:s.resCount.toLocaleString()})]}),e.jsxs(t,{textAlign:"center",children:[e.jsx(r,{fontSize:"xs",color:"fg.muted",mb:1,children:"Segments"}),e.jsx(r,{fontSize:"sm",fontWeight:"bold",color:"purple.600",children:s.segmentCount.toLocaleString()})]}),e.jsxs(t,{textAlign:"center",children:[e.jsx(r,{fontSize:"xs",color:"fg.muted",mb:1,children:"Modified"}),e.jsxs(oe,{children:[e.jsx(ne,{asChild:!0,children:e.jsx(r,{fontSize:"xs",color:"fg.muted",cursor:"help",children:a(s.lastModified)})}),e.jsx(ie,{children:e.jsxs(le,{children:[e.jsx(de,{}),e.jsx(r,{fontSize:"sm",children:i(s.lastModified)})]})})]})]})]})})},$e=(s,l)=>s?{snapText:`Snapped on ${new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}`,importText:l?{text:"Imported from snap store ",store:l}:null}:{snapText:"Never snapped",importText:null},Ee=({channelId:s,project:l,resource:a,onBackClick:i,backLabel:n="Back",snapTimestamp:c,snapStore:h,showSnapInfo:g=!1,extraContent:x=null})=>e.jsxs(t,{p:6,borderWidth:"2px",borderRadius:"lg",bg:"white",borderColor:"green.200",mb:6,children:[e.jsxs(t,{display:"flex",alignItems:"center",gap:3,flexWrap:"wrap",pb:4,borderBottom:"2px",borderColor:"green.100",children:[i&&e.jsx(ye,{"aria-label":n,onClick:i,variant:"ghost",size:"sm",children:"←"}),e.jsxs(t,{children:[e.jsx(r,{fontSize:"sm",color:"fg.muted",mb:1,children:"Channel"}),e.jsx(r,{fontSize:"lg",fontWeight:"bold",color:"green.600",children:s})]}),l&&e.jsxs(t,{children:[e.jsx(r,{fontSize:"sm",color:"fg.muted",mb:1,children:"Project"}),e.jsx(r,{fontSize:"lg",fontWeight:"semibold",color:"blue.600",children:l})]}),a&&e.jsxs(t,{flex:"1",children:[e.jsx(r,{fontSize:"sm",color:"fg.muted",mb:1,children:"Resource"}),e.jsx(r,{fontSize:"lg",fontWeight:"semibold",color:"purple.600",wordBreak:"break-all",children:a})]}),g&&!l&&!a&&e.jsx(t,{flex:"1",textAlign:"right",children:(()=>{const{snapText:d,importText:b}=$e(c,h);return e.jsxs(e.Fragment,{children:[e.jsx(r,{fontSize:"sm",color:"fg.muted",children:d}),b&&e.jsxs(r,{fontSize:"sm",color:"fg.muted",children:[b.text,e.jsx(r,{as:"span",fontWeight:"bold",color:"blue.600",children:b.store})]})]})})()})]}),x&&e.jsx(t,{mt:6,children:x})]});function se(s){if(!s)return null;const l=/(https:\/\/[^\s]+)/g;return s.split(l).map((i,n)=>i.match(l)?e.jsx(r,{as:"a",href:i,target:"_blank",rel:"noopener noreferrer",color:"blue.600",textDecoration:"underline",_hover:{color:"blue.800"},children:i},`link-${n}`):i)}const ce="tmCart",Me=()=>{const s=sessionStorage.getItem(ce);return s?JSON.parse(s):{}},Je=s=>{sessionStorage.setItem(ce,JSON.stringify(s)),window.dispatchEvent(new Event("cartUpdated"))},Oe=(s,l,a,i=null)=>({guid:s.guid,channel:i||s.channel,sourceLang:l,targetLang:a,nsrc:s.nsrc,ntgt:s.ntgt}),he=(s,l,a,i=null)=>{const n=Me(),c=`${s}|${l}`;n[c]||(n[c]={sourceLang:s,targetLang:l,tus:[]});const h=a.map(g=>Oe(g,s,l,i));n[c].tus.push(...h),Je(n)},Ue=he,Ne=(s,l,a,i)=>{he(s,l,i,a)},De=({sourceLang:s,targetLang:l,providers:a})=>{we();const i=n=>{switch(n){case"done":return"green";case"pending":return"yellow";case"error":return"red";default:return"gray"}};return e.jsx(t,{p:6,borderWidth:"1px",borderRadius:"lg",bg:"white",shadow:"sm",w:"100%",children:e.jsxs(w,{gap:4,align:"stretch",children:[e.jsx(t,{children:e.jsx(t,{mb:2,children:e.jsxs(q,{as:H,to:`/tm/${s}/${l}`,fontSize:"lg",fontWeight:"semibold",color:"blue.600",_hover:{textDecoration:"underline"},children:[s," → ",l]})})}),e.jsx(w,{gap:3,align:"stretch",children:a.map((n,c)=>e.jsx(t,{p:3,borderWidth:"1px",borderRadius:"md",borderColor:"border.default",bg:"yellow.subtle",children:e.jsxs(_,{templateColumns:{base:"minmax(0, 2fr) 1fr 1fr 1fr 1fr",md:"minmax(0, 3fr) 1fr 1fr 1fr 1fr"},gap:{base:1,md:2},alignItems:"center",overflow:"hidden",minWidth:"0",children:[e.jsxs(t,{minWidth:"0",overflow:"hidden",children:[e.jsx(r,{fontSize:"xs",color:"fg.muted",mb:1,children:"Provider"}),e.jsx(q,{as:H,to:`/tm/${s}/${l}?translationProvider=${encodeURIComponent(n.translationProvider)}`,fontSize:"sm",fontWeight:"semibold",color:"blue.600",_hover:{textDecoration:"underline",color:"blue.700"},noOfLines:1,title:n.translationProvider,children:n.translationProvider})]}),e.jsxs(t,{textAlign:"center",children:[e.jsx(r,{fontSize:"xs",color:"fg.muted",mb:1,children:"Status"}),e.jsx(z,{colorPalette:i(n.status),size:"sm",children:n.status})]}),e.jsxs(t,{textAlign:"center",children:[e.jsx(r,{fontSize:"xs",color:"fg.muted",mb:1,children:"TUs"}),e.jsx(r,{fontSize:"sm",fontWeight:"bold",color:"purple.600",children:n.tuCount.toLocaleString()})]}),e.jsxs(t,{textAlign:"center",children:[e.jsx(r,{fontSize:"xs",color:"fg.muted",mb:1,children:"Unique"}),e.jsx(r,{fontSize:"sm",fontWeight:"bold",color:"orange.600",children:n.distinctGuids.toLocaleString()})]}),e.jsxs(t,{textAlign:"center",children:[e.jsx(r,{fontSize:"xs",color:"fg.muted",mb:1,children:"Jobs"}),e.jsx(r,{fontSize:"sm",fontWeight:"bold",color:"teal.600",children:n.jobCount.toLocaleString()})]})]})},c))})]})})},qe=({sourceLang:s,targetLang:l})=>{const[a,i]=y.useState(!1),n=y.useRef(null);y.useEffect(()=>{const x=new IntersectionObserver(d=>{d.forEach(b=>{b.isIntersecting&&(i(!0),x.disconnect())})},{rootMargin:"200px",threshold:0});return n.current&&x.observe(n.current),()=>x.disconnect()},[]);const{data:c,isLoading:h,error:g}=G({queryKey:["tmStats",s,l],queryFn:()=>V(`/api/tm/stats/${s}/${l}`),enabled:a});return e.jsx(t,{ref:n,minH:"200px",children:g?e.jsx(ae,{status:"error",children:e.jsxs(t,{children:[e.jsxs(r,{fontWeight:"bold",children:["Error loading ",s," → ",l]}),e.jsx(r,{children:g.message||"Unknown error"})]})}):h?e.jsx(t,{display:"flex",justifyContent:"center",alignItems:"center",minH:"200px",p:6,borderWidth:"1px",borderRadius:"lg",bg:"white",shadow:"sm",children:e.jsx(Q,{size:"md"})}):c?e.jsx(De,{sourceLang:s,targetLang:l,providers:c}):a?e.jsx(t,{display:"flex",justifyContent:"center",alignItems:"center",minH:"200px",p:6,borderWidth:"1px",borderRadius:"lg",bg:"white",shadow:"sm",children:e.jsx(r,{color:"fg.muted",children:"No data available"})}):e.jsx(t,{display:"flex",justifyContent:"center",alignItems:"center",minH:"200px",p:6,borderWidth:"1px",borderRadius:"lg",bg:"gray.50",shadow:"sm",children:e.jsx(r,{color:"fg.muted",fontSize:"sm",children:"Scroll down to load..."})})})},He=({providers:s,selectedProvider:l,onProviderSelect:a})=>{const i=Array.isArray(s)?s:[];return e.jsxs(t,{width:"25%",flexShrink:0,borderRight:"1px",borderColor:"border.default",p:4,bg:"yellow.subtle",minH:"70vh",children:[e.jsx(r,{fontSize:"lg",fontWeight:"bold",mb:4,children:"Providers"}),e.jsxs(w,{gap:2,align:"stretch",children:[i.map(n=>{const c=typeof n=="object"&&n?.id?n.id:n,h=typeof n=="object"&&n?.id?n.id:n,g=typeof n=="object"&&n?.type?n.type:null;return e.jsxs(t,{p:3,borderRadius:"md",cursor:"pointer",bg:l===h?"blue.subtle":"white",borderWidth:"1px",borderColor:l===h?"blue.600":"border.default",_hover:{bg:l===h?"blue.subtle":"gray.subtle"},onClick:()=>a(h),children:[e.jsx(r,{fontSize:"sm",fontWeight:"medium",noOfLines:2,children:c}),g&&e.jsx(r,{fontSize:"xs",color:"fg.muted",mt:1,children:g})]},h)}),i.length===0&&e.jsx(r,{color:"fg.muted",fontSize:"sm",textAlign:"center",mt:4,children:"No providers found"})]})]})},_e=({providerId:s})=>{const{data:l,isLoading:a,error:i}=G({queryKey:["provider",s],queryFn:()=>V(`/api/providers/${s}`),enabled:!!s});if(!s)return e.jsx(t,{width:"75%",p:6,textAlign:"center",children:e.jsx(r,{color:"fg.muted",children:"Select a provider to view details"})});if(a)return e.jsx(t,{width:"75%",p:6,display:"flex",justifyContent:"center",alignItems:"center",children:e.jsx(Q,{size:"lg"})});if(i)return e.jsx(t,{width:"75%",p:6,children:e.jsx(ae,{status:"error",children:e.jsxs(t,{children:[e.jsx(r,{fontWeight:"bold",children:"Error"}),e.jsx(r,{children:i?.message||"Failed to fetch provider details"})]})})});if(!l)return e.jsx(t,{width:"75%",p:6,textAlign:"center",children:e.jsx(r,{color:"fg.muted",children:"Provider not found"})});const{info:n,properties:c}=l,h=d=>{if(!d)return d;const b={31:"#ef4444",32:"#22c55e",33:"#eab308",34:"#3b82f6",35:"#a855f7",36:"#06b6d4",39:"inherit"},u=[];let j=0,C="inherit";const W=/\u001B\[([0-9;]*)m/g;let p;for(;(p=W.exec(d))!==null;){if(p.index>j){const J=d.slice(j,p.index);u.push(e.jsx("span",{style:{color:C},children:J},`${j}-text`))}const T=p[1];b[T]&&(C=b[T]),j=p.index+p[0].length}if(j<d.length){const T=d.slice(j);u.push(e.jsx("span",{style:{color:C},children:T},`${j}-text`))}return u.length>0?u:d},g=d=>Array.isArray(d)?d.map((b,u)=>e.jsxs(t,{display:"flex",alignItems:"flex-start",gap:2,children:[e.jsx(r,{fontSize:"sm",color:"fg.muted",mt:"1px",children:"•"}),e.jsx(r,{fontSize:"sm",flex:"1",children:h(b)})]},u)):e.jsx(r,{fontSize:"sm",children:h(d)}),x=d=>typeof d=="object"&&d!==null?!Array.isArray(d)&&Object.values(d).every(u=>typeof u=="string")&&Object.keys(d).length>0?e.jsx(t,{borderWidth:"1px",borderRadius:"md",overflow:"hidden",bg:"white",shadow:"sm",children:e.jsxs(t,{as:"table",w:"100%",fontSize:"sm",children:[e.jsx(t,{as:"thead",bg:"blue.subtle",borderBottom:"1px",borderColor:"border.default",children:e.jsxs(t,{as:"tr",children:[e.jsx(t,{as:"th",p:2,textAlign:"left",fontWeight:"semibold",color:"blue.600",children:"Key"}),e.jsx(t,{as:"th",p:2,textAlign:"left",fontWeight:"semibold",color:"blue.600",children:"Value"})]})}),e.jsx(t,{as:"tbody",children:Object.entries(d).sort(([u],[j])=>u.localeCompare(j)).map(([u,j])=>e.jsxs(t,{as:"tr",_hover:{bg:"gray.subtle"},children:[e.jsx(t,{as:"td",p:2,borderBottom:"1px",borderColor:"border.subtle",fontFamily:"mono",fontSize:"xs",children:u}),e.jsx(t,{as:"td",p:2,borderBottom:"1px",borderColor:"border.subtle",fontSize:"xs",children:j})]},u))})]})}):e.jsx(t,{as:"pre",fontSize:"xs",bg:"bg.muted",p:2,borderRadius:"md",overflow:"auto",maxH:"200px",children:JSON.stringify(d,null,2)}):e.jsx(r,{fontSize:"sm",children:String(d)});return e.jsx(t,{width:"75%",p:6,overflow:"auto",children:e.jsxs(w,{gap:6,align:"stretch",children:[e.jsx(t,{children:e.jsx(r,{fontSize:"2xl",fontWeight:"bold",mb:2,children:s})}),e.jsxs(t,{p:4,borderWidth:"1px",borderRadius:"lg",bg:"white",shadow:"sm",children:[e.jsx(r,{fontSize:"lg",fontWeight:"semibold",mb:4,children:"Properties"}),Object.keys(c).length===0?e.jsx(r,{color:"fg.muted",fontSize:"sm",children:"No properties available"}):e.jsx(w,{gap:4,align:"stretch",children:Object.entries(c).sort(([d],[b])=>d.localeCompare(b)).map(([d,b])=>e.jsxs(t,{children:[e.jsxs(r,{fontSize:"sm",fontWeight:"bold",color:"blue.600",mb:2,children:[d,":"]}),e.jsx(t,{pl:4,children:x(b)})]},d))})]}),e.jsxs(t,{p:4,borderWidth:"1px",borderRadius:"lg",bg:"white",shadow:"sm",children:[e.jsx(r,{fontSize:"lg",fontWeight:"semibold",mb:4,children:"Information"}),e.jsxs(_,{templateColumns:"auto 1fr",gap:3,alignItems:"start",children:[e.jsx(r,{fontSize:"sm",fontWeight:"bold",color:"blue.600",children:"Type:"}),e.jsx(z,{colorPalette:"blue",size:"sm",children:n.type}),e.jsx(r,{fontSize:"sm",fontWeight:"bold",color:"blue.600",children:"Cost per Word:"}),e.jsx(r,{fontSize:"sm",children:n.costPerWord}),e.jsx(r,{fontSize:"sm",fontWeight:"bold",color:"blue.600",children:"Cost per MChar:"}),e.jsx(r,{fontSize:"sm",children:n.costPerMChar}),n.description&&e.jsxs(e.Fragment,{children:[e.jsx(r,{fontSize:"sm",fontWeight:"bold",color:"blue.600",children:"Description:"}),e.jsx(t,{children:g(n.description)})]})]})]})]})})},Ge=({langPairKey:s,tus:l,onRemoveTU:a})=>{const[i,n]=y.useState(""),[c,h]=y.useState(!1),[g,x]=y.useState(!1),[d,b]=y.useState(null),[u,j]=y.useState(""),[C,W]=y.useState(""),[p,T]=y.useState(null),[J,K]=y.useState(!1),{data:xe={},isLoading:ue}=G({queryKey:["info"],queryFn:()=>V("/api/info")}),fe=xe.providers||[],Y=re({mutationFn:async({sourceLang:o,targetLang:f,tus:m,providerList:v})=>{const P=await fetch("/api/dispatcher/createJobs",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sourceLang:o,targetLang:f,tus:m,providerList:v})});if(!P.ok){const R=await P.json();throw new Error(R.message||"Failed to create jobs")}return P.json()}}),O=re({mutationFn:async({jobs:o,instructions:f})=>{const m=await fetch("/api/dispatcher/startJobs",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jobs:o,instructions:f})});if(!m.ok){const v=await m.json();throw new Error(v.message||"Failed to start jobs")}return m.json()}});function Z(o){return o.map(f=>typeof f=="string"?f:`{{${f.t}}}`).join("")}const ge=async()=>{if(!i){alert("Please select a provider first");return}const o=Array.isArray(l)?l:l.tus,f=typeof i=="object"&&i?.id?i.id:i;try{const m=o.map(R=>({channel:R.channel,guid:R.guid})),P=(await Y.mutateAsync({sourceLang:$,targetLang:M,tus:m,providerList:[f]})).find(R=>R.translationProvider===f);P?(b(P),j(""),h(!0)):(W(`Provider "${f}" did not accept any of the selected translation units.`),x(!0))}catch(m){W(`Failed to create job: ${m.message}`),x(!0)}},be=o=>{n(o)},je=async()=>{if(d)try{const o=await O.mutateAsync({jobs:[d],instructions:u||void 0}),f=o.find(m=>m.jobGuid===d.jobGuid)||o[0];T(f),h(!1),K(!0)}catch(o){W(`Failed to start job: ${o.message}`),x(!0)}},X=()=>{if(K(!1),T(null),b(null),j(""),d&&d.tus){const o=new Set(d.tus.map(m=>m.guid)),f=Array.isArray(l)?l:l.tus;for(let m=f.length-1;m>=0;m--)o.has(f[m].guid)&&a(s,m)}},me=o=>o===0?"Free":o==null?"Unknown":`$${o.toFixed(2)}`,A=Array.isArray(l)?l:l.tus,$=Array.isArray(l)?s.split("|")[0]||s.split("→")[0]:l.sourceLang,M=Array.isArray(l)?s.split("|")[1]||s.split("→").slice(1).join("→"):l.targetLang,ee=A.some(o=>o.ntgt!==void 0),te=A.some(o=>o.channel!==void 0);return e.jsxs(t,{p:6,borderWidth:"1px",borderRadius:"lg",bg:"white",shadow:"sm",children:[e.jsxs(w,{gap:4,align:"stretch",children:[e.jsx(t,{children:e.jsxs(S,{align:"center",justify:"space-between",mb:2,children:[e.jsxs(S,{align:"center",gap:3,children:[e.jsx(z,{colorPalette:"blue",size:"sm",children:$}),e.jsx(r,{color:"fg.muted",fontSize:"lg",children:"→"}),e.jsx(z,{colorPalette:"green",size:"sm",children:M}),e.jsxs(S,{align:"center",gap:3,ml:4,children:[e.jsxs(ze,{size:"sm",width:"250px",value:i?[i]:[],onValueChange:o=>{},positioning:{strategy:"absolute",placement:"bottom-start",flip:!0,gutter:4},children:[e.jsxs(Ce,{children:[e.jsx(r,{fontSize:"sm",flex:"1",textAlign:"left",children:typeof i=="object"&&i?.id?i.id:i||"Select Provider"}),e.jsx(We,{})]}),e.jsx(Te,{children:e.jsx(Ae,{zIndex:1e3,bg:"white",borderWidth:"1px",borderColor:"border.default",borderRadius:"md",shadow:"lg",minW:"250px",maxH:"200px",overflow:"auto",children:ue?e.jsxs(t,{p:3,textAlign:"center",children:[e.jsx(Q,{size:"sm"}),e.jsx(r,{fontSize:"sm",color:"fg.muted",mt:2,children:"Loading providers..."})]}):fe.slice().sort((o,f)=>{const m=typeof o=="object"&&o?.id?o.id:o,v=typeof f=="object"&&f?.id?f.id:f;return m.localeCompare(v)}).map((o,f)=>e.jsxs(ve,{item:o,value:o,onClick:()=>be(o),children:[e.jsx(Pe,{children:typeof o=="object"&&o?.id?o.id:o}),e.jsx(Re,{})]},`provider-${f}-${typeof o=="string"?o:JSON.stringify(o)}`))})})]}),e.jsx(L,{size:"sm",colorPalette:"blue",onClick:ge,disabled:!i,loading:Y.isPending,children:"Create Job"})]})]}),e.jsxs(r,{fontSize:"sm",color:"fg.muted",children:[A.length," ",A.length===1?"TU":"TUs"]})]})}),e.jsx(t,{bg:"white",borderRadius:"md",overflow:"auto",children:e.jsxs(t,{as:"table",w:"100%",fontSize:"sm",children:[e.jsx(t,{as:"thead",bg:"blue.subtle",borderBottom:"2px",borderColor:"blue.muted",shadow:"sm",children:e.jsxs(t,{as:"tr",children:[e.jsx(t,{as:"th",p:3,borderBottom:"1px",borderColor:"border.default",textAlign:"left",minW:"120px",children:e.jsx(r,{fontSize:"sm",fontWeight:"bold",color:"blue.600",children:"GUID"})}),te&&e.jsx(t,{as:"th",p:3,borderBottom:"1px",borderColor:"border.default",textAlign:"left",minW:"120px",children:e.jsx(r,{fontSize:"sm",fontWeight:"bold",color:"blue.600",children:"CHANNEL"})}),e.jsx(t,{as:"th",p:3,borderBottom:"1px",borderColor:"border.default",textAlign:"left",minW:"350px",children:e.jsx(r,{fontSize:"sm",fontWeight:"bold",color:"blue.600",children:"SOURCE"})}),ee&&e.jsx(t,{as:"th",p:3,borderBottom:"1px",borderColor:"border.default",textAlign:"left",minW:"350px",children:e.jsx(r,{fontSize:"sm",fontWeight:"bold",color:"blue.600",children:"TARGET"})}),e.jsx(t,{as:"th",p:3,borderBottom:"1px",borderColor:"border.default",textAlign:"center",minW:"100px",children:e.jsx(r,{fontSize:"sm",fontWeight:"bold",color:"blue.600",children:"ACTION"})})]})}),e.jsx(t,{as:"tbody",children:A.map((o,f)=>e.jsxs(t,{as:"tr",_hover:{bg:"gray.subtle"},children:[e.jsx(t,{as:"td",p:3,borderBottom:"1px",borderColor:"border.subtle",children:e.jsx(r,{fontSize:"xs",fontFamily:"mono",color:"blue.600",userSelect:"all",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxW:"100px",children:o.guid})}),te&&e.jsx(t,{as:"td",p:3,borderBottom:"1px",borderColor:"border.subtle",children:e.jsx(r,{fontSize:"xs",children:o.channel||""})}),e.jsx(t,{as:"td",p:3,borderBottom:"1px",borderColor:"border.subtle",children:e.jsx(r,{fontSize:"xs",noOfLines:2,dir:$?.startsWith("he")||$?.startsWith("ar")?"rtl":"ltr",children:Array.isArray(o.nsrc)?Z(o.nsrc):o.nsrc})}),ee&&e.jsx(t,{as:"td",p:3,borderBottom:"1px",borderColor:"border.subtle",children:e.jsx(r,{fontSize:"xs",noOfLines:2,dir:M?.startsWith("he")||M?.startsWith("ar")?"rtl":"ltr",children:Array.isArray(o.ntgt)?Z(o.ntgt):o.ntgt||""})}),e.jsx(t,{as:"td",p:3,borderBottom:"1px",borderColor:"border.subtle",textAlign:"center",children:e.jsx(L,{size:"xs",colorPalette:"red",variant:"outline",onClick:()=>a(s,f),children:"Remove"})})]},`cart-tu-${f}-${typeof o.guid=="string"?o.guid:o.nid||f}`))})]})})]}),e.jsxs(D,{open:c,onOpenChange:o=>h(o.open),children:[e.jsx(I,{}),e.jsx(k,{children:e.jsxs(B,{maxW:"500px",children:[e.jsxs(F,{children:[e.jsx(E,{children:"Job Created Successfully"}),e.jsx(U,{})]}),e.jsx(N,{children:d&&e.jsxs(w,{gap:4,align:"stretch",children:[e.jsxs(t,{children:[e.jsxs(r,{fontSize:"lg",fontWeight:"bold",color:"green.600",mb:3,children:[d.tus?.length||0," TUs accepted out of ",A.length," sent"]}),e.jsxs(w,{gap:2,align:"stretch",children:[e.jsxs(t,{children:[e.jsx(r,{fontSize:"sm",fontWeight:"semibold",color:"fg.default",display:"inline",children:"Provider: "}),e.jsx(r,{fontSize:"sm",color:"blue.600",fontFamily:"mono",display:"inline",children:typeof i=="object"&&i?.id?i.id:i})]}),e.jsxs(t,{children:[e.jsx(r,{fontSize:"sm",fontWeight:"semibold",color:"fg.default",display:"inline",children:"Estimated Cost: "}),e.jsx(r,{fontSize:"sm",color:"green.600",fontWeight:"medium",display:"inline",children:me(d.estimatedCost)})]}),d.statusDescription&&e.jsxs(t,{children:[e.jsx(r,{fontSize:"sm",fontWeight:"semibold",color:"fg.default",display:"inline",children:"Status: "}),e.jsx(r,{fontSize:"sm",color:"fg.muted",display:"inline",children:se(d.statusDescription)})]})]})]}),e.jsxs(t,{children:[e.jsx(r,{fontSize:"sm",fontWeight:"bold",mb:2,children:"Job Instructions (optional):"}),e.jsx(Le,{placeholder:"Enter any specific instructions for this translation job...",value:u,onChange:o=>j(o.target.value),rows:3})]}),e.jsxs(S,{gap:3,children:[e.jsx(L,{colorPalette:"gray",variant:"outline",onClick:()=>{h(!1),b(null),j("")},flex:"1",disabled:O.isPending,children:"Cancel"}),e.jsx(L,{colorPalette:"green",onClick:je,loading:O.isPending,flex:"1",children:"Push Job"})]})]})})]})})]}),e.jsxs(D,{open:g,onOpenChange:o=>x(o.open),children:[e.jsx(I,{}),e.jsx(k,{children:e.jsxs(B,{maxW:"400px",children:[e.jsxs(F,{children:[e.jsx(E,{children:"Job Creation Failed"}),e.jsx(U,{})]}),e.jsx(N,{children:e.jsxs(w,{gap:4,align:"stretch",children:[e.jsx(r,{color:"red.600",children:C}),e.jsx(L,{colorPalette:"red",onClick:()=>x(!1),w:"100%",children:"Close"})]})})]})})]}),e.jsxs(D,{open:J,onOpenChange:o=>{o.open||X()},children:[e.jsx(I,{}),e.jsx(k,{children:e.jsxs(B,{maxW:"400px",children:[e.jsxs(F,{children:[e.jsx(E,{children:"Job Started Successfully"}),e.jsx(U,{})]}),e.jsx(N,{children:p&&e.jsxs(w,{gap:4,align:"stretch",children:[e.jsx(t,{children:e.jsxs(w,{gap:2,align:"stretch",children:[e.jsxs(t,{children:[e.jsx(r,{fontSize:"sm",fontWeight:"semibold",color:"fg.default",display:"inline",children:"Job ID: "}),e.jsx(r,{fontSize:"sm",fontFamily:"mono",color:"blue.600",cursor:"pointer",_hover:{textDecoration:"underline"},onClick:o=>{o.preventDefault(),window.open(`/job/${p.jobGuid}`,"_blank")},display:"inline",children:p.jobGuid})]}),e.jsxs(t,{children:[e.jsx(r,{fontSize:"sm",fontWeight:"semibold",color:"fg.default",display:"inline",children:"Provider: "}),e.jsx(r,{fontSize:"sm",color:"blue.600",fontFamily:"mono",display:"inline",children:p.translationProvider})]}),e.jsxs(t,{children:[e.jsx(r,{fontSize:"sm",fontWeight:"semibold",color:"fg.default",display:"inline",children:"Language Pair: "}),e.jsxs(r,{fontSize:"sm",color:"purple.600",fontWeight:"medium",display:"inline",children:[p.sourceLang," → ",p.targetLang]})]}),e.jsxs(t,{children:[e.jsx(r,{fontSize:"sm",fontWeight:"semibold",color:"fg.default",display:"inline",children:"Status: "}),e.jsx(r,{fontSize:"sm",fontWeight:"bold",color:p.status==="completed"?"green.600":"orange.600",display:"inline",children:p.status.toUpperCase()})]}),p.statusDescription&&e.jsxs(t,{children:[e.jsx(r,{fontSize:"sm",fontWeight:"semibold",color:"fg.default",mb:1,children:"Description:"}),e.jsx(r,{fontSize:"sm",color:"fg.muted",pl:2,borderLeft:"2px",borderColor:"blue.200",children:se(p.statusDescription)})]})]})}),e.jsx(t,{children:e.jsx(L,{colorPalette:"blue",onClick:X,w:"100%",children:"Close & Remove TUs from Cart"})})]})})]})})]})]})};export{ke as C,qe as L,Be as P,Fe as S,Ee as a,Ne as b,Ue as c,He as d,_e as e,V as f,Ge as g,se as r};
