import{i as N,h as re,k as se,e as oe,u as ne,r as a,j as e,B as r,S as I,T as o,F as z,f as ie}from"./index-CE6JgXwC.js";import{A as le}from"./namespace-DqVzlNZ0.js";import{C as O,a as D,b as E,I as j}from"./input-C_b-hL0i.js";import{V as x}from"./v-stack-BLV93Nj6.js";import{T as G,a as M,b as q,c as U,d as L}from"./tooltip-DsbPmc5I.js";import{Q as ae,u as ce,f as de}from"./api-CQ_emPlI.js";import"./index-BHll-Wur.js";import"./use-field-context-DPgnX2eS.js";import"./use-presence-context-w7qGDwCc.js";var he=class extends ae{constructor(s,i){super(s,i)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(s){super.setOptions({...s,behavior:N()})}getOptimisticResult(s){return s.behavior=N(),super.getOptimisticResult(s)}fetchNextPage(s){return this.fetch({...s,meta:{fetchMore:{direction:"forward"}}})}fetchPreviousPage(s){return this.fetch({...s,meta:{fetchMore:{direction:"backward"}}})}createResult(s,i){const{state:d}=s,m=super.createResult(s,i),{isFetching:w,isRefetching:W,isError:h,isRefetchError:F}=m,f=d.fetchMeta?.fetchMore?.direction,v=h&&f==="forward",S=w&&f==="forward",c=h&&f==="backward",y=w&&f==="backward";return{...m,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:se(i,d.data),hasPreviousPage:re(i,d.data),isFetchNextPageError:v,isFetchingNextPage:S,isFetchPreviousPageError:c,isFetchingPreviousPage:y,isRefetchError:F&&!v&&!c,isRefetching:W&&!S&&!y}}};function ue(s,i){return ce(s,he)}function T(s){return s.map(i=>typeof i=="string"?i:`{{${i.t}}}`).join("")}function Q(s){return new Date(s).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"})}const Ce=()=>{const{sourceLang:s,targetLang:i}=oe();ne();const[d,m]=a.useState(new Set),[w,W]=a.useState({guid:"",rid:"",sid:"",nsrc:"",ntgt:"",q:"",translationProvider:"",ts:"",jobGuid:""}),[h,F]=a.useState({guid:"",rid:"",sid:"",nsrc:"",ntgt:"",q:"",translationProvider:"",ts:"",jobGuid:""}),f=a.useRef(),v=a.useRef(),S=a.useRef(null),c=a.useRef({}),y=a.useMemo(()=>["tmSearch",s,i,w],[s,i,w]),{data:B,isLoading:P,isError:$,error:J,fetchNextPage:A,hasNextPage:R,isFetchingNextPage:k}=ue({queryKey:y,queryFn:async({pageParam:t=1})=>{const n=new URLSearchParams({sourceLang:s,targetLang:i,page:t.toString(),limit:"100",...Object.fromEntries(Object.entries(w).filter(([C,te])=>te.trim()!==""))});return await de(`/api/tm/search?${n}`)},getNextPageParam:(t,n)=>t.data.length===parseInt(t.limit)?n.length+1:void 0,staleTime:3e4,refetchOnWindowFocus:!1,placeholderData:t=>t}),u=a.useMemo(()=>B?.pages.flatMap(t=>t.data)||[],[B]),_=a.useCallback(t=>{P||k||(f.current&&f.current.disconnect(),f.current=new IntersectionObserver(n=>{n[0].isIntersecting&&R&&A()}),t&&f.current.observe(t))},[P,k,R,A]),g=a.useCallback(t=>{S.current=t},[]),b=a.useCallback(()=>{S.current=null},[]),p=a.useCallback((t,n)=>{F(l=>({...l,[t]:n})),m(new Set),clearTimeout(v.current),v.current=setTimeout(()=>{W(l=>({...l,[t]:n}))},300)},[]),V=(t,n)=>{const l=new Set(d);n?l.add(t):l.delete(t),m(l)},H=t=>{if(t){const n=new Set(u.map((l,C)=>C));m(n)}else m(new Set)},K=()=>{const t=sessionStorage.getItem("tmCart");return t?JSON.parse(t):{}},X=t=>{sessionStorage.setItem("tmCart",JSON.stringify(t))},Y=()=>{const t=K(),n=`${s}|${i}`;t[n]||(t[n]={sourceLang:s,targetLang:i,tus:[]});const l=Array.from(d).map(C=>u[C]);t[n].tus.push(...l),X(t),m(new Set),window.dispatchEvent(new Event("cartUpdated"))},Z=u.length>0&&d.size===u.length,ee=d.size>0&&d.size<u.length;return a.useEffect(()=>{if(S.current&&c.current[S.current]){const t=c.current[S.current];setTimeout(()=>{if(t&&document.contains(t)){t.focus();const n=t.value.length;t.setSelectionRange(n,n)}},10)}},[u]),a.useEffect(()=>()=>{v.current&&clearTimeout(v.current)},[]),P&&u.length===0&&!B?e.jsx(r,{display:"flex",justifyContent:"center",mt:10,children:e.jsx(I,{size:"xl"})}):$?e.jsx(r,{mt:5,px:6,children:e.jsx(le,{status:"error",children:e.jsxs(r,{children:[e.jsx(o,{fontWeight:"bold",children:"Error"}),e.jsx(o,{children:J?.message||"Failed to fetch translation memory data"})]})})}):e.jsx(r,{py:6,px:6,children:e.jsxs(x,{gap:6,align:"stretch",children:[e.jsx(r,{children:e.jsxs(z,{align:"center",justify:"space-between",mb:2,children:[e.jsxs(z,{align:"center",gap:3,children:[e.jsxs(o,{fontSize:"2xl",fontWeight:"bold",children:["Translation Memory: ",s," â†’ ",i]}),P&&e.jsx(I,{size:"sm"})]}),d.size>0&&e.jsxs(ie,{colorPalette:"blue",onClick:Y,children:["Add to Cart (",d.size," ",d.size===1?"TU":"TUs",")"]})]})}),e.jsxs(r,{bg:"white",borderRadius:"lg",shadow:"sm",overflow:"auto",maxH:"70vh",children:[e.jsxs(r,{as:"table",w:"100%",fontSize:"sm",children:[e.jsx(r,{as:"thead",position:"sticky",top:0,bg:"blue.subtle",zIndex:1,borderBottom:"2px",borderColor:"blue.muted",shadow:"sm",children:e.jsxs(r,{as:"tr",children:[e.jsx(r,{as:"th",p:3,borderBottom:"1px",borderColor:"border.default",minW:"60px",textAlign:"center",children:e.jsxs(O,{checked:Z,onCheckedChange:t=>H(t.checked),children:[e.jsx(D,{ref:t=>{t&&(t.indeterminate=ee)}}),e.jsx(E,{})]})}),e.jsx(r,{as:"th",p:3,borderBottom:"1px",borderColor:"border.default",minW:"120px",textAlign:"left",children:e.jsxs(x,{gap:2,align:"stretch",children:[e.jsx(o,{fontSize:"sm",fontWeight:"bold",color:"blue.600",children:"GUID"}),e.jsx(j,{size:"xs",placeholder:"Filter GUID...",value:h.guid,onChange:t=>p("guid",t.target.value),onFocus:()=>g("guid"),onBlur:b,ref:t=>{t&&(c.current.guid=t)},bg:"yellow.subtle"},"guid-input")]})}),e.jsx(r,{as:"th",p:3,borderBottom:"1px",borderColor:"border.default",minW:"120px",textAlign:"left",children:e.jsxs(x,{gap:2,align:"stretch",children:[e.jsx(o,{fontSize:"sm",fontWeight:"bold",color:"blue.600",children:"JOB GUID"}),e.jsx(j,{size:"xs",placeholder:"Filter Job GUID...",value:h.jobGuid,onChange:t=>p("jobGuid",t.target.value),onFocus:()=>g("jobGuid"),onBlur:b,ref:t=>{t&&(c.current.jobGuid=t)},bg:"yellow.subtle"},"jobGuid-input")]})}),e.jsx(r,{as:"th",p:3,borderBottom:"1px",borderColor:"border.default",minW:"150px",textAlign:"left",children:e.jsxs(x,{gap:2,align:"stretch",children:[e.jsx(o,{fontSize:"sm",fontWeight:"bold",color:"blue.600",children:"RID"}),e.jsx(j,{size:"xs",placeholder:"Filter RID...",value:h.rid,onChange:t=>p("rid",t.target.value),onFocus:()=>g("rid"),onBlur:b,ref:t=>{t&&(c.current.rid=t)},bg:"yellow.subtle"},"rid-input")]})}),e.jsx(r,{as:"th",p:3,borderBottom:"1px",borderColor:"border.default",minW:"150px",textAlign:"left",children:e.jsxs(x,{gap:2,align:"stretch",children:[e.jsx(o,{fontSize:"sm",fontWeight:"bold",color:"blue.600",children:"SID"}),e.jsx(j,{size:"xs",placeholder:"Filter SID...",value:h.sid,onChange:t=>p("sid",t.target.value),onFocus:()=>g("sid"),onBlur:b,ref:t=>{t&&(c.current.sid=t)},bg:"yellow.subtle"},"sid-input")]})}),e.jsx(r,{as:"th",p:3,borderBottom:"1px",borderColor:"border.default",minW:"350px",textAlign:"left",children:e.jsxs(x,{gap:2,align:"stretch",children:[e.jsx(o,{fontSize:"sm",fontWeight:"bold",color:"blue.600",children:"NSRC"}),e.jsx(j,{size:"xs",placeholder:"Filter source...",value:h.nsrc,onChange:t=>p("nsrc",t.target.value),onFocus:()=>g("nsrc"),onBlur:b,ref:t=>{t&&(c.current.nsrc=t)},bg:"yellow.subtle",dir:s?.startsWith("he")||s?.startsWith("ar")?"rtl":"ltr"},"nsrc-input")]})}),e.jsx(r,{as:"th",p:3,borderBottom:"1px",borderColor:"border.default",minW:"350px",textAlign:"left",children:e.jsxs(x,{gap:2,align:"stretch",children:[e.jsx(o,{fontSize:"sm",fontWeight:"bold",color:"blue.600",children:"NTGT"}),e.jsx(j,{size:"xs",placeholder:"Filter target...",value:h.ntgt,onChange:t=>p("ntgt",t.target.value),onFocus:()=>g("ntgt"),onBlur:b,ref:t=>{t&&(c.current.ntgt=t)},bg:"yellow.subtle",dir:i?.startsWith("he")||i?.startsWith("ar")?"rtl":"ltr"},"ntgt-input")]})}),e.jsx(r,{as:"th",p:3,borderBottom:"1px",borderColor:"border.default",minW:"40px",textAlign:"left",children:e.jsxs(x,{gap:2,align:"stretch",children:[e.jsx(o,{fontSize:"sm",fontWeight:"bold",color:"blue.600",children:"Q"}),e.jsx(j,{size:"xs",placeholder:"Quality...",value:h.q,onChange:t=>p("q",t.target.value),onFocus:()=>g("q"),onBlur:b,ref:t=>{t&&(c.current.q=t)},bg:"yellow.subtle"},"q-input")]})}),e.jsx(r,{as:"th",p:3,borderBottom:"1px",borderColor:"border.default",minW:"120px",textAlign:"left",children:e.jsxs(x,{gap:2,align:"stretch",children:[e.jsx(o,{fontSize:"sm",fontWeight:"bold",color:"blue.600",children:"Provider"}),e.jsx(j,{size:"xs",placeholder:"Provider...",value:h.translationProvider,onChange:t=>p("translationProvider",t.target.value),onFocus:()=>g("translationProvider"),onBlur:b,ref:t=>{t&&(c.current.translationProvider=t)},bg:"yellow.subtle"},"translationProvider-input")]})}),e.jsx(r,{as:"th",p:3,borderBottom:"1px",borderColor:"border.default",minW:"120px",textAlign:"left",children:e.jsxs(x,{gap:2,align:"stretch",children:[e.jsx(o,{fontSize:"sm",fontWeight:"bold",color:"blue.600",children:"Timestamp"}),e.jsx(j,{size:"xs",placeholder:"Date...",value:h.ts,onChange:t=>p("ts",t.target.value),onFocus:()=>g("ts"),onBlur:b,ref:t=>{t&&(c.current.ts=t)},bg:"yellow.subtle"},"ts-input")]})})]})}),e.jsx(r,{as:"tbody",children:u.map((t,n)=>e.jsxs(r,{as:"tr",ref:n===u.length-20?_:null,_hover:{bg:"gray.subtle"},children:[e.jsx(r,{as:"td",p:3,borderBottom:"1px",borderColor:"border.subtle",textAlign:"center",children:e.jsxs(O,{checked:d.has(n),onCheckedChange:l=>V(n,l.checked),children:[e.jsx(D,{}),e.jsx(E,{})]})}),e.jsx(r,{as:"td",p:3,borderBottom:"1px",borderColor:"border.subtle",children:e.jsx(o,{fontSize:"xs",fontFamily:"mono",color:"blue.600",userSelect:"all",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxW:"100px",children:t.guid})}),e.jsx(r,{as:"td",p:3,borderBottom:"1px",borderColor:"border.subtle",children:e.jsx(o,{fontSize:"xs",fontFamily:"mono",color:"green.600",userSelect:"all",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxW:"100px",cursor:"pointer",_hover:{textDecoration:"underline"},onClick:l=>{l.preventDefault(),window.open(`/job/${t.jobGuid}`,"_blank")},children:t.jobGuid})}),e.jsx(r,{as:"td",p:3,borderBottom:"1px",borderColor:"border.subtle",children:e.jsx(o,{fontSize:"xs",wordBreak:"break-all",whiteSpace:"normal",children:t.rid})}),e.jsx(r,{as:"td",p:3,borderBottom:"1px",borderColor:"border.subtle",children:e.jsx(o,{fontSize:"xs",wordBreak:"break-all",whiteSpace:"normal",children:t.sid})}),e.jsx(r,{as:"td",p:3,borderBottom:"1px",borderColor:"border.subtle",children:t.notes?e.jsxs(G,{children:[e.jsx(M,{asChild:!0,children:e.jsx(o,{fontSize:"xs",noOfLines:2,cursor:"help",dir:s?.startsWith("he")||s?.startsWith("ar")?"rtl":"ltr",children:T(t.nsrc)})}),e.jsx(q,{children:e.jsxs(U,{maxW:"400px",bg:"yellow.100",borderWidth:"1px",borderColor:"yellow.300",shadow:"lg",children:[e.jsx(L,{}),e.jsxs(r,{children:[t.notes.desc&&e.jsx(o,{fontSize:"sm",mb:2,whiteSpace:"pre-wrap",color:"black",children:t.notes.desc}),t.notes.ph&&e.jsxs(r,{children:[e.jsx(o,{fontSize:"xs",fontWeight:"bold",color:"gray.600",mb:1,children:"Placeholders:"}),Object.entries(t.notes.ph).map(([l,C])=>e.jsxs(r,{mb:1,children:[e.jsx(o,{fontSize:"xs",fontFamily:"mono",color:"blue.600",children:l}),e.jsxs(o,{fontSize:"xs",color:"gray.600",children:[C.desc," (e.g., ",C.sample,")"]})]},l))]})]})]})})]}):e.jsx(o,{fontSize:"xs",noOfLines:2,dir:s?.startsWith("he")||s?.startsWith("ar")?"rtl":"ltr",children:T(t.nsrc)})}),e.jsx(r,{as:"td",p:3,borderBottom:"1px",borderColor:"border.subtle",children:e.jsx(o,{fontSize:"xs",noOfLines:2,dir:i?.startsWith("he")||i?.startsWith("ar")?"rtl":"ltr",children:T(t.ntgt)})}),e.jsx(r,{as:"td",p:3,borderBottom:"1px",borderColor:"border.subtle",children:e.jsx(o,{fontSize:"xs",children:t.q})}),e.jsx(r,{as:"td",p:3,borderBottom:"1px",borderColor:"border.subtle",children:e.jsx(o,{fontSize:"xs",children:t.translationProvider})}),e.jsx(r,{as:"td",p:3,borderBottom:"1px",borderColor:"border.subtle",children:e.jsxs(G,{children:[e.jsx(M,{asChild:!0,children:e.jsx(o,{fontSize:"xs",color:"fg.muted",cursor:"help",children:Q(t.ts)})}),e.jsx(q,{children:e.jsxs(U,{children:[e.jsx(L,{}),e.jsxs(o,{fontSize:"sm",children:["Job Date: ",Q(t.updatedAt)]})]})})]})})]},`${t.guid}-${n}`))})]}),k&&e.jsx(z,{justify:"center",p:4,children:e.jsx(I,{size:"md"})}),!R&&u.length>0&&e.jsx(z,{justify:"center",p:4,children:e.jsx(o,{color:"fg.muted",fontSize:"sm",children:"No more results"})}),u.length===0&&!P&&e.jsx(z,{justify:"center",p:8,children:e.jsx(o,{color:"fg.muted",children:"No translation units found for the current filters"})})]})]})})};export{Ce as default};
