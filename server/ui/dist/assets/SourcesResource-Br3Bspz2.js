import{al as K,A as Q,ag as V,r as x,u as R,j as e,B as t,S as _,F as p,T as s,d as f,aq as J,ar as X,as as B,at as I,E as Z,H as Y,J as ee,K as re,N as te,O as oe,Q as se,U as le,a as ne,am as F,an as A,ao as D}from"./vendor-BVgSJH5C.js";import{a as P,b as ae,r as W,c as ie,f as O}from"./index-543A5WcJ.js";function de(m){return m.map((u,j)=>{if(typeof u=="string")return u;if(u.v){const g=u.t==="x"?"purple.600":"orange.600";return e.jsx(s,{as:"span",fontFamily:"mono",color:g,fontWeight:"bold",children:u.v},j)}else return`{{${u.t}}}`})}const xe=()=>{const{channelId:m}=K(),u=Q(),[j]=V(),g=j.get("rid"),S=j.get("guid"),[k,M]=x.useState("segments"),w=x.useRef(null),[c,y]=x.useState(new Set),[b,L]=x.useState(""),{data:l,isLoading:N,error:v}=R({queryKey:["resource",m,g],queryFn:()=>O(`/api/resource/${m}?rid=${encodeURIComponent(g)}`),enabled:!!g}),{data:ce={}}=R({queryKey:["info"],queryFn:()=>O("/api/info")}),{defaultGroup:z,defaultFormat:C,segments:d}=x.useMemo(()=>{if(!l?.segments)return{defaultGroup:null,defaultFormat:null,segments:[]};const r={},a={};l.segments.forEach(i=>{const h=i.group||"(no group)",T=i.mf||"text";r[h]=(r[h]||0)+1,a[T]=(a[T]||0)+1});const o=Object.keys(r).reduce((i,h)=>r[i]>r[h]?i:h,Object.keys(r)[0]),n=Object.keys(a).reduce((i,h)=>a[i]>a[h]?i:h,Object.keys(a)[0]);return{defaultGroup:o,defaultFormat:n,segments:l.segments}},[l?.segments]),E=(r,a)=>{const o=new Set(c);a?o.add(r):o.delete(r),y(o)},G=r=>{if(r){const a=new Set(d.map((o,n)=>n));y(a)}else y(new Set)},U=()=>{if(!b){alert("Please select a target language first");return}const a=Array.from(c).map(o=>d[o]).map(o=>({guid:o.guid,rid:l.id,sid:o.sid,nsrc:o.nstr,notes:o.notes}));ie(l.sourceLang,b,m,a),y(new Set),L("")},q=d.length>0&&c.size===d.length,H=c.size>0&&c.size<d.length,$=x.useMemo(()=>l?.targetLangs?l.targetLangs.filter(r=>r!==l.sourceLang):[],[l?.targetLangs,l?.sourceLang]);return x.useEffect(()=>{S&&d.length>0&&w.current&&setTimeout(()=>{w.current&&w.current.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})},100)},[S,d,k]),g?N?e.jsx(t,{display:"flex",justifyContent:"center",mt:10,children:e.jsx(_,{size:"xl"})}):v?e.jsx(t,{mt:5,px:6,children:e.jsx(P,{error:v,fallbackMessage:"Failed to fetch resource data"})}):e.jsxs(t,{py:6,px:6,h:"100vh",display:"flex",flexDirection:"column",children:[e.jsx(ae,{channelId:l.channel,project:l.prj,resource:l.id,onBackClick:()=>u(`/sources/${m}/${l.prj}`),backLabel:"Back to project",extraContent:e.jsxs(p,{gap:4,align:"center",wrap:"wrap",children:[e.jsxs(t,{children:[e.jsx(s,{fontSize:"sm",color:"fg.muted",mb:1,children:"Source Language"}),e.jsx(f,{colorPalette:"blue",size:"sm",children:l.sourceLang})]}),e.jsxs(t,{children:[e.jsx(s,{fontSize:"sm",color:"fg.muted",mb:1,children:"Resource Format"}),e.jsx(f,{colorPalette:"purple",size:"sm",children:l.resourceFormat})]}),z&&e.jsxs(t,{children:[e.jsx(s,{fontSize:"sm",color:"fg.muted",mb:1,children:"Default Group"}),e.jsx(f,{colorPalette:"gray",size:"sm",children:z})]}),C&&e.jsxs(t,{children:[e.jsx(s,{fontSize:"sm",color:"fg.muted",mb:1,children:"Default Format"}),e.jsx(f,{colorPalette:"cyan",size:"sm",children:C})]}),e.jsxs(t,{children:[e.jsxs(s,{fontSize:"sm",color:"fg.muted",mb:1,children:["Target Languages (",l.targetLangs.length,")"]}),e.jsx(p,{wrap:"wrap",gap:1,children:l.targetLangs.map(r=>e.jsx(f,{colorPalette:"orange",size:"sm",children:r},r))})]}),l.modified&&e.jsxs(t,{children:[e.jsx(s,{fontSize:"sm",color:"fg.muted",mb:1,children:"Last Modified"}),e.jsx(s,{fontSize:"sm",color:"fg.default",title:new Date(l.modified).toLocaleString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZoneName:"short"}),children:(()=>{const r=new Date,a=new Date(l.modified),o=Math.floor((r-a)/1e3),n=new Intl.RelativeTimeFormat("en",{numeric:"auto",style:"short"});return o<60?n.format(-o,"second"):o<3600?n.format(-Math.floor(o/60),"minute"):o<86400?n.format(-Math.floor(o/3600),"hour"):o<2592e3?n.format(-Math.floor(o/86400),"day"):o<31536e3?n.format(-Math.floor(o/2592e3),"month"):n.format(-Math.floor(o/31536e3),"year")})()})]})]})}),e.jsx(t,{flex:"1",display:"flex",flexDirection:"column",children:e.jsxs(J,{value:k,onValueChange:r=>M(r.value),children:[e.jsxs(X,{mb:4,children:[e.jsxs(B,{value:"segments",children:["Segments (",d.length,")"]}),e.jsx(B,{value:"raw",children:"Raw Content"})]}),e.jsxs(I,{value:"segments",flex:"1",display:"flex",flexDirection:"column",children:[c.size>0&&e.jsx(t,{bg:"blue.subtle",borderBottom:"1px",borderColor:"blue.muted",shadow:"md",borderLeft:"4px",borderLeftColor:"blue.500",px:6,py:4,mb:4,borderRadius:"md",children:e.jsxs(p,{align:"center",justify:"space-between",children:[e.jsxs(s,{fontSize:"md",fontWeight:"semibold",color:"blue.700",children:[c.size," ",c.size===1?"segment":"segments"," selected"]}),e.jsxs(p,{align:"center",gap:3,children:[e.jsx(s,{fontSize:"sm",color:"blue.600",children:"Target Language:"}),e.jsxs(Z,{size:"sm",width:"200px",value:b?[b]:[],positioning:{strategy:"absolute",placement:"bottom-start",flip:!0,gutter:4},children:[e.jsxs(Y,{children:[e.jsx(s,{fontSize:"sm",flex:"1",textAlign:"left",children:b||"Select target language"}),e.jsx(ee,{})]}),e.jsx(re,{children:e.jsx(te,{zIndex:1e3,bg:"white",borderWidth:"1px",borderColor:"border.default",borderRadius:"md",shadow:"lg",maxH:"200px",overflow:"auto",children:$.map(r=>e.jsxs(oe,{item:r,value:r,onClick:()=>L(r),children:[e.jsx(se,{children:r}),e.jsx(le,{})]},r))})})]}),e.jsx(ne,{colorPalette:"blue",onClick:U,disabled:!b,size:"sm",children:"Add to Cart"})]})]})}),e.jsxs(t,{flex:"1",bg:"white",borderRadius:"lg",shadow:"sm",overflow:"auto",children:[e.jsxs(t,{as:"table",w:"100%",fontSize:"sm",tableLayout:"fixed",children:[e.jsx(t,{as:"thead",position:"sticky",top:0,bg:"blue.subtle",zIndex:1,borderBottom:"2px",borderColor:"blue.muted",shadow:"sm",children:e.jsxs(t,{as:"tr",children:[e.jsx(t,{as:"th",p:3,borderBottom:"1px",borderColor:"border.default",minW:"60px",textAlign:"center",children:e.jsxs(F,{checked:q,onCheckedChange:r=>G(r.checked),children:[e.jsx(A,{ref:r=>{r&&(r.indeterminate=H)}}),e.jsx(D,{})]})}),e.jsx(t,{as:"th",p:3,textAlign:"left",borderBottom:"1px",borderColor:"border.default",w:"12%",children:e.jsx(s,{fontSize:"sm",fontWeight:"bold",color:"blue.600",children:"GUID"})}),e.jsx(t,{as:"th",p:3,textAlign:"left",borderBottom:"1px",borderColor:"border.default",w:"8%",children:e.jsx(s,{fontSize:"sm",fontWeight:"bold",color:"blue.600",children:"NID"})}),e.jsx(t,{as:"th",p:3,textAlign:"left",borderBottom:"1px",borderColor:"border.default",w:"20%",children:e.jsx(s,{fontSize:"sm",fontWeight:"bold",color:"blue.600",children:"STRING ID"})}),e.jsx(t,{as:"th",p:3,textAlign:"left",borderBottom:"1px",borderColor:"border.default",w:"35%",children:e.jsx(s,{fontSize:"sm",fontWeight:"bold",color:"blue.600",children:"SOURCE TEXT"})}),e.jsx(t,{as:"th",p:3,textAlign:"left",borderBottom:"1px",borderColor:"border.default",w:"20%",children:e.jsx(s,{fontSize:"sm",fontWeight:"bold",color:"blue.600",children:"NOTES"})})]})}),e.jsx(t,{as:"tbody",children:d.map((r,a)=>{const o=S&&r.guid===S;return e.jsxs(t,{as:"tr",ref:o?w:null,bg:o?"yellow.subtle":"transparent",_hover:{bg:o?"yellow.muted":"gray.subtle"},borderLeft:o?"4px":"0",borderLeftColor:o?"yellow.solid":"transparent",children:[e.jsx(t,{as:"td",p:3,borderBottom:"1px",borderColor:"border.subtle",textAlign:"center",children:e.jsxs(F,{checked:c.has(a),onCheckedChange:n=>E(a,n.checked),children:[e.jsx(A,{}),e.jsx(D,{})]})}),e.jsx(t,{as:"td",p:3,borderBottom:"1px",borderColor:"border.subtle",children:e.jsx(s,{fontSize:"xs",fontFamily:"mono",color:"orange.600",userSelect:"all",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxW:"100px",title:r.guid,children:r.guid})}),e.jsx(t,{as:"td",p:3,borderBottom:"1px",borderColor:"border.subtle",children:e.jsx(s,{fontSize:"xs",fontFamily:"mono",color:"orange.600",userSelect:"all",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxW:"100px",title:r.nid||"",children:r.nid||""})}),e.jsx(t,{as:"td",p:3,borderBottom:"1px",borderColor:"border.subtle",children:e.jsx(s,{fontSize:"xs",fontFamily:"mono",color:"purple.600",wordBreak:"break-all",children:r.sid})}),e.jsxs(t,{as:"td",p:3,borderBottom:"1px",borderColor:"border.subtle",children:[e.jsx(s,{fontSize:"xs",noOfLines:3,children:de(r.nstr)}),(()=>{const n=r.group||"(no group)";return n!==z?e.jsxs(s,{fontSize:"xs",color:"gray.600",fontStyle:"italic",mt:1,children:["Group:",e.jsx(f,{colorPalette:"gray",size:"sm",ml:1,children:n})]}):null})(),(()=>{const n=r.mf||"text";return n!==C?e.jsxs(s,{fontSize:"xs",color:"gray.600",fontStyle:"italic",mt:1,children:["Format:",e.jsx(f,{colorPalette:"cyan",size:"sm",ml:1,children:n})]}):null})()]}),e.jsxs(t,{as:"td",p:3,borderBottom:"1px",borderColor:"border.subtle",children:[r.notes?.desc&&e.jsx(s,{fontSize:"xs",color:"gray.600",fontStyle:"italic",children:W(r.notes.desc)}),r.notes?.ph&&Object.keys(r.notes.ph).length>0&&e.jsxs(t,{mt:r.notes?.desc?2:0,children:[e.jsx(s,{fontSize:"xs",color:"gray.600",fontWeight:"semibold",mb:1,children:"Placeholders:"}),Object.entries(r.notes.ph).map(([n,i])=>e.jsxs(s,{fontSize:"xs",color:"gray.600",mb:1,children:[e.jsx(s,{as:"span",fontFamily:"mono",color:"purple.600",fontWeight:"bold",children:n}),": ",W(i.desc),i.sample&&e.jsxs(s,{as:"span",color:"gray.500",children:[" ",'(e.g., "',i.sample,'")']})]},n))]})]})]},r.guid)})})]}),d.length===0&&e.jsx(p,{justify:"center",p:8,children:e.jsx(s,{color:"fg.muted",children:"No segments found in this resource"})})]})]}),e.jsx(I,{value:"raw",flex:"1",display:"flex",flexDirection:"column",children:e.jsx(t,{flex:"1",bg:"white",borderRadius:"lg",shadow:"sm",overflow:"auto",p:4,children:e.jsx(t,{as:"pre",fontSize:"xs",fontFamily:"mono",bg:"gray.50",p:4,borderRadius:"md",overflow:"auto",whiteSpace:"pre-wrap",wordBreak:"break-word",border:"1px",borderColor:"border.default",children:l.raw||"No raw content available"})})})]})})]}):e.jsx(t,{mt:5,px:6,children:e.jsx(P,{error:{message:"No resource ID specified in the URL."},title:"Missing Resource ID"})})};export{xe as default};
