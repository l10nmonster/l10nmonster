import{r as c,m as j,j as e,t as De,v as Te,w as ze,x as Oe,y as Re,b as Ee,g as We,z as Le,A as Me,C as Z,D as ke,G as te,H as Be,I as Je,J as Fe,B as l,F as z,T as a,S as Ne,f as P}from"./index-CE6JgXwC.js";import{u as $e}from"./useQuery-DJATtsyt.js";import{c as Ie,f as Ue}from"./api-CQ_emPlI.js";import{V as D}from"./v-stack-BLV93Nj6.js";import{B as K}from"./badge-D0XxOmqE.js";import{e as He,c as re,a as y,f as H,u as Ge,b as qe,d as Ye,n as Ve}from"./index-BHll-Wur.js";import{u as Qe}from"./use-field-context-DPgnX2eS.js";import{S as _e,a as Xe,b as Ze,c as Ke,d as et,e as tt,f as rt,g as ot}from"./select-B7OxVhQ5.js";import{b as G,a as q,s as oe,P as se}from"./use-presence-context-w7qGDwCc.js";const[ne,st]=re({name:"RenderStrategyContext",hookName:"useRenderStrategyContext",providerName:"<RenderStrategyPropsProvider />"}),ie=t=>He()(t,["lazyMount","unmountOnExit"]),[ae,w]=re({name:"DialogContext",hookName:"useDialogContext",providerName:"<DialogProvider />"}),le=c.forwardRef((t,r)=>{const n=w(),s=st(),i=G({...s,present:n.open}),u=j(n.getBackdropProps(),i.getPresenceProps(),t);return i.unmounted?null:e.jsx(y.div,{...u,ref:H(i.ref,r)})});le.displayName="DialogBackdrop";const ce=c.forwardRef((t,r)=>{const n=w(),s=j(n.getCloseTriggerProps(),t);return e.jsx(y.button,{...s,ref:r})});ce.displayName="DialogCloseTrigger";const de=c.forwardRef((t,r)=>{const n=w(),s=q(),i=j(n.getContentProps(),s.getPresenceProps(),t);return s.unmounted?null:e.jsx(y.div,{...i,ref:H(s.ref,r)})});de.displayName="DialogContent";const ue=c.forwardRef((t,r)=>{const n=w(),s=j(n.getDescriptionProps(),t);return e.jsx(y.div,{...s,ref:r})});ue.displayName="DialogDescription";const he=c.forwardRef((t,r)=>{const n=w(),s=j(n.getPositionerProps(),t);return q().unmounted?null:e.jsx(y.div,{...s,ref:r})});he.displayName="DialogPositioner";const nt=t=>{const r=c.useId(),{getRootNode:n}=Ge(),{dir:s}=qe(),i={id:r,getRootNode:n,dir:s,...t},u=Ye(De,i);return Te(u,Ve)},it=t=>{const[r,{children:n,...s}]=oe(t),[i]=ie(r),u=nt(s),h=G(j({present:u.open},r));return e.jsx(ae,{value:u,children:e.jsx(ne,{value:i,children:e.jsx(se,{value:h,children:n})})})},at=t=>{const[r,{value:n,children:s}]=oe(t),[i]=ie(r),u=G(j({present:n.open},r));return e.jsx(ae,{value:n,children:e.jsx(ne,{value:i,children:e.jsx(se,{value:u,children:s})})})},pe=c.forwardRef((t,r)=>{const n=w(),s=j(n.getTitleProps(),t);return e.jsx(y.h2,{...s,ref:r})});pe.displayName="DialogTitle";const ge=c.forwardRef((t,r)=>{const n=w(),s=q(),i=j({...n.getTriggerProps(),"aria-controls":s.unmounted?void 0:n.getTriggerProps()["aria-controls"]},t);return e.jsx(y.button,{...i,ref:r})});ge.displayName="DialogTrigger";var lt=t=>{if(!t)return;const r=ze(t),n=Oe(t),s=Re(t),i=()=>{requestAnimationFrame(()=>{t.style.height="auto";let g;r.boxSizing==="content-box"?g=t.scrollHeight-(parseFloat(r.paddingTop)+parseFloat(r.paddingBottom)):g=t.scrollHeight+parseFloat(r.borderTopWidth)+parseFloat(r.borderBottomWidth),r.maxHeight!=="none"&&g>parseFloat(r.maxHeight)?(r.overflowY==="hidden"&&(t.style.overflowY="scroll"),g=parseFloat(r.maxHeight)):r.overflowY!=="hidden"&&(t.style.overflowY="hidden"),t.style.height=`${g}px`})};t.addEventListener("input",i),t.form?.addEventListener("reset",i);const u=Object.getPrototypeOf(t),h=Object.getOwnPropertyDescriptor(u,"value");Object.defineProperty(t,"value",{...h,set(){h?.set?.apply(this,arguments),i()}});const S=new n.ResizeObserver(()=>{requestAnimationFrame(()=>i())});S.observe(t);const b=new n.MutationObserver(()=>i());return b.observe(t,{attributes:!0,attributeFilter:["rows","placeholder"]}),s.fonts?.addEventListener("loadingdone",i),()=>{t.removeEventListener("input",i),t.form?.removeEventListener("reset",i),s.fonts?.removeEventListener("loadingdone",i),S.disconnect(),b.disconnect()}};const xe=c.forwardRef((t,r)=>{const{autoresize:n,...s}=t,i=c.useRef(null),u=Qe(),h=j(u?.getTextareaProps(),{style:{resize:n?"none":void 0}},s);return c.useEffect(()=>{if(n)return lt(i.current)},[n]),e.jsx(y.textarea,{...h,ref:H(r,i)})});xe.displayName="FieldTextarea";const{withRootProvider:fe,withContext:v}=Ie({key:"dialog"});fe(at,{defaultProps:{unmountOnExit:!0,lazyMount:!0}});const k=fe(it,{defaultProps:{unmountOnExit:!0,lazyMount:!0}});v(ge,"trigger",{forwardAsChild:!0});const B=v(he,"positioner",{forwardAsChild:!0}),J=v(de,"content",{forwardAsChild:!0});v(ue,"description",{forwardAsChild:!0});const F=v(pe,"title",{forwardAsChild:!0}),N=v(ce,"closeTrigger",{forwardAsChild:!0});c.forwardRef(function(r,n){const s=w();return e.jsx(Ee.button,{...r,ref:n,onClick:()=>s.setOpen(!1)})});const $=v(le,"backdrop",{forwardAsChild:!0}),I=v("div","body");v("div","footer");const U=v("div","header"),{withContext:ct}=We({key:"textarea"}),dt=ct(xe);var ut=class extends Le{#r;#o=void 0;#e;#t;constructor(t,r){super(),this.#r=t,this.setOptions(r),this.bindMethods(),this.#s()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){const r=this.options;this.options=this.#r.defaultMutationOptions(t),Me(this.options,r)||this.#r.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#e,observer:this}),r?.mutationKey&&this.options.mutationKey&&Z(r.mutationKey)!==Z(this.options.mutationKey)?this.reset():this.#e?.state.status==="pending"&&this.#e.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#e?.removeObserver(this)}onMutationUpdate(t){this.#s(),this.#n(t)}getCurrentResult(){return this.#o}reset(){this.#e?.removeObserver(this),this.#e=void 0,this.#s(),this.#n()}mutate(t,r){return this.#t=r,this.#e?.removeObserver(this),this.#e=this.#r.getMutationCache().build(this.#r,this.options),this.#e.addObserver(this),this.#e.execute(t)}#s(){const t=this.#e?.state??ke();this.#o={...t,isPending:t.status==="pending",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset}}#n(t){te.batch(()=>{if(this.#t&&this.hasListeners()){const r=this.#o.variables,n=this.#o.context;t?.type==="success"?(this.#t.onSuccess?.(t.data,r,n),this.#t.onSettled?.(t.data,null,r,n)):t?.type==="error"&&(this.#t.onError?.(t.error,r,n),this.#t.onSettled?.(void 0,t.error,r,n))}this.listeners.forEach(r=>{r(this.#o)})})}};function ee(t,r){const n=Be(),[s]=c.useState(()=>new ut(n,t));c.useEffect(()=>{s.setOptions(t)},[s,t]);const i=c.useSyncExternalStore(c.useCallback(h=>s.subscribe(te.batchCalls(h)),[s]),()=>s.getCurrentResult(),()=>s.getCurrentResult()),u=c.useCallback((h,S)=>{s.mutate(h,S).catch(Je)},[s]);if(i.error&&Fe(s.options.throwOnError,[i.error]))throw i.error;return{...i,mutate:u,mutateAsync:i.mutate}}const ht=({langPairKey:t,tus:r,onRemoveTU:n})=>{const[s,i]=c.useState(""),[u,h]=c.useState(!1),[S,b]=c.useState(!1),[g,A]=c.useState(null),[d,f]=c.useState(""),[m,W]=c.useState(""),[C,Y]=c.useState(null),[me,V]=c.useState(!1),{data:be={},isLoading:je}=$e({queryKey:["info"],queryFn:()=>Ue("/api/info")}),ve=be.providers||[],Q=ee({mutationFn:async({sourceLang:o,targetLang:p,tus:x,providerList:T})=>{const M=await fetch("/api/dispatcher/createJobs",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sourceLang:o,targetLang:p,tus:x,providerList:T})});if(!M.ok){const Ae=await M.json();throw new Error(Ae.message||"Failed to create jobs")}return M.json()}}),L=ee({mutationFn:async({jobs:o,instructions:p})=>{const x=await fetch("/api/dispatcher/startJobs",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jobs:o,instructions:p})});if(!x.ok){const T=await x.json();throw new Error(T.message||"Failed to start jobs")}return x.json()}});function _(o){return o.map(p=>typeof p=="string"?p:`{{${p.t}}}`).join("")}function Se(o){return new Date(o).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"})}const Ce=async()=>{if(!s){alert("Please select a provider first");return}const o=Array.isArray(r)?r:r.tus;try{const x=(await Q.mutateAsync({sourceLang:R,targetLang:E,tus:o,providerList:[s]})).find(T=>T.translationProvider===s);x?(A(x),f(""),h(!0)):(W(`Provider "${s}" did not accept any of the selected translation units.`),b(!0))}catch(p){W(`Failed to create job: ${p.message}`),b(!0)}},ye=o=>{i(o)},we=async()=>{if(g)try{const o=await L.mutateAsync({jobs:[g],instructions:d||void 0}),p=o.find(x=>x.jobGuid===g.jobGuid)||o[0];Y(p),h(!1),V(!0)}catch(o){W(`Failed to start job: ${o.message}`),b(!0)}},X=()=>{if(V(!1),Y(null),A(null),f(""),g&&g.tus){const o=new Set(g.tus.map(x=>x.guid)),p=Array.isArray(r)?r:r.tus;for(let x=p.length-1;x>=0;x--)o.has(p[x].guid)&&n(t,x)}},Pe=o=>o===0?"Free":o==null?"Unknown":`$${o.toFixed(2)}`,O=Array.isArray(r)?r:r.tus,R=Array.isArray(r)?t.split("|")[0]||t.split("→")[0]:r.sourceLang,E=Array.isArray(r)?t.split("|")[1]||t.split("→").slice(1).join("→"):r.targetLang;return e.jsxs(l,{p:6,borderWidth:"1px",borderRadius:"lg",bg:"white",shadow:"sm",children:[e.jsxs(D,{gap:4,align:"stretch",children:[e.jsx(l,{children:e.jsxs(z,{align:"center",justify:"space-between",mb:2,children:[e.jsxs(z,{align:"center",gap:3,children:[e.jsx(K,{colorPalette:"blue",size:"sm",children:R}),e.jsx(a,{color:"fg.muted",fontSize:"lg",children:"→"}),e.jsx(K,{colorPalette:"green",size:"sm",children:E}),e.jsxs(z,{align:"center",gap:3,ml:4,children:[e.jsxs(_e,{size:"sm",width:"250px",value:s?[s]:[],onValueChange:o=>{},positioning:{strategy:"absolute",placement:"bottom-start",flip:!0,gutter:4},children:[e.jsxs(Xe,{children:[e.jsx(a,{fontSize:"sm",flex:"1",textAlign:"left",children:s||"Select Provider"}),e.jsx(Ze,{})]}),e.jsx(Ke,{children:e.jsx(et,{zIndex:1e3,bg:"white",borderWidth:"1px",borderColor:"border.default",borderRadius:"md",shadow:"lg",minW:"250px",maxH:"200px",overflow:"auto",children:je?e.jsxs(l,{p:3,textAlign:"center",children:[e.jsx(Ne,{size:"sm"}),e.jsx(a,{fontSize:"sm",color:"fg.muted",mt:2,children:"Loading providers..."})]}):ve.map(o=>e.jsxs(tt,{item:o,value:o,onClick:()=>ye(o),children:[e.jsx(rt,{children:o}),e.jsx(ot,{})]},o))})})]}),e.jsx(P,{size:"sm",colorPalette:"blue",onClick:Ce,disabled:!s,loading:Q.isPending,children:"Create Job"})]})]}),e.jsxs(a,{fontSize:"sm",color:"fg.muted",children:[O.length," ",O.length===1?"TU":"TUs"]})]})}),e.jsx(l,{bg:"white",borderRadius:"md",overflow:"auto",children:e.jsxs(l,{as:"table",w:"100%",fontSize:"sm",children:[e.jsx(l,{as:"thead",bg:"blue.subtle",borderBottom:"2px",borderColor:"blue.muted",shadow:"sm",children:e.jsxs(l,{as:"tr",children:[e.jsx(l,{as:"th",p:3,borderBottom:"1px",borderColor:"border.default",textAlign:"left",minW:"120px",children:e.jsx(a,{fontSize:"sm",fontWeight:"bold",color:"blue.600",children:"GUID"})}),e.jsx(l,{as:"th",p:3,borderBottom:"1px",borderColor:"border.default",textAlign:"left",minW:"350px",children:e.jsx(a,{fontSize:"sm",fontWeight:"bold",color:"blue.600",children:"SOURCE"})}),e.jsx(l,{as:"th",p:3,borderBottom:"1px",borderColor:"border.default",textAlign:"left",minW:"350px",children:e.jsx(a,{fontSize:"sm",fontWeight:"bold",color:"blue.600",children:"TARGET"})}),e.jsx(l,{as:"th",p:3,borderBottom:"1px",borderColor:"border.default",textAlign:"center",minW:"40px",children:e.jsx(a,{fontSize:"sm",fontWeight:"bold",color:"blue.600",children:"QUALITY"})}),e.jsx(l,{as:"th",p:3,borderBottom:"1px",borderColor:"border.default",textAlign:"left",minW:"120px",children:e.jsx(a,{fontSize:"sm",fontWeight:"bold",color:"blue.600",children:"PROVIDER"})}),e.jsx(l,{as:"th",p:3,borderBottom:"1px",borderColor:"border.default",textAlign:"left",minW:"120px",children:e.jsx(a,{fontSize:"sm",fontWeight:"bold",color:"blue.600",children:"TIMESTAMP"})}),e.jsx(l,{as:"th",p:3,borderBottom:"1px",borderColor:"border.default",textAlign:"center",minW:"100px",children:e.jsx(a,{fontSize:"sm",fontWeight:"bold",color:"blue.600",children:"ACTION"})})]})}),e.jsx(l,{as:"tbody",children:O.map((o,p)=>e.jsxs(l,{as:"tr",_hover:{bg:"gray.subtle"},children:[e.jsx(l,{as:"td",p:3,borderBottom:"1px",borderColor:"border.subtle",children:e.jsx(a,{fontSize:"xs",fontFamily:"mono",color:"blue.600",userSelect:"all",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxW:"100px",children:o.guid})}),e.jsx(l,{as:"td",p:3,borderBottom:"1px",borderColor:"border.subtle",children:e.jsx(a,{fontSize:"xs",noOfLines:2,dir:R?.startsWith("he")||R?.startsWith("ar")?"rtl":"ltr",children:Array.isArray(o.nsrc)?_(o.nsrc):o.nsrc})}),e.jsx(l,{as:"td",p:3,borderBottom:"1px",borderColor:"border.subtle",children:e.jsx(a,{fontSize:"xs",noOfLines:2,dir:E?.startsWith("he")||E?.startsWith("ar")?"rtl":"ltr",children:Array.isArray(o.ntgt)?_(o.ntgt):o.ntgt})}),e.jsx(l,{as:"td",p:3,borderBottom:"1px",borderColor:"border.subtle",textAlign:"center",children:e.jsx(a,{fontSize:"xs",children:o.q})}),e.jsx(l,{as:"td",p:3,borderBottom:"1px",borderColor:"border.subtle",children:e.jsx(a,{fontSize:"xs",children:o.translationProvider||o.provider})}),e.jsx(l,{as:"td",p:3,borderBottom:"1px",borderColor:"border.subtle",children:e.jsx(a,{fontSize:"xs",color:"fg.muted",children:Se(o.ts)})}),e.jsx(l,{as:"td",p:3,borderBottom:"1px",borderColor:"border.subtle",textAlign:"center",children:e.jsx(P,{size:"xs",colorPalette:"red",variant:"outline",onClick:()=>n(t,p),children:"Remove"})})]},`${o.guid}-${p}`))})]})})]}),e.jsxs(k,{open:u,onOpenChange:o=>h(o.open),children:[e.jsx($,{}),e.jsx(B,{children:e.jsxs(J,{maxW:"500px",children:[e.jsxs(U,{children:[e.jsx(F,{children:"Job Created Successfully"}),e.jsx(N,{})]}),e.jsx(I,{children:g&&e.jsxs(D,{gap:4,align:"stretch",children:[e.jsxs(l,{children:[e.jsxs(a,{fontSize:"lg",fontWeight:"bold",color:"green.600",children:[g.tus?.length||0," TUs accepted out of ",O.length," sent"]}),e.jsxs(a,{fontSize:"sm",color:"fg.muted",children:["Provider: ",s]}),e.jsxs(a,{fontSize:"sm",color:"fg.muted",children:["Estimated Cost: ",Pe(g.estimatedCost)]})]}),e.jsxs(l,{children:[e.jsx(a,{fontSize:"sm",fontWeight:"bold",mb:2,children:"Job Instructions (optional):"}),e.jsx(dt,{placeholder:"Enter any specific instructions for this translation job...",value:d,onChange:o=>f(o.target.value),rows:3})]}),e.jsxs(z,{gap:3,children:[e.jsx(P,{colorPalette:"gray",variant:"outline",onClick:()=>{h(!1),A(null),f("")},flex:"1",disabled:L.isPending,children:"Cancel"}),e.jsx(P,{colorPalette:"green",onClick:we,loading:L.isPending,flex:"1",children:"Push Job"})]})]})})]})})]}),e.jsxs(k,{open:S,onOpenChange:o=>b(o.open),children:[e.jsx($,{}),e.jsx(B,{children:e.jsxs(J,{maxW:"400px",children:[e.jsxs(U,{children:[e.jsx(F,{children:"Job Creation Failed"}),e.jsx(N,{})]}),e.jsx(I,{children:e.jsxs(D,{gap:4,align:"stretch",children:[e.jsx(a,{color:"red.600",children:m}),e.jsx(P,{colorPalette:"red",onClick:()=>b(!1),w:"100%",children:"Close"})]})})]})})]}),e.jsxs(k,{open:me,onOpenChange:o=>{o.open||X()},children:[e.jsx($,{}),e.jsx(B,{children:e.jsxs(J,{maxW:"400px",children:[e.jsxs(U,{children:[e.jsx(F,{children:"Job Started Successfully"}),e.jsx(N,{})]}),e.jsx(I,{children:C&&e.jsxs(D,{gap:4,align:"stretch",children:[e.jsxs(l,{children:[e.jsxs(a,{fontSize:"sm",color:"fg.muted",children:["Job ID: ",e.jsx(a,{as:"span",fontFamily:"mono",color:"blue.600",cursor:"pointer",_hover:{textDecoration:"underline"},onClick:o=>{o.preventDefault(),window.open(`/job/${C.jobGuid}`,"_blank")},children:C.jobGuid})]}),e.jsxs(a,{fontSize:"sm",color:"fg.muted",children:["Provider: ",C.translationProvider]}),e.jsxs(a,{fontSize:"sm",color:"fg.muted",children:["Language Pair: ",C.sourceLang," → ",C.targetLang]}),e.jsxs(a,{fontSize:"sm",color:"fg.muted",children:["Status: ",e.jsx(a,{as:"span",fontWeight:"bold",color:C.status==="completed"?"green.600":"orange.600",children:C.status})]})]}),e.jsx(l,{children:e.jsx(P,{colorPalette:"blue",onClick:X,w:"100%",children:"Close & Remove TUs from Cart"})})]})})]})})]})]})},Ct=()=>{const[t,r]=c.useState({}),[n,s]=c.useState(!0),i=()=>{try{const d=sessionStorage.getItem("tmCart");return d?JSON.parse(d):{}}catch(d){return console.error("Error loading cart:",d),{}}},u=d=>{sessionStorage.setItem("tmCart",JSON.stringify(d)),window.dispatchEvent(new Event("cartUpdated"))},h=()=>{s(!0);const d=i();r(d),s(!1)},S=(d,f)=>{const m=i();m[d]&&(Array.isArray(m[d])?(m[d].splice(f,1),m[d].length===0&&delete m[d]):(m[d].tus.splice(f,1),m[d].tus.length===0&&delete m[d]),u(m),h())},b=()=>{u({}),h()},g=()=>Object.values(t).reduce((d,f)=>Array.isArray(f)?d+f.length:d+(f.tus?f.tus.length:0),0);if(c.useEffect(()=>{h()},[]),n)return e.jsx(l,{py:6,px:6,children:e.jsx(a,{children:"Loading cart..."})});const A=g();return e.jsx(l,{py:6,px:6,children:e.jsxs(D,{gap:6,align:"stretch",children:[e.jsxs(z,{align:"center",justify:"space-between",children:[e.jsx(a,{fontSize:"2xl",fontWeight:"bold",children:"Translation Memory Cart"}),A>0&&e.jsx(P,{colorPalette:"red",variant:"outline",onClick:b,children:"Empty Cart"})]}),A===0?e.jsxs(l,{p:8,textAlign:"center",borderWidth:"1px",borderRadius:"lg",bg:"bg.muted",children:[e.jsx(a,{fontSize:"lg",color:"fg.default",mb:2,children:"Your cart is empty"}),e.jsx(a,{color:"fg.muted",children:"Add translation units from the TM pages to get started"})]}):e.jsx(D,{gap:6,align:"stretch",children:Object.entries(t).map(([d,f])=>e.jsx(ht,{langPairKey:d,tus:f,onRemoveTU:S},d))})]})})};export{Ct as default};
