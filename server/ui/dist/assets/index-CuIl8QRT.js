import{j as e,C as ze,a as Ce,T as r,B as t,F as y,b as ie,c as le,d as de,e as ae,f as ce,g as z,G,L as H,h as _,I as We,u as Te,V as w,r as S,i as Q,A as he,S as V,k as se,l as ve,m as Ae,n as Pe,o as Le,p as Re,q as $e,s as Me,t as Je,v as R,D,w as k,x as B,y as E,z as F,E as N,H as U,J as q,K as Ie,M as Oe}from"./vendor-BAKw9_tP.js";function Ue({children:o}){return e.jsx(e.Fragment,{children:o})}async function K(o,l={}){try{const a=await fetch(o,l);if(!a.ok){let n;try{n=await a.json()}catch{}const i=n?.message||`HTTP error! status: ${a.status}`,c=new Error(i);throw c.status=a.status,c.response=a,c}return await a.json()}catch(a){if(console.error("API Fetch Error:",a),a.status||a.response)throw a;const n=new Error(a.message||"Network error");throw n.originalError=a,n}}const qe=({project:o})=>{const{projectName:l,pairSummary:a,pairSummaryByStatus:n,translationStatus:i}=o,c={translated:n?.translated||0,"in flight":n?.["in flight"]||0,"low quality":n?.["low quality"]||0,untranslated:n?.untranslated||0},h=Object.values(c).reduce((u,j)=>u+j,0),g=h>0?Math.round(c.translated/h*100):0,x=h>0?Math.round(c["in flight"]/h*100):0,d=h>0?Math.round(c["low quality"]/h*100):0,b=h>0?Math.round(c.untranslated/h*100):0;return e.jsx(ze,{variant:"outline",bg:"yellow.subtle",children:e.jsxs(Ce,{children:[e.jsx(r,{fontSize:"sm",fontWeight:"semibold",mb:2,children:l}),e.jsx(t,{mb:3,children:e.jsxs(y,{align:"center",gap:2,mb:1,children:[e.jsxs(ie,{children:[e.jsx(le,{asChild:!0,children:e.jsxs(t,{flex:"1",bg:"bg.muted",rounded:"full",height:"10px",cursor:"help",position:"relative",overflow:"hidden",children:[e.jsx(t,{position:"absolute",top:"0",left:"0",height:"100%",width:`${g}%`,bg:"green.solid",transition:"width 0.3s ease"}),e.jsx(t,{position:"absolute",top:"0",left:`${g}%`,height:"100%",width:`${x}%`,bg:"blue.solid",transition:"width 0.3s ease"}),e.jsx(t,{position:"absolute",top:"0",left:`${g+x}%`,height:"100%",width:`${d}%`,bg:"yellow.solid",transition:"width 0.3s ease"}),e.jsx(t,{position:"absolute",top:"0",left:`${g+x+d}%`,height:"100%",width:`${b}%`,bg:"red.solid",transition:"width 0.3s ease"})]})}),e.jsx(de,{children:e.jsxs(ae,{maxW:"300px",bg:"bg.default",borderWidth:"1px",borderColor:"border.default",shadow:"lg",zIndex:1e3,children:[e.jsx(ce,{}),e.jsxs(t,{p:2,children:[e.jsx(r,{fontSize:"sm",fontWeight:"bold",mb:2,color:"fg.default",children:"Translation Status Details"}),i&&i.length>0?e.jsx(t,{children:i.map((u,j)=>{const C=u.q===null?"untranslated":u.q===0?"in flight":u.q>=u.minQ?"translated":"low quality",W=C==="translated"?"green.solid":C==="in flight"?"blue.solid":C==="low quality"?"yellow.solid":"red.solid";return e.jsxs(y,{align:"center",gap:2,mb:1,children:[e.jsx(t,{w:"8px",h:"8px",bg:W,borderRadius:"full"}),e.jsxs(r,{fontSize:"xs",color:"fg.default",children:["Q: ",u.q||"null"," | Segs: ",u.seg," | Words: ",u.words," | Chars: ",u.chars]})]},j)})}):e.jsxs(t,{children:[e.jsxs(y,{align:"center",gap:2,mb:1,children:[e.jsx(t,{w:"8px",h:"8px",bg:"green.solid",borderRadius:"full"}),e.jsxs(r,{fontSize:"xs",color:"fg.default",children:["Translated: ",c.translated]})]}),e.jsxs(y,{align:"center",gap:2,mb:1,children:[e.jsx(t,{w:"8px",h:"8px",bg:"blue.solid",borderRadius:"full"}),e.jsxs(r,{fontSize:"xs",color:"fg.default",children:["In Flight: ",c["in flight"]]})]}),e.jsxs(y,{align:"center",gap:2,mb:1,children:[e.jsx(t,{w:"8px",h:"8px",bg:"yellow.solid",borderRadius:"full"}),e.jsxs(r,{fontSize:"xs",color:"fg.default",children:["Low Quality: ",c["low quality"]]})]}),e.jsxs(y,{align:"center",gap:2,children:[e.jsx(t,{w:"8px",h:"8px",bg:"red.solid",borderRadius:"full"}),e.jsxs(r,{fontSize:"xs",color:"fg.default",children:["Untranslated: ",c.untranslated]})]})]})]})]})})]}),e.jsxs(r,{fontSize:"sm",color:"fg.muted",minW:"45px",children:[g,"%"]})]})}),e.jsxs(y,{gap:2,flexWrap:"wrap",align:"center",children:[e.jsxs(z,{variant:"subtle",colorPalette:"blue",children:["Segments: ",a?.segs?.toLocaleString()||"0"]}),e.jsxs(z,{variant:"subtle",colorPalette:"green",children:["Words: ",a?.words?.toLocaleString()||"0"]}),e.jsxs(z,{variant:"subtle",colorPalette:"purple",children:["Chars: ",a?.chars?.toLocaleString()||"0"]}),c.untranslated>0&&e.jsxs(z,{variant:"solid",colorPalette:"red",children:["Untranslated: ",c.untranslated.toLocaleString()]}),c["low quality"]>0&&e.jsxs(z,{variant:"solid",colorPalette:"orange",children:["Low Quality: ",c["low quality"].toLocaleString()]})]})]})})},He=({item:o,channelId:l})=>{const a=i=>{const c=new Date,h=new Date(i),g=c-h,x=Math.floor(g/1e3),d=new Intl.RelativeTimeFormat("en",{numeric:"auto",style:"short"});return x<60?d.format(-x,"second"):x<3600?d.format(-Math.floor(x/60),"minute"):x<86400?d.format(-Math.floor(x/3600),"hour"):x<2592e3?d.format(-Math.floor(x/86400),"day"):x<31536e3?d.format(-Math.floor(x/2592e3),"month"):d.format(-Math.floor(x/31536e3),"year")},n=i=>new Date(i).toLocaleString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZoneName:"short"});return e.jsx(t,{p:3,borderWidth:"1px",borderRadius:"md",borderColor:"border.default",bg:"yellow.subtle",w:"100%",children:e.jsxs(G,{templateColumns:"2fr 80px 3fr 80px 80px 100px",gap:4,alignItems:"center",children:[e.jsxs(t,{children:[e.jsx(r,{fontSize:"xs",color:"fg.muted",mb:1,children:"Project"}),e.jsx(H,{as:_,to:`/sources/${l}/${o.prj??"default"}`,fontSize:"sm",fontWeight:"semibold",color:"blue.600",_hover:{textDecoration:"underline"},children:o.prj??"default"})]}),e.jsxs(t,{children:[e.jsx(r,{fontSize:"xs",color:"fg.muted",mb:1,children:"Source"}),e.jsx(z,{colorPalette:"blue",size:"sm",children:o.sourceLang})]}),e.jsxs(t,{children:[e.jsxs(r,{fontSize:"xs",color:"fg.muted",mb:1,children:["Targets (",o.targetLangs.length,")"]}),e.jsx(y,{wrap:"wrap",gap:1,children:o.targetLangs.map(i=>e.jsx(z,{colorPalette:"green",size:"sm",children:i},i))})]}),e.jsxs(t,{textAlign:"center",children:[e.jsx(r,{fontSize:"xs",color:"fg.muted",mb:1,children:"Resources"}),e.jsx(r,{fontSize:"sm",fontWeight:"bold",color:"orange.600",children:o.resCount.toLocaleString()})]}),e.jsxs(t,{textAlign:"center",children:[e.jsx(r,{fontSize:"xs",color:"fg.muted",mb:1,children:"Segments"}),e.jsx(r,{fontSize:"sm",fontWeight:"bold",color:"purple.600",children:o.segmentCount.toLocaleString()})]}),e.jsxs(t,{textAlign:"center",children:[e.jsx(r,{fontSize:"xs",color:"fg.muted",mb:1,children:"Modified"}),e.jsxs(ie,{children:[e.jsx(le,{asChild:!0,children:e.jsx(r,{fontSize:"xs",color:"fg.muted",cursor:"help",children:a(o.lastModified)})}),e.jsx(de,{children:e.jsxs(ae,{children:[e.jsx(ce,{}),e.jsx(r,{fontSize:"sm",children:n(o.lastModified)})]})})]})]})]})})},De=(o,l)=>o?{snapText:`Snapped on ${new Date(o).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}`,importText:l?{text:"Imported from snap store ",store:l}:null}:{snapText:"Never snapped",importText:null},_e=({channelId:o,project:l,resource:a,onBackClick:n,backLabel:i="Back",snapTimestamp:c,snapStore:h,showSnapInfo:g=!1,extraContent:x=null})=>e.jsxs(t,{p:6,borderWidth:"2px",borderRadius:"lg",bg:"white",borderColor:"green.200",mb:6,children:[e.jsxs(t,{display:"flex",alignItems:"center",gap:3,flexWrap:"wrap",pb:4,borderBottom:"2px",borderColor:"green.100",children:[n&&e.jsx(We,{"aria-label":i,onClick:n,variant:"ghost",size:"sm",children:"←"}),e.jsxs(t,{children:[e.jsx(r,{fontSize:"sm",color:"fg.muted",mb:1,children:"Channel"}),e.jsx(r,{fontSize:"lg",fontWeight:"bold",color:"green.600",children:o})]}),l&&e.jsxs(t,{children:[e.jsx(r,{fontSize:"sm",color:"fg.muted",mb:1,children:"Project"}),e.jsx(r,{fontSize:"lg",fontWeight:"semibold",color:"blue.600",children:l})]}),a&&e.jsxs(t,{flex:"1",children:[e.jsx(r,{fontSize:"sm",color:"fg.muted",mb:1,children:"Resource"}),e.jsx(r,{fontSize:"lg",fontWeight:"semibold",color:"purple.600",wordBreak:"break-all",children:a})]}),g&&!l&&!a&&e.jsx(t,{flex:"1",textAlign:"right",children:(()=>{const{snapText:d,importText:b}=De(c,h);return e.jsxs(e.Fragment,{children:[e.jsx(r,{fontSize:"sm",color:"fg.muted",children:d}),b&&e.jsxs(r,{fontSize:"sm",color:"fg.muted",children:[b.text,e.jsx(r,{as:"span",fontWeight:"bold",color:"blue.600",children:b.store})]})]})})()})]}),x&&e.jsx(t,{mt:6,children:x})]});function ne(o){if(!o)return null;const l=/(https:\/\/[^\s]+)/g;return o.split(l).map((n,i)=>n.match(l)?e.jsx(r,{as:"a",href:n,target:"_blank",rel:"noopener noreferrer",color:"blue.600",textDecoration:"underline",_hover:{color:"blue.800"},children:n},`link-${i}`):n)}const xe="tmCart",ke=()=>{const o=sessionStorage.getItem(xe);return o?JSON.parse(o):{}},Be=o=>{sessionStorage.setItem(xe,JSON.stringify(o)),window.dispatchEvent(new Event("cartUpdated"))},Ee=(o,l,a,n=null)=>({guid:o.guid,channel:n||o.channel,sourceLang:l,targetLang:a,nsrc:o.nsrc,ntgt:o.ntgt}),ue=(o,l,a,n=null)=>{const i=ke(),c=`${o}|${l}`;i[c]||(i[c]={sourceLang:o,targetLang:l,tus:[]});const h=a.map(g=>Ee(g,o,l,n));i[c].tus.push(...h),Be(i)},Ge=ue,Qe=(o,l,a,n)=>{ue(o,l,n,a)},Fe=({sourceLang:o,targetLang:l,providers:a})=>{Te();const n=i=>{switch(i){case"done":return"green";case"pending":return"yellow";case"error":return"red";default:return"gray"}};return e.jsx(t,{p:6,borderWidth:"1px",borderRadius:"lg",bg:"white",shadow:"sm",w:"100%",children:e.jsxs(w,{gap:4,align:"stretch",children:[e.jsx(t,{children:e.jsx(t,{mb:2,children:e.jsxs(H,{as:_,to:`/tm/${o}/${l}`,fontSize:"lg",fontWeight:"semibold",color:"blue.600",_hover:{textDecoration:"underline"},children:[o," → ",l]})})}),e.jsx(w,{gap:3,align:"stretch",children:a.map((i,c)=>e.jsx(t,{p:3,borderWidth:"1px",borderRadius:"md",borderColor:"border.default",bg:"yellow.subtle",children:e.jsxs(G,{templateColumns:{base:"minmax(0, 2fr) 1fr 1fr 1fr 1fr",md:"minmax(0, 3fr) 1fr 1fr 1fr 1fr"},gap:{base:1,md:2},alignItems:"center",overflow:"hidden",minWidth:"0",children:[e.jsxs(t,{minWidth:"0",overflow:"hidden",children:[e.jsx(r,{fontSize:"xs",color:"fg.muted",mb:1,children:"Provider"}),e.jsx(H,{as:_,to:`/tm/${o}/${l}?translationProvider=${encodeURIComponent(i.translationProvider)}`,fontSize:"sm",fontWeight:"semibold",color:"blue.600",_hover:{textDecoration:"underline",color:"blue.700"},noOfLines:1,title:i.translationProvider,children:i.translationProvider})]}),e.jsxs(t,{textAlign:"center",children:[e.jsx(r,{fontSize:"xs",color:"fg.muted",mb:1,children:"Status"}),e.jsx(z,{colorPalette:n(i.status),size:"sm",children:i.status})]}),e.jsxs(t,{textAlign:"center",children:[e.jsx(r,{fontSize:"xs",color:"fg.muted",mb:1,children:"TUs"}),e.jsx(r,{fontSize:"sm",fontWeight:"bold",color:"purple.600",children:i.tuCount.toLocaleString()})]}),e.jsxs(t,{textAlign:"center",children:[e.jsx(r,{fontSize:"xs",color:"fg.muted",mb:1,children:"Unique"}),e.jsx(r,{fontSize:"sm",fontWeight:"bold",color:"orange.600",children:i.distinctGuids.toLocaleString()})]}),e.jsxs(t,{textAlign:"center",children:[e.jsx(r,{fontSize:"xs",color:"fg.muted",mb:1,children:"Jobs"}),e.jsx(r,{fontSize:"sm",fontWeight:"bold",color:"teal.600",children:i.jobCount.toLocaleString()})]})]})},c))})]})})},Ve=({sourceLang:o,targetLang:l})=>{const[a,n]=S.useState(!1),i=S.useRef(null);S.useEffect(()=>{const x=new IntersectionObserver(d=>{d.forEach(b=>{b.isIntersecting&&(n(!0),x.disconnect())})},{rootMargin:"200px",threshold:0});return i.current&&x.observe(i.current),()=>x.disconnect()},[]);const{data:c,isLoading:h,error:g}=Q({queryKey:["tmStats",o,l],queryFn:()=>K(`/api/tm/stats/${o}/${l}`),enabled:a});return e.jsx(t,{ref:i,minH:"200px",children:g?e.jsx(he,{status:"error",children:e.jsxs(t,{children:[e.jsxs(r,{fontWeight:"bold",children:["Error loading ",o," → ",l]}),e.jsx(r,{children:g.message||"Unknown error"})]})}):h?e.jsx(t,{display:"flex",justifyContent:"center",alignItems:"center",minH:"200px",p:6,borderWidth:"1px",borderRadius:"lg",bg:"white",shadow:"sm",children:e.jsx(V,{size:"md"})}):c?e.jsx(Fe,{sourceLang:o,targetLang:l,providers:c}):a?e.jsx(t,{display:"flex",justifyContent:"center",alignItems:"center",minH:"200px",p:6,borderWidth:"1px",borderRadius:"lg",bg:"white",shadow:"sm",children:e.jsx(r,{color:"fg.muted",children:"No data available"})}):e.jsx(t,{display:"flex",justifyContent:"center",alignItems:"center",minH:"200px",p:6,borderWidth:"1px",borderRadius:"lg",bg:"gray.50",shadow:"sm",children:e.jsx(r,{color:"fg.muted",fontSize:"sm",children:"Scroll down to load..."})})})},Ke=({providers:o,selectedProvider:l,onProviderSelect:a})=>{const n=Array.isArray(o)?o:[];return e.jsxs(t,{width:"25%",flexShrink:0,borderRight:"1px",borderColor:"border.default",p:4,bg:"yellow.subtle",minH:"70vh",children:[e.jsx(r,{fontSize:"lg",fontWeight:"bold",mb:4,children:"Providers"}),e.jsxs(w,{gap:2,align:"stretch",children:[n.map(i=>{const c=typeof i=="object"&&i?.id?i.id:i,h=typeof i=="object"&&i?.id?i.id:i,g=typeof i=="object"&&i?.type?i.type:null;return e.jsxs(t,{p:3,borderRadius:"md",cursor:"pointer",bg:l===h?"blue.subtle":"white",borderWidth:"1px",borderColor:l===h?"blue.600":"border.default",_hover:{bg:l===h?"blue.subtle":"gray.subtle"},onClick:()=>a(h),children:[e.jsx(r,{fontSize:"sm",fontWeight:"medium",noOfLines:2,children:c}),g&&e.jsx(r,{fontSize:"xs",color:"fg.muted",mt:1,children:g})]},h)}),n.length===0&&e.jsx(r,{color:"fg.muted",fontSize:"sm",textAlign:"center",mt:4,children:"No providers found"})]})]})},Ye=({providerId:o})=>{const{data:l,isLoading:a,error:n}=Q({queryKey:["provider",o],queryFn:()=>K(`/api/providers/${o}`),enabled:!!o});if(!o)return e.jsx(t,{width:"75%",p:6,textAlign:"center",children:e.jsx(r,{color:"fg.muted",children:"Select a provider to view details"})});if(a)return e.jsx(t,{width:"75%",p:6,display:"flex",justifyContent:"center",alignItems:"center",children:e.jsx(V,{size:"lg"})});if(n)return e.jsx(t,{width:"75%",p:6,children:e.jsx(he,{status:"error",children:e.jsxs(t,{children:[e.jsx(r,{fontWeight:"bold",children:"Error"}),e.jsx(r,{children:n?.message||"Failed to fetch provider details"})]})})});if(!l)return e.jsx(t,{width:"75%",p:6,textAlign:"center",children:e.jsx(r,{color:"fg.muted",children:"Provider not found"})});const{info:i,properties:c}=l,h=d=>{if(!d)return d;const b={31:"#ef4444",32:"#22c55e",33:"#eab308",34:"#3b82f6",35:"#a855f7",36:"#06b6d4",39:"inherit"},u=[];let j=0,C="inherit";const W=/\u001B\[([0-9;]*)m/g;let T;for(;(T=W.exec(d))!==null;){if(T.index>j){const p=d.slice(j,T.index);u.push(e.jsx("span",{style:{color:C},children:p},`${j}-text`))}const v=T[1];b[v]&&(C=b[v]),j=T.index+T[0].length}if(j<d.length){const v=d.slice(j);u.push(e.jsx("span",{style:{color:C},children:v},`${j}-text`))}return u.length>0?u:d},g=d=>Array.isArray(d)?d.map((b,u)=>e.jsxs(t,{display:"flex",alignItems:"flex-start",gap:2,children:[e.jsx(r,{fontSize:"sm",color:"fg.muted",mt:"1px",children:"•"}),e.jsx(r,{fontSize:"sm",flex:"1",children:h(b)})]},u)):e.jsx(r,{fontSize:"sm",children:h(d)}),x=d=>typeof d=="object"&&d!==null?!Array.isArray(d)&&Object.values(d).every(u=>typeof u=="string")&&Object.keys(d).length>0?e.jsx(t,{borderWidth:"1px",borderRadius:"md",overflow:"hidden",bg:"white",shadow:"sm",children:e.jsxs(t,{as:"table",w:"100%",fontSize:"sm",children:[e.jsx(t,{as:"thead",bg:"blue.subtle",borderBottom:"1px",borderColor:"border.default",children:e.jsxs(t,{as:"tr",children:[e.jsx(t,{as:"th",p:2,textAlign:"left",fontWeight:"semibold",color:"blue.600",children:"Key"}),e.jsx(t,{as:"th",p:2,textAlign:"left",fontWeight:"semibold",color:"blue.600",children:"Value"})]})}),e.jsx(t,{as:"tbody",children:Object.entries(d).sort(([u],[j])=>u.localeCompare(j)).map(([u,j])=>e.jsxs(t,{as:"tr",_hover:{bg:"gray.subtle"},children:[e.jsx(t,{as:"td",p:2,borderBottom:"1px",borderColor:"border.subtle",fontFamily:"mono",fontSize:"xs",children:u}),e.jsx(t,{as:"td",p:2,borderBottom:"1px",borderColor:"border.subtle",fontSize:"xs",children:j})]},u))})]})}):e.jsx(t,{as:"pre",fontSize:"xs",bg:"bg.muted",p:2,borderRadius:"md",overflow:"auto",maxH:"200px",children:JSON.stringify(d,null,2)}):e.jsx(r,{fontSize:"sm",children:String(d)});return e.jsx(t,{width:"75%",p:6,overflow:"auto",children:e.jsxs(w,{gap:6,align:"stretch",children:[e.jsx(t,{children:e.jsx(r,{fontSize:"2xl",fontWeight:"bold",mb:2,children:o})}),e.jsxs(t,{p:4,borderWidth:"1px",borderRadius:"lg",bg:"white",shadow:"sm",children:[e.jsx(r,{fontSize:"lg",fontWeight:"semibold",mb:4,children:"Properties"}),Object.keys(c).length===0?e.jsx(r,{color:"fg.muted",fontSize:"sm",children:"No properties available"}):e.jsx(w,{gap:4,align:"stretch",children:Object.entries(c).sort(([d],[b])=>d.localeCompare(b)).map(([d,b])=>e.jsxs(t,{children:[e.jsxs(r,{fontSize:"sm",fontWeight:"bold",color:"blue.600",mb:2,children:[d,":"]}),e.jsx(t,{pl:4,children:x(b)})]},d))})]}),e.jsxs(t,{p:4,borderWidth:"1px",borderRadius:"lg",bg:"white",shadow:"sm",children:[e.jsx(r,{fontSize:"lg",fontWeight:"semibold",mb:4,children:"Information"}),e.jsxs(G,{templateColumns:"auto 1fr",gap:3,alignItems:"start",children:[e.jsx(r,{fontSize:"sm",fontWeight:"bold",color:"blue.600",children:"Type:"}),e.jsx(z,{colorPalette:"blue",size:"sm",children:i.type}),e.jsx(r,{fontSize:"sm",fontWeight:"bold",color:"blue.600",children:"Cost per Word:"}),e.jsx(r,{fontSize:"sm",children:i.costPerWord}),e.jsx(r,{fontSize:"sm",fontWeight:"bold",color:"blue.600",children:"Cost per MChar:"}),e.jsx(r,{fontSize:"sm",children:i.costPerMChar}),i.description&&e.jsxs(e.Fragment,{children:[e.jsx(r,{fontSize:"sm",fontWeight:"bold",color:"blue.600",children:"Description:"}),e.jsx(t,{children:g(i.description)})]})]})]})]})})},Ze=({langPairKey:o,tus:l,onRemoveTU:a})=>{const[n,i]=S.useState(""),[c,h]=S.useState(!1),[g,x]=S.useState(!1),[d,b]=S.useState(null),[u,j]=S.useState(""),[C,W]=S.useState(""),[T,v]=S.useState(""),[p,Y]=S.useState(null),[fe,Z]=S.useState(!1),{data:ge={},isLoading:be}=Q({queryKey:["info"],queryFn:()=>K("/api/info")}),je=ge.providers||[],X=se({mutationFn:async({sourceLang:s,targetLang:f,guids:m,provider:A})=>{const P=await fetch("/api/dispatcher/estimateJob",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sourceLang:s,targetLang:f,guids:m,provider:A})});if(!P.ok){const I=await P.json();throw new Error(I.message||"Failed to estimate job")}return P.json()}}),J=se({mutationFn:async({sourceLang:s,targetLang:f,guids:m,provider:A,jobName:P,instructions:I})=>{const O=await fetch("/api/dispatcher/startJob",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sourceLang:s,targetLang:f,guids:m,provider:A,jobName:P,instructions:I})});if(!O.ok){const we=await O.json();throw new Error(we.message||"Failed to start job")}return O.json()}});function ee(s){return s.map(f=>typeof f=="string"?f:`{{${f.t}}}`).join("")}const me=async()=>{if(!n){alert("Please select a provider first");return}const s=Array.isArray(l)?l:l.tus,f=typeof n=="object"&&n?.id?n.id:n;try{const m=s.map(P=>P.guid),A=await X.mutateAsync({sourceLang:$,targetLang:M,guids:m,provider:f});A?(b(A),j(""),W(""),h(!0)):(v(`Provider "${f}" did not accept any of the selected translation units.`),x(!0))}catch(m){v(`Failed to estimate job: ${m.message}`),x(!0)}},pe=s=>{i(s)},Se=async()=>{if(!d)return;const s=typeof n=="object"&&n?.id?n.id:n;try{const m=(await J.mutateAsync({sourceLang:$,targetLang:M,guids:d.guids,provider:s,jobName:u||void 0,instructions:C||void 0}))[0];Y(m),h(!1),Z(!0)}catch(f){v(`Failed to start job: ${f.message}`),x(!0)}},te=()=>{if(Z(!1),Y(null),b(null),j(""),W(""),d&&d.guids){const s=new Set(d.guids),f=Array.isArray(l)?l:l.tus;for(let m=f.length-1;m>=0;m--)s.has(f[m].guid)&&a(o,m)}},ye=s=>s===0?"Free":s==null?"Unknown":`$${s.toFixed(2)}`,L=Array.isArray(l)?l:l.tus,$=Array.isArray(l)?o.split("|")[0]||o.split("→")[0]:l.sourceLang,M=Array.isArray(l)?o.split("|")[1]||o.split("→").slice(1).join("→"):l.targetLang,re=L.some(s=>s.ntgt!==void 0),oe=L.some(s=>s.channel!==void 0);return e.jsxs(t,{p:6,borderWidth:"1px",borderRadius:"lg",bg:"white",shadow:"sm",children:[e.jsxs(w,{gap:4,align:"stretch",children:[e.jsx(t,{children:e.jsxs(y,{align:"center",justify:"space-between",mb:2,children:[e.jsxs(y,{align:"center",gap:3,children:[e.jsx(z,{colorPalette:"blue",size:"sm",children:$}),e.jsx(r,{color:"fg.muted",fontSize:"lg",children:"→"}),e.jsx(z,{colorPalette:"green",size:"sm",children:M}),e.jsxs(y,{align:"center",gap:3,ml:4,children:[e.jsxs(ve,{size:"sm",width:"250px",value:n?[n]:[],onValueChange:s=>{},positioning:{strategy:"absolute",placement:"bottom-start",flip:!0,gutter:4},children:[e.jsxs(Ae,{children:[e.jsx(r,{fontSize:"sm",flex:"1",textAlign:"left",children:typeof n=="object"&&n?.id?n.id:n||"Select Provider"}),e.jsx(Pe,{})]}),e.jsx(Le,{children:e.jsx(Re,{zIndex:1e3,bg:"white",borderWidth:"1px",borderColor:"border.default",borderRadius:"md",shadow:"lg",minW:"250px",maxH:"200px",overflow:"auto",children:be?e.jsxs(t,{p:3,textAlign:"center",children:[e.jsx(V,{size:"sm"}),e.jsx(r,{fontSize:"sm",color:"fg.muted",mt:2,children:"Loading providers..."})]}):je.slice().sort((s,f)=>{const m=typeof s=="object"&&s?.id?s.id:s,A=typeof f=="object"&&f?.id?f.id:f;return m.localeCompare(A)}).map((s,f)=>e.jsxs($e,{item:s,value:s,onClick:()=>pe(s),children:[e.jsx(Me,{children:typeof s=="object"&&s?.id?s.id:s}),e.jsx(Je,{})]},`provider-${f}-${typeof s=="string"?s:JSON.stringify(s)}`))})})]}),e.jsx(R,{size:"sm",colorPalette:"blue",onClick:me,disabled:!n,loading:X.isPending,children:"Create Job"})]})]}),e.jsxs(r,{fontSize:"sm",color:"fg.muted",children:[L.length," ",L.length===1?"TU":"TUs"]})]})}),e.jsx(t,{bg:"white",borderRadius:"md",overflow:"auto",children:e.jsxs(t,{as:"table",w:"100%",fontSize:"sm",children:[e.jsx(t,{as:"thead",bg:"blue.subtle",borderBottom:"2px",borderColor:"blue.muted",shadow:"sm",children:e.jsxs(t,{as:"tr",children:[e.jsx(t,{as:"th",p:3,borderBottom:"1px",borderColor:"border.default",textAlign:"left",minW:"120px",children:e.jsx(r,{fontSize:"sm",fontWeight:"bold",color:"blue.600",children:"GUID"})}),oe&&e.jsx(t,{as:"th",p:3,borderBottom:"1px",borderColor:"border.default",textAlign:"left",minW:"120px",children:e.jsx(r,{fontSize:"sm",fontWeight:"bold",color:"blue.600",children:"CHANNEL"})}),e.jsx(t,{as:"th",p:3,borderBottom:"1px",borderColor:"border.default",textAlign:"left",minW:"350px",children:e.jsx(r,{fontSize:"sm",fontWeight:"bold",color:"blue.600",children:"SOURCE"})}),re&&e.jsx(t,{as:"th",p:3,borderBottom:"1px",borderColor:"border.default",textAlign:"left",minW:"350px",children:e.jsx(r,{fontSize:"sm",fontWeight:"bold",color:"blue.600",children:"TARGET"})}),e.jsx(t,{as:"th",p:3,borderBottom:"1px",borderColor:"border.default",textAlign:"center",minW:"100px",children:e.jsx(r,{fontSize:"sm",fontWeight:"bold",color:"blue.600",children:"ACTION"})})]})}),e.jsx(t,{as:"tbody",children:L.map((s,f)=>e.jsxs(t,{as:"tr",_hover:{bg:"gray.subtle"},children:[e.jsx(t,{as:"td",p:3,borderBottom:"1px",borderColor:"border.subtle",children:e.jsx(r,{fontSize:"xs",fontFamily:"mono",color:"blue.600",userSelect:"all",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxW:"100px",children:s.guid})}),oe&&e.jsx(t,{as:"td",p:3,borderBottom:"1px",borderColor:"border.subtle",children:e.jsx(r,{fontSize:"xs",children:s.channel||""})}),e.jsx(t,{as:"td",p:3,borderBottom:"1px",borderColor:"border.subtle",children:e.jsx(r,{fontSize:"xs",noOfLines:2,dir:$?.startsWith("he")||$?.startsWith("ar")?"rtl":"ltr",children:Array.isArray(s.nsrc)?ee(s.nsrc):s.nsrc})}),re&&e.jsx(t,{as:"td",p:3,borderBottom:"1px",borderColor:"border.subtle",children:e.jsx(r,{fontSize:"xs",noOfLines:2,dir:M?.startsWith("he")||M?.startsWith("ar")?"rtl":"ltr",children:Array.isArray(s.ntgt)?ee(s.ntgt):s.ntgt||""})}),e.jsx(t,{as:"td",p:3,borderBottom:"1px",borderColor:"border.subtle",textAlign:"center",children:e.jsx(R,{size:"xs",colorPalette:"red",variant:"outline",onClick:()=>a(o,f),children:"Remove"})})]},`cart-tu-${f}-${typeof s.guid=="string"?s.guid:s.nid||f}`))})]})})]}),e.jsxs(D,{open:c,onOpenChange:s=>h(s.open),children:[e.jsx(k,{}),e.jsx(B,{children:e.jsxs(E,{maxW:"500px",children:[e.jsxs(F,{children:[e.jsx(N,{children:"Job Created Successfully"}),e.jsx(U,{})]}),e.jsx(q,{children:d&&e.jsxs(w,{gap:4,align:"stretch",children:[e.jsxs(t,{children:[e.jsxs(r,{fontSize:"lg",fontWeight:"bold",color:"green.600",mb:3,children:[d.guids?.length||0," TUs accepted out of ",L.length," sent"]}),e.jsxs(w,{gap:2,align:"stretch",children:[e.jsxs(t,{children:[e.jsx(r,{fontSize:"sm",fontWeight:"semibold",color:"fg.default",display:"inline",children:"Provider: "}),e.jsx(r,{fontSize:"sm",color:"blue.600",fontFamily:"mono",display:"inline",children:typeof n=="object"&&n?.id?n.id:n})]}),e.jsxs(t,{children:[e.jsx(r,{fontSize:"sm",fontWeight:"semibold",color:"fg.default",display:"inline",children:"Estimated Cost: "}),e.jsx(r,{fontSize:"sm",color:"green.600",fontWeight:"medium",display:"inline",children:ye(d.estimatedCost)})]}),d.statusDescription&&e.jsxs(t,{children:[e.jsx(r,{fontSize:"sm",fontWeight:"semibold",color:"fg.default",display:"inline",children:"Status: "}),e.jsx(r,{fontSize:"sm",color:"fg.muted",display:"inline",children:ne(d.statusDescription)})]})]})]}),e.jsxs(t,{children:[e.jsx(r,{fontSize:"sm",fontWeight:"bold",mb:2,children:"Job Name (optional):"}),e.jsx(Ie,{placeholder:"Enter a name for this job...",value:u,onChange:s=>j(s.target.value)})]}),e.jsxs(t,{children:[e.jsx(r,{fontSize:"sm",fontWeight:"bold",mb:2,children:"Job Instructions (optional):"}),e.jsx(Oe,{placeholder:"Enter any specific instructions for this translation job...",value:C,onChange:s=>W(s.target.value),rows:3})]}),e.jsxs(y,{gap:3,children:[e.jsx(R,{colorPalette:"gray",variant:"outline",onClick:()=>{h(!1),b(null),j(""),W("")},flex:"1",disabled:J.isPending,children:"Cancel"}),e.jsx(R,{colorPalette:"green",onClick:Se,loading:J.isPending,flex:"1",children:"Push Job"})]})]})})]})})]}),e.jsxs(D,{open:g,onOpenChange:s=>x(s.open),children:[e.jsx(k,{}),e.jsx(B,{children:e.jsxs(E,{maxW:"400px",children:[e.jsxs(F,{children:[e.jsx(N,{children:"Job Creation Failed"}),e.jsx(U,{})]}),e.jsx(q,{children:e.jsxs(w,{gap:4,align:"stretch",children:[e.jsx(r,{color:"red.600",children:T}),e.jsx(R,{colorPalette:"red",onClick:()=>x(!1),w:"100%",children:"Close"})]})})]})})]}),e.jsxs(D,{open:fe,onOpenChange:s=>{s.open||te()},children:[e.jsx(k,{}),e.jsx(B,{children:e.jsxs(E,{maxW:"400px",children:[e.jsxs(F,{children:[e.jsx(N,{children:"Job Started Successfully"}),e.jsx(U,{})]}),e.jsx(q,{children:p&&e.jsxs(w,{gap:4,align:"stretch",children:[e.jsx(t,{children:e.jsxs(w,{gap:2,align:"stretch",children:[e.jsxs(t,{children:[e.jsx(r,{fontSize:"sm",fontWeight:"semibold",color:"fg.default",display:"inline",children:"Job ID: "}),e.jsx(r,{fontSize:"sm",fontFamily:"mono",color:"blue.600",cursor:"pointer",_hover:{textDecoration:"underline"},onClick:s=>{s.preventDefault(),window.open(`/job/${p.jobGuid}`,"_blank")},display:"inline",children:p.jobGuid})]}),e.jsxs(t,{children:[e.jsx(r,{fontSize:"sm",fontWeight:"semibold",color:"fg.default",display:"inline",children:"Provider: "}),e.jsx(r,{fontSize:"sm",color:"blue.600",fontFamily:"mono",display:"inline",children:p.translationProvider})]}),e.jsxs(t,{children:[e.jsx(r,{fontSize:"sm",fontWeight:"semibold",color:"fg.default",display:"inline",children:"Language Pair: "}),e.jsxs(r,{fontSize:"sm",color:"purple.600",fontWeight:"medium",display:"inline",children:[p.sourceLang," → ",p.targetLang]})]}),e.jsxs(t,{children:[e.jsx(r,{fontSize:"sm",fontWeight:"semibold",color:"fg.default",display:"inline",children:"Status: "}),e.jsx(r,{fontSize:"sm",fontWeight:"bold",color:p.status==="completed"?"green.600":"orange.600",display:"inline",children:p.status.toUpperCase()})]}),p.statusDescription&&e.jsxs(t,{children:[e.jsx(r,{fontSize:"sm",fontWeight:"semibold",color:"fg.default",mb:1,children:"Description:"}),e.jsx(r,{fontSize:"sm",color:"fg.muted",pl:2,borderLeft:"2px",borderColor:"blue.200",children:ne(p.statusDescription)})]})]})}),e.jsx(t,{children:e.jsx(R,{colorPalette:"blue",onClick:te,w:"100%",children:"Close & Remove TUs from Cart"})})]})})]})})]})]})};export{Ue as C,Ve as L,qe as P,He as S,_e as a,Qe as b,Ge as c,Ke as d,Ye as e,K as f,Ze as g,ne as r};
