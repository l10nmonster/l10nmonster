import{u as z,a0 as R,r as c,i as k,j as e,B as n,S as P,A as $,T as s,F as L,a1 as q,a2 as T,a3 as B,a4 as F,a5 as I,I as M,a6 as A,a7 as H,L as G,h as K,G as N}from"./vendor-BVSmEsOp.js";import{P as U,f as v}from"./index-Dl1WS_Lc.js";const D=({channelId:o,hideComplete:h,calculateCompletionPercentage:u,hasIncompleteContent:m})=>{const[g,b]=c.useState(!1),[d,y]=c.useState(!0),f=c.useRef(null);c.useEffect(()=>{const r=new IntersectionObserver(i=>{i.forEach(l=>{l.isIntersecting&&(b(!0),r.disconnect())})},{rootMargin:"200px",threshold:0});return f.current&&r.observe(f.current),()=>r.disconnect()},[]);const{data:a,isLoading:C,error:S}=k({queryKey:["status",o],queryFn:()=>v(`/api/status/${o}`),enabled:g}),t=c.useMemo(()=>{if(!a||!h)return a;const r={};return Object.entries(a).forEach(([i,l])=>{const j={};Object.entries(l).forEach(([O,p])=>{const w={};Object.entries(p).forEach(([W,E])=>{m(E.pairSummaryByStatus)&&(w[W]=E)}),Object.keys(w).length>0&&(j[O]=w)}),Object.keys(j).length>0&&(r[i]=j)}),Object.keys(r).length>0?r:null},[a,h,m]),x=c.useMemo(()=>t?Object.values(t).reduce((r,i)=>r+Object.keys(i).length,0):0,[t]);return h&&!t&&a!==void 0?null:e.jsxs(n,{ref:f,mb:8,p:6,borderWidth:"2px",borderRadius:"lg",bg:"white",borderColor:"green.200",children:[e.jsxs(n,{display:"flex",alignItems:"center",gap:3,flexWrap:"wrap",mb:6,pb:4,borderBottom:"2px",borderColor:"green.100",children:[e.jsx(M,{"aria-label":d?"Collapse channel":"Expand channel",onClick:()=>y(!d),variant:"ghost",size:"sm",children:d?"▼":"▶"}),e.jsxs(n,{children:[e.jsx(s,{fontSize:"sm",color:"fg.muted",mb:1,children:"Channel"}),e.jsx(s,{fontSize:"lg",fontWeight:"bold",color:"green.600",children:o})]}),C&&e.jsx(P,{size:"md"})]}),e.jsx(A,{open:d,children:e.jsx(H,{children:S?e.jsx($,{status:"error",children:e.jsxs(n,{children:[e.jsxs(s,{fontWeight:"bold",children:["Error loading channel ",o]}),e.jsx(s,{children:S.message||"Unknown error"})]})}):C?e.jsx(n,{display:"flex",justifyContent:"center",py:8,children:e.jsx(s,{color:"fg.muted",children:"Loading channel data..."})}):t&&Object.keys(t).length>0?Object.entries(t).map(([r,i])=>Object.entries(i).map(([l,j])=>e.jsxs(n,{mb:6,p:4,borderWidth:"1px",borderRadius:"md",bg:"gray.50",borderColor:"border.default",children:[e.jsx(n,{display:"flex",alignItems:"center",gap:3,flexWrap:"wrap",mb:4,children:e.jsxs(G,{as:K,to:`/status/${o}/${r}/${l}`,fontSize:"lg",fontWeight:"semibold",color:"blue.600",_hover:{textDecoration:"underline"},children:[r," → ",l]})}),e.jsx(N,{templateColumns:"repeat(auto-fit, minmax(300px, 1fr))",gap:4,children:Object.entries(j).map(([O,p])=>e.jsx(U,{project:{translationStatus:p.details||[],pairSummary:p.pairSummary,pairSummaryByStatus:p.pairSummaryByStatus,projectName:O}},`${o}-${r}-${l}-${O}`))})]},`${r}-${l}`))):a&&Object.keys(a).length===0?e.jsx(n,{display:"flex",justifyContent:"center",py:8,children:e.jsx(s,{color:"fg.muted",children:"This channel has no projects"})}):g?e.jsx(n,{display:"flex",justifyContent:"center",py:8,children:e.jsx(s,{color:"fg.muted",children:"No content available for this channel"})}):e.jsx(n,{display:"flex",justifyContent:"center",py:8,children:e.jsx(s,{color:"fg.muted",children:"Scroll down to load content..."})})})}),!d&&t&&e.jsx(n,{display:"flex",justifyContent:"center",py:4,children:e.jsxs(s,{fontSize:"sm",color:"gray.600",fontStyle:"italic",children:[x," language pair",x!==1?"s":""," (collapsed)"]})})]})},J=()=>{z();const[o,h]=R(),[u,m]=c.useState(()=>o.get("hideComplete")==="true"),{data:g,isLoading:b,error:d}=k({queryKey:["info"],queryFn:()=>v("/api/info")}),y=g?.channels?.map(t=>t.id)||[],f=b,a=d;c.useEffect(()=>{const t=new URLSearchParams(o);u?t.set("hideComplete","true"):t.delete("hideComplete"),h(t,{replace:!0})},[u,o,h]);const C=t=>{const x=Object.values(t).reduce((r,i)=>r+i,0);return x===0?100:Math.round((t.translated||0)/x*100)},S=t=>(t.untranslated||0)>0||(t["in flight"]||0)>0||(t["low quality"]||0)>0;return b?e.jsx(n,{display:"flex",justifyContent:"center",mt:5,children:e.jsx(P,{size:"xl"})}):a?e.jsx(n,{mt:5,px:6,children:e.jsx($,{status:"error",children:e.jsxs(n,{children:[e.jsx(s,{fontWeight:"bold",children:"Error"}),e.jsx(s,{children:a})]})})}):e.jsxs(n,{py:6,px:6,children:[e.jsx(L,{align:"center",gap:3,mb:6,children:e.jsxs(q,{checked:u,onCheckedChange:t=>m(t.checked),children:[e.jsx(T,{}),e.jsx(B,{children:e.jsx(F,{})}),e.jsx(I,{children:e.jsx(s,{fontSize:"md",fontWeight:"medium",children:"Hide complete"})})]})}),y.map(t=>e.jsx(D,{channelId:t,hideComplete:u,calculateCompletionPercentage:C,hasIncompleteContent:S},t)),y.length===0&&!f&&e.jsx(s,{mt:4,color:"fg.muted",children:"No channels found."})]})};export{J as default};
