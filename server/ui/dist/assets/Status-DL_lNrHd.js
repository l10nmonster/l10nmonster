import{u as z,a1 as R,r as c,k as E,j as e,B as n,S as P,A as $,T as s,F as q,a2 as T,a3 as B,a4 as F,a5 as L,a6 as M,I as A,a7 as H,a8 as I,L as G,c as K,G as N}from"./vendor-BCzBv13G.js";import{P as U,f as v}from"./index-DQZVXQUG.js";const D=({channelId:o,hideComplete:h,calculateCompletionPercentage:u,hasIncompleteContent:m})=>{const[b,g]=c.useState(!1),[d,y]=c.useState(!0),f=c.useRef(null);c.useEffect(()=>{const r=new IntersectionObserver(a=>{a.forEach(l=>{l.isIntersecting&&(g(!0),r.disconnect())})},{rootMargin:"200px",threshold:0});return f.current&&r.observe(f.current),()=>r.disconnect()},[]);const{data:i,isLoading:C,error:S}=E({queryKey:["status",o],queryFn:()=>v(`/api/status/${o}`),enabled:b}),t=c.useMemo(()=>{if(!i||!h)return i;const r={};return Object.entries(i).forEach(([a,l])=>{const j={};Object.entries(l).forEach(([O,p])=>{const k={};Object.entries(p).forEach(([W,w])=>{m(w.pairSummaryByStatus)&&(k[W]=w)}),Object.keys(k).length>0&&(j[O]=k)}),Object.keys(j).length>0&&(r[a]=j)}),Object.keys(r).length>0?r:null},[i,h,m]),x=c.useMemo(()=>t?Object.values(t).reduce((r,a)=>r+Object.keys(a).length,0):0,[t]);return h&&!t&&i!==void 0?null:e.jsxs(n,{ref:f,mb:8,p:6,borderWidth:"2px",borderRadius:"lg",bg:"white",borderColor:"green.200",children:[e.jsxs(n,{display:"flex",alignItems:"center",gap:3,flexWrap:"wrap",mb:6,pb:4,borderBottom:"2px",borderColor:"green.100",children:[e.jsx(A,{"aria-label":d?"Collapse channel":"Expand channel",onClick:()=>y(!d),variant:"ghost",size:"sm",children:d?"▼":"▶"}),e.jsxs(n,{children:[e.jsx(s,{fontSize:"sm",color:"fg.muted",mb:1,children:"Channel"}),e.jsx(s,{fontSize:"lg",fontWeight:"bold",color:"green.600",children:o})]}),C&&e.jsx(P,{size:"md"})]}),e.jsx(H,{open:d,children:e.jsx(I,{children:S?e.jsx($,{status:"error",children:e.jsxs(n,{children:[e.jsxs(s,{fontWeight:"bold",children:["Error loading channel ",o]}),e.jsx(s,{children:S.message||"Unknown error"})]})}):C?e.jsx(n,{display:"flex",justifyContent:"center",py:8,children:e.jsx(s,{color:"fg.muted",children:"Loading channel data..."})}):t&&Object.keys(t).length>0?Object.entries(t).map(([r,a])=>Object.entries(a).map(([l,j])=>e.jsxs(n,{mb:6,p:4,borderWidth:"1px",borderRadius:"md",bg:"gray.50",borderColor:"border.default",children:[e.jsx(n,{display:"flex",alignItems:"center",gap:3,flexWrap:"wrap",mb:4,children:e.jsxs(G,{as:K,to:`/status/${o}/${r}/${l}`,fontSize:"lg",fontWeight:"semibold",color:"blue.600",_hover:{textDecoration:"underline"},children:[r," → ",l]})}),e.jsx(N,{templateColumns:"repeat(auto-fit, minmax(300px, 1fr))",gap:4,children:Object.entries(j).map(([O,p])=>e.jsx(U,{project:{translationStatus:p.details||[],pairSummary:p.pairSummary,pairSummaryByStatus:p.pairSummaryByStatus,projectName:O},channelId:o,sourceLang:r,targetLang:l},`${o}-${r}-${l}-${O}`))})]},`${r}-${l}`))):i&&Object.keys(i).length===0?e.jsx(n,{display:"flex",justifyContent:"center",py:8,children:e.jsx(s,{color:"fg.muted",children:"This channel has no projects"})}):b?e.jsx(n,{display:"flex",justifyContent:"center",py:8,children:e.jsx(s,{color:"fg.muted",children:"No content available for this channel"})}):e.jsx(n,{display:"flex",justifyContent:"center",py:8,children:e.jsx(s,{color:"fg.muted",children:"Scroll down to load content..."})})})}),!d&&t&&e.jsx(n,{display:"flex",justifyContent:"center",py:4,children:e.jsxs(s,{fontSize:"sm",color:"gray.600",fontStyle:"italic",children:[x," language pair",x!==1?"s":""," (collapsed)"]})})]})},J=()=>{z();const[o,h]=R(),[u,m]=c.useState(()=>o.get("hideComplete")==="true"),{data:b,isLoading:g,error:d}=E({queryKey:["info"],queryFn:()=>v("/api/info")}),y=b?.channels?.map(t=>t.id)||[],f=g,i=d;c.useEffect(()=>{const t=new URLSearchParams(o);u?t.set("hideComplete","true"):t.delete("hideComplete"),h(t,{replace:!0})},[u,o,h]);const C=t=>{const x=Object.values(t).reduce((r,a)=>r+a,0);return x===0?100:Math.round((t.translated||0)/x*100)},S=t=>(t.untranslated||0)>0||(t["in flight"]||0)>0||(t["low quality"]||0)>0;return g?e.jsx(n,{display:"flex",justifyContent:"center",mt:5,children:e.jsx(P,{size:"xl"})}):i?e.jsx(n,{mt:5,px:6,children:e.jsx($,{status:"error",children:e.jsxs(n,{children:[e.jsx(s,{fontWeight:"bold",children:"Error"}),e.jsx(s,{children:i})]})})}):e.jsxs(n,{py:6,px:6,children:[e.jsx(q,{align:"center",gap:3,mb:6,children:e.jsxs(T,{checked:u,onCheckedChange:t=>m(t.checked),children:[e.jsx(B,{}),e.jsx(F,{children:e.jsx(L,{})}),e.jsx(M,{children:e.jsx(s,{fontSize:"md",fontWeight:"medium",children:"Hide complete"})})]})}),y.map(t=>e.jsx(D,{channelId:t,hideComplete:u,calculateCompletionPercentage:C,hasIncompleteContent:S},t)),y.length===0&&!f&&e.jsx(s,{mt:4,color:"fg.muted",children:"No channels found."})]})};export{J as default};
