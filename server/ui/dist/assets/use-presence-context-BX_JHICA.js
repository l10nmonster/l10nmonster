import{e as E,d as f,c as v}from"./index-DYRyEtJ_.js";import{N as P,O as g,P as y,Q as p,x as U,U as A,V as O,r as l}from"./index-7BvmfFYo.js";const h=e=>E()(e,["immediate","lazyMount","onExitComplete","present","skipAnimationOnMount","unmountOnExit"]);function M(e,t){const{state:a,send:n,context:s}=e,i=a.matches("mounted","unmountSuspended");return{skip:!s.get("initial"),present:i,setNode(o){o&&n({type:"NODE.SET",node:o})},unmount(){n({type:"UNMOUNT"})}}}var x=P({props({props:e}){return{...e,present:!!e.present}},initialState({prop:e}){return e("present")?"mounted":"unmounted"},refs(){return{node:null,styles:null}},context({bindable:e}){return{unmountAnimationName:e(()=>({defaultValue:null})),prevAnimationName:e(()=>({defaultValue:null})),present:e(()=>({defaultValue:!1})),initial:e(()=>({sync:!0,defaultValue:!1}))}},exit:["clearInitial","cleanupNode"],watch({track:e,prop:t,send:a}){e([()=>t("present")],()=>{a({type:"PRESENCE.CHANGED"})})},on:{"NODE.SET":{actions:["setupNode"]},"PRESENCE.CHANGED":{actions:["setInitial","syncPresence"]}},states:{mounted:{on:{UNMOUNT:{target:"unmounted",actions:["clearPrevAnimationName","invokeOnExitComplete"]},"UNMOUNT.SUSPEND":{target:"unmountSuspended"}}},unmountSuspended:{effects:["trackAnimationEvents"],on:{MOUNT:{target:"mounted",actions:["setPrevAnimationName"]},UNMOUNT:{target:"unmounted",actions:["clearPrevAnimationName","invokeOnExitComplete"]}}},unmounted:{on:{MOUNT:{target:"mounted",actions:["setPrevAnimationName"]}}}},implementations:{actions:{setInitial:({context:e})=>{e.get("initial")||queueMicrotask(()=>{e.set("initial",!0)})},clearInitial:({context:e})=>{e.set("initial",!1)},invokeOnExitComplete:({prop:e})=>{e("onExitComplete")?.()},setupNode:({refs:e,event:t})=>{e.get("node")!==t.node&&(e.set("node",t.node),e.set("styles",U(t.node)))},cleanupNode:({refs:e})=>{e.set("node",null),e.set("styles",null)},syncPresence:({context:e,refs:t,send:a,prop:n})=>{const s=n("present");if(s)return a({type:"MOUNT",src:"presence.changed"});const i=t.get("node");if(!s&&i?.ownerDocument.visibilityState==="hidden")return a({type:"UNMOUNT",src:"visibilitychange"});p(()=>{const o=m(t.get("styles"));e.set("unmountAnimationName",o),o==="none"||o===e.get("prevAnimationName")||t.get("styles")?.display==="none"||t.get("styles")?.animationDuration==="0s"?a({type:"UNMOUNT",src:"presence.changed"}):a({type:"UNMOUNT.SUSPEND"})})},setPrevAnimationName:({context:e,refs:t})=>{p(()=>{e.set("prevAnimationName",m(t.get("styles")))})},clearPrevAnimationName:({context:e})=>{e.set("prevAnimationName",null)}},effects:{trackAnimationEvents:({context:e,refs:t,send:a})=>{const n=t.get("node");if(!n)return;const s=u=>{(u.composedPath?.()?.[0]??u.target)===n&&e.set("prevAnimationName",m(t.get("styles")))},i=u=>{const c=m(t.get("styles"));A(u)===n&&c===e.get("unmountAnimationName")&&a({type:"UNMOUNT",src:"animationend"})};n.addEventListener("animationstart",s),n.addEventListener("animationcancel",i),n.addEventListener("animationend",i);const o=g(n,{animationFillMode:"forwards"});return()=>{n.removeEventListener("animationstart",s),n.removeEventListener("animationcancel",i),n.removeEventListener("animationend",i),y(()=>o())}}}}});function m(e){return e?.animationName||"none"}O()(["onExitComplete","present","immediate"]);function C(e,t={}){const{sync:a=!1}=t,n=S(e);return l.useCallback((...s)=>a?queueMicrotask(()=>n.current?.(...s)):n.current?.(...s),[a,n])}function S(e){const t=l.useRef(e);return t.current=e,t}const D=(e={})=>{const{lazyMount:t,unmountOnExit:a,present:n,skipAnimationOnMount:s=!1,...i}=e,o=l.useRef(!1),u={...i,present:n,onExitComplete:C(e.onExitComplete)},c=f(x,u),r=M(c);r.present&&(o.current=!0);const d=!r.present&&!o.current&&t||a&&!r.present&&o.current,N=()=>({"data-state":r.skip&&s?void 0:n?"open":"closed",hidden:!r.present});return{ref:r.setNode,getPresenceProps:N,present:r.present,unmounted:d}},[L,R]=v({name:"PresenceContext",hookName:"usePresenceContext",providerName:"<PresenceProvider />"});export{L as P,R as a,D as b,h as s,C as u};
